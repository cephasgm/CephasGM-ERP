<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Health & Safety - CephasGM Enterprise ERP</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --background: #f8fafc;
            --surface: #ffffff;
            --text: #1e293b;
            --text-light: #64748b;
            --border: #e2e8f0;
        }

        .dark-mode {
            --background: #0f172a;
            --surface: #1e293b;
            --text: #f1f5f9;
            --text-light: #94a3b8;
            --border: #334155;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--background);
            color: var(--text);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 280px 1fr;
            min-height: 100vh;
        }

        .sidebar {
            background: var(--surface);
            border-right: 1px solid var(--border);
            padding: 2rem 1rem;
            position: fixed;
            width: 280px;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 2rem;
            padding: 0 1rem;
            text-decoration: none;
            color: inherit;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--primary);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.25rem;
        }

        .nav-section {
            margin-bottom: 2rem;
        }

        .nav-title {
            font-size: 0.75rem;
            text-transform: uppercase;
            color: var(--text-light);
            margin-bottom: 1rem;
            padding: 0 1rem;
            letter-spacing: 0.5px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            color: var(--text-light);
            text-decoration: none;
            transition: all 0.2s;
            margin-bottom: 0.25rem;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            cursor: pointer;
            font-size: 0.95rem;
        }

        .nav-item:hover, .nav-item.active {
            background: var(--primary);
            color: white;
        }

        .nav-icon {
            font-size: 1.25rem;
            width: 24px;
            text-align: center;
        }

        .main-content {
            grid-column: 2;
            padding: 2rem;
            margin-left: 280px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header h1 {
            font-size: 1.875rem;
            font-weight: 700;
        }

        .header-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        /* Enhanced Statistics Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--surface) 0%, #f8fafc 100%);
            padding: 1.5rem;
            border-radius: 16px;
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        .dark-mode .stat-card {
            background: linear-gradient(135deg, var(--surface) 0%, #0f172a 100%);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-color: var(--primary);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 0.5rem;
            position: relative;
        }

        .stat-label {
            color: var(--text-light);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .stat-details {
            margin-top: 1rem;
            font-size: 0.85rem;
            color: var(--text-light);
            display: none;
            border-top: 1px solid var(--border);
            padding-top: 1rem;
        }

        .stat-card:hover .stat-details {
            display: block;
        }

        /* Chart Container */
        .chart-container {
            background: var(--surface);
            padding: 1.25rem;
            border-radius: 16px;
            border: 1px solid var(--border);
            margin-bottom: 2rem;
            height: 450px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .chart-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .chart-subtitle {
            color: var(--text-light);
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        .chart-controls {
            display: flex;
            gap: 0.75rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .chart-type-selector {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .chart-type-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--background);
            color: var(--text);
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .chart-type-btn:hover {
            border-color: var(--primary);
            background: var(--surface);
        }

        .chart-type-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .custom-calendar {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .date-input {
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--surface);
            font-family: inherit;
            font-size: 0.875rem;
            color: var(--text);
        }

        .date-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .chart-canvas-container {
            flex: 1;
            min-height: 0;
            position: relative;
            background: var(--background);
            border-radius: 8px;
            overflow: hidden;
        }

        /* Enhanced Tables */
        .data-table-container {
            overflow-x: auto;
            margin-bottom: 2rem;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: var(--surface);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .data-table th {
            background: var(--background);
            font-weight: 600;
            color: var(--text);
            position: sticky;
            top: 0;
            padding: 1rem 0.75rem;
            text-align: left;
            border-bottom: 2px solid var(--border);
            font-size: 0.85rem;
        }

        .data-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
            font-size: 0.9rem;
        }

        .data-table tbody tr:hover {
            background: var(--background);
        }

        .data-table td.editable {
            cursor: pointer;
            position: relative;
            transition: background-color 0.2s;
        }

        .data-table td.editable:hover {
            background: rgba(37, 99, 235, 0.05);
        }

        .data-table td.editing {
            background: rgba(37, 99, 235, 0.1);
            border: 1px solid var(--primary);
            border-radius: 4px;
            padding: 0.5rem;
        }

        .edit-input {
            width: 100%;
            padding: 0.5rem;
            border: 2px solid var(--primary);
            border-radius: 6px;
            font-family: inherit;
            font-size: inherit;
            background: var(--surface);
            color: var(--text);
            outline: none;
        }

        .edit-input:focus {
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .edit-select {
            width: 100%;
            padding: 0.5rem;
            border: 2px solid var(--primary);
            border-radius: 6px;
            font-family: inherit;
            font-size: inherit;
            background: var(--surface);
            color: var(--text);
            outline: none;
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .badge-success {
            background: #dcfce7;
            color: #166534;
        }

        .badge-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-error {
            background: #fecaca;
            color: #991b1b;
        }

        .badge-info {
            background: #dbeafe;
            color: #1e40af;
        }

        /* Risk Matrix */
        .risk-matrix {
            background: var(--surface);
            border-radius: 16px;
            border: 1px solid var(--border);
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        .matrix-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .matrix-cell {
            padding: 1.5rem 1rem;
            border-radius: 12px;
            text-align: center;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            border: 2px solid transparent;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .matrix-cell:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }

        .risk-low { 
            background: linear-gradient(135deg, #dcfce7, #bbf7d0);
            color: #166534; 
            border-color: #86efac;
        }
        .risk-medium { 
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            color: #92400e; 
            border-color: #fcd34d;
        }
        .risk-high { 
            background: linear-gradient(135deg, #fed7aa, #fdba74);
            color: #9a3412; 
            border-color: #fb923c;
        }
        .risk-very-high { 
            background: linear-gradient(135deg, #fecaca, #fca5a5);
            color: #991b1b; 
            border-color: #f87171;
        }
        .risk-extreme { 
            background: linear-gradient(135deg, #fca5a5, #f87171);
            color: #7f1d1d; 
            border-color: #ef4444;
        }

        /* Module Cards */
        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .module-card {
            background: var(--surface);
            padding: 2rem;
            border-radius: 12px;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            color: inherit;
            display: block;
        }

        .module-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-color: var(--primary);
        }

        .module-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #dc2626, #ef4444);
            color: white;
        }

        .module-card h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .module-card p {
            color: var(--text-light);
            font-size: 0.95rem;
        }

        /* Tabs */
        .tab-container {
            margin-bottom: 2rem;
        }

        .tab-buttons {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            overflow-x: auto;
            gap: 0.5rem;
        }

        .tab-button {
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-light);
            white-space: nowrap;
            transition: all 0.2s;
        }

        .tab-button:hover {
            color: var(--primary);
        }

        .tab-button.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal-content {
            background: var(--surface);
            margin: 2% auto;
            padding: 2rem;
            border-radius: 12px;
            width: 90%;
            max-width: 1200px;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
            transition: color 0.2s;
        }

        .close-modal:hover {
            color: var(--text);
        }

        .modal-header {
            margin-bottom: 2rem;
            padding-right: 2rem;
        }

        .modal-header h2 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .modal-header p {
            color: var(--text-light);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--background);
            font-family: inherit;
            color: var(--text);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .action-buttons .btn {
            flex: 1;
            min-width: 150px;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.95rem;
        }

        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text);
        }

        .btn-outline:hover {
            background: var(--background);
            border-color: var(--primary);
            color: var(--primary);
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.2);
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
        }

        .btn-warning:hover {
            background: #d97706;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.2);
        }

        /* File Upload */
        .file-upload-area {
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 1rem;
        }

        .file-upload-area:hover {
            border-color: var(--primary);
            background: var(--background);
        }

        .file-list {
            margin-top: 1rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            margin-bottom: 0.5rem;
            background: var(--background);
        }

        .file-info {
            flex: 1;
        }

        .file-name {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .file-meta {
            font-size: 0.75rem;
            color: var(--text-light);
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            z-index: 1000;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast-success {
            border-left: 4px solid var(--success);
        }

        .toast-error {
            border-left: 4px solid var(--error);
        }

        .toast-warning {
            border-left: 4px solid var(--warning);
        }

        .toast-icon {
            font-size: 1.25rem;
        }

        .toast-success .toast-icon { color: var(--success); }
        .toast-error .toast-icon { color: var(--error); }
        .toast-warning .toast-icon { color: var(--warning); }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .toast-message {
            font-size: 0.875rem;
            color: var(--text-light);
        }

        .close-toast {
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            font-size: 1.25rem;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-toast:hover {
            color: var(--text);
        }

        /* Confirm Dialog */
        .confirm-dialog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .confirm-dialog.show {
            display: flex;
        }

        .confirm-content {
            background: var(--surface);
            border-radius: 12px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .confirm-icon {
            font-size: 3rem;
            text-align: center;
            margin-bottom: 1rem;
            color: var(--error);
        }

        .confirm-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .confirm-message {
            color: var(--text-light);
            text-align: center;
            margin-bottom: 2rem;
        }

        .confirm-buttons {
            display: flex;
            gap: 1rem;
        }

        .confirm-buttons .btn {
            flex: 1;
        }

        /* Success/Error Messages */
        .success-message {
            background: #dcfce7;
            color: #166534;
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            display: none;
        }

        .error-message {
            background: #fecaca;
            color: #991b1b;
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            display: none;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 2rem;
            margin-top: 3rem;
            color: var(--text-light);
            border-top: 1px solid var(--border);
            font-size: 0.9rem;
        }

        /* Advanced Filters */
        .filter-bar {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-group label {
            font-weight: 500;
            white-space: nowrap;
        }

        .filter-select {
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--background);
            color: var(--text);
        }

        /* Heat Map */
        .heat-map {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .heat-cell {
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            color: white;
            font-weight: 600;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s;
            }
            .sidebar.open {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0;
                grid-column: 1;
            }
            .matrix-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 1rem;
            }
            .header {
                flex-direction: column;
            }
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .matrix-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .chart-header {
                flex-direction: column;
                align-items: flex-start;
            }
            .chart-controls {
                width: 100%;
            }
            .chart-container {
                height: 400px;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            .matrix-grid {
                grid-template-columns: 1fr;
            }
            .chart-container {
                height: 350px;
            }
            .action-buttons .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <a href="https://cephasgm.github.io/CephasGM-ERP/" class="logo">
                <div class="logo-icon">CG</div>
                <div>
                    <div style="font-weight: 700; font-size: 1.25rem;">CephasGM</div>
                    <div style="font-size: 0.875rem; color: var(--text-light);">Enterprise ERP</div>
                </div>
            </a>

            <div class="nav-section">
                <div class="nav-title">Navigation</div>
                <a href="https://cephasgm.github.io/CephasGM-ERP/" class="nav-item">
                    <span class="nav-icon">üè†</span>
                    Home Dashboard
                </a>
                <a href="safety.html" class="nav-item active">
                    <span class="nav-icon">üõ°Ô∏è</span>
                    Global Health & Safety
                </a>
            </div>

            <div class="nav-section">
                <div class="nav-title">Safety Management</div>
                <button class="nav-item" onclick="openModal('incidentModal')">
                    <span class="nav-icon">üö®</span>
                    Incident Management
                </button>
                <button class="nav-item" onclick="openModal('riskModal')">
                    <span class="nav-icon">üìä</span>
                    Risk Assessment
                </button>
                <button class="nav-item" onclick="openModal('ppeModal')">
                    <span class="nav-icon">ü•Ω</span>
                    PPE Management
                </button>
                <button class="nav-item" onclick="openModal('healthModal')">
                    <span class="nav-icon">üè•</span>
                    Health Surveillance
                </button>
                <button class="nav-item" onclick="openModal('contractorModal')">
                    <span class="nav-icon">üë∑</span>
                    Contractor Safety
                </button>
            </div>

            <div class="nav-section">
                <div class="nav-title">Compliance</div>
                <button class="nav-item" onclick="openModal('standardsModal')">
                    <span class="nav-icon">üìã</span>
                    Standards & Compliance
                </button>
                <button class="nav-item" onclick="openModal('auditModal')">
                    <span class="nav-icon">üîç</span>
                    Audit & Inspection
                </button>
                <button class="nav-item" onclick="openModal('emergencyModal')">
                    <span class="nav-icon">üö®</span>
                    Emergency Preparedness
                </button>
            </div>

            <div class="nav-section">
                <div class="nav-title">Training</div>
                <button class="nav-item" onclick="openModal('trainingModal')">
                    <span class="nav-icon">üéì</span>
                    Safety Training
                </button>
                <button class="nav-item" onclick="openModal('competencyModal')">
                    <span class="nav-icon">üìù</span>
                    Competency Management
                </button>
            </div>

            <div class="nav-section">
                <div class="nav-title">Analytics</div>
                <button class="nav-item" onclick="openModal('analyticsModal')">
                    <span class="nav-icon">üìà</span>
                    Advanced Analytics
                </button>
                <button class="nav-item" onclick="openModal('reportsModal')">
                    <span class="nav-icon">üìä</span>
                    Reports & Dashboards
                </button>
            </div>

            <div class="nav-section">
                <div class="nav-title">Operations</div>
                <a href="projects.html" class="nav-item">
                    <span class="nav-icon">üìÅ</span>
                    Projects
                </a>
                <a href="hr.html" class="nav-item">
                    <span class="nav-icon">üë•</span>
                    HR Management
                </a>
                <a href="legal.html" class="nav-item">
                    <span class="nav-icon">‚öñÔ∏è</span>
                    Legal Compliance
                </a>
                <a href="admin.html" class="nav-item">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    System Admin
                </a>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <div class="header">
                <div>
                    <h1>üåç Global Occupational Health & Safety Management</h1>
                    <div style="color: var(--text-light); margin-top: 0.5rem;">
                        Multi-national enterprise OHS compliance with 167 integrated safety management processes
                    </div>
                </div>
                <div class="header-controls">
                    <button class="btn btn-outline" onclick="toggleDarkMode()">
                        üåì Toggle Dark Mode
                    </button>
                    <button class="btn btn-primary" onclick="openModal('reportIncidentModal')">
                        üö® Report New Incident
                    </button>
                </div>
            </div>

            <!-- Global Statistics Cards -->
            <div class="stats-grid">
                <div class="stat-card" onclick="openModalWithFilter('incidentModal', 'type', 'Lost Time Injury')">
                    <div class="stat-number" id="ltifr">0.00</div>
                    <div class="stat-label">Lost Time Injury Frequency Rate</div>
                    <div class="stat-details" id="ltifrDetails">
                        <div>LTIs: <span id="ltiCount">0</span></div>
                        <div>Hours Worked: <span id="hoursWorked">0</span></div>
                        <div>Target: &lt; 1.0</div>
                    </div>
                </div>
                <div class="stat-card" onclick="openModalWithFilter('incidentModal', 'type', 'Total Recordable')">
                    <div class="stat-number" id="trir">0.00</div>
                    <div class="stat-label">Total Recordable Incident Rate</div>
                    <div class="stat-details" id="trirDetails">
                        <div>Recordables: <span id="recordableCount">0</span></div>
                        <div>Industry Avg: 3.5</div>
                    </div>
                </div>
                <div class="stat-card" onclick="openModalWithFilter('incidentModal', 'severity', 'Critical')">
                    <div class="stat-number" id="severityRate">0</div>
                    <div class="stat-label">Severity Rate (Days Lost)</div>
                    <div class="stat-details" id="severityDetails">
                        <div>Total Days Lost: <span id="totalDaysLost">0</span></div>
                        <div>Avg Days/Incident: <span id="avgDaysPerIncident">0</span></div>
                    </div>
                </div>
                <div class="stat-card" onclick="openModal('trainingModal')">
                    <div class="stat-number" id="trainingCompletionRate">0%</div>
                    <div class="stat-label">Training Completion Rate</div>
                    <div class="stat-details" id="trainingDetails">
                        <div>Completed: <span id="trainingsCompleted">0</span>/<span id="totalTrainings">0</span></div>
                        <div>Certified: <span id="certifiedCount">0</span></div>
                    </div>
                </div>
            </div>

            <!-- Second Row Statistics -->
            <div class="stats-grid">
                <div class="stat-card" onclick="openModal('incidentModal')">
                    <div class="stat-number" id="nearMissRate">0</div>
                    <div class="stat-label">Near Miss Reporting Rate</div>
                    <div class="stat-details">
                        <div>Near Misses: <span id="nearMissCount">0</span></div>
                        <div>Target: 5 per 100 employees</div>
                    </div>
                </div>
                <div class="stat-card" onclick="openModal('ppeModal')">
                    <div class="stat-number" id="ppeComplianceRate">0%</div>
                    <div class="stat-label">PPE Compliance Rate</div>
                    <div class="stat-details">
                        <div>Observations: <span id="ppeObservations">0</span></div>
                        <div>Compliant: <span id="ppeCompliant">0</span></div>
                    </div>
                </div>
                <div class="stat-card" onclick="openModal('auditModal')">
                    <div class="stat-number" id="auditClosureRate">0%</div>
                    <div class="stat-label">Audit Findings Closure Rate</div>
                    <div class="stat-details">
                        <div>Closed: <span id="closedFindings">0</span>/<span id="totalFindings">0</span></div>
                        <div>Overdue: <span id="overdueFindings">0</span></div>
                    </div>
                </div>
                <div class="stat-card" onclick="openModal('riskModal')">
                    <div class="stat-number" id="riskAssessmentRate">0%</div>
                    <div class="stat-label">Risk Assessment Completion</div>
                    <div class="stat-details">
                        <div>Assessed: <span id="assessedRisks">0</span>/<span id="totalRisks">0</span></div>
                        <div>Critical Risks: <span id="criticalRisks">0</span></div>
                    </div>
                </div>
            </div>

            <!-- Incident Trends Chart -->
            <div class="chart-container">
                <div class="chart-header">
                    <div>
                        <div class="chart-title">Global Incident Trends Analysis</div>
                        <div class="chart-subtitle">Multi-national safety performance with regional breakdown</div>
                    </div>
                    <div class="chart-controls">
                        <div class="chart-type-selector">
                            <button class="chart-type-btn active" onclick="changeChartType('line')">üìà Line</button>
                            <button class="chart-type-btn" onclick="changeChartType('bar')">üìä Bar</button>
                            <button class="chart-type-btn" onclick="changeChartType('pie')">ü•ß Pie</button>
                            <button class="chart-type-btn" onclick="changeChartType('doughnut')">üç© Doughnut</button>
                        </div>
                        <div class="custom-calendar">
                            <input type="date" id="startDate" class="date-input" onchange="updateChartWithCustomRange()">
                            <span>to</span>
                            <input type="date" id="endDate" class="date-input" onchange="updateChartWithCustomRange()">
                        </div>
                        <select class="filter-select" id="chartRegionFilter" onchange="updateChartWithFilters()">
                            <option value="all">All Regions</option>
                            <option value="NA">North America</option>
                            <option value="EU">Europe</option>
                            <option value="APAC">Asia Pacific</option>
                            <option value="LATAM">Latin America</option>
                            <option value="MEA">Middle East & Africa</option>
                        </select>
                    </div>
                </div>
                <div class="chart-canvas-container">
                    <canvas id="incidentTrendChart"></canvas>
                </div>
            </div>

            <!-- Incident Heat Map -->
            <div class="chart-container">
                <div class="chart-header">
                    <div>
                        <div class="chart-title">Global Incident Heat Map</div>
                        <div class="chart-subtitle">Geographic distribution of incidents by region</div>
                    </div>
                    <div>
                        <button class="btn btn-sm btn-outline" onclick="refreshHeatMap()">
                            üîÑ Refresh
                        </button>
                    </div>
                </div>
                <div class="heat-map" id="incidentHeatMap">
                    <!-- Heat map cells will be generated by JavaScript -->
                </div>
            </div>

            <!-- Incident Management Section -->
            <div class="chart-container">
                <div class="chart-header">
                    <div>
                        <div class="chart-title">All Incidents - Multi-National View</div>
                        <div class="chart-subtitle">Click any cell to edit, includes global compliance fields</div>
                    </div>
                    <div>
                        <button class="btn btn-primary" onclick="openModal('reportIncidentModal')">
                            + Report Incident
                        </button>
                        <button class="btn btn-outline" onclick="exportToExcel('incidents')">
                            üì• Export
                        </button>
                        <button class="btn btn-outline" onclick="openAdvancedFilters('incident')">
                            üîç Advanced Filters
                        </button>
                    </div>
                </div>
                <div class="filter-bar" id="incidentFilters" style="display: none;">
                    <div class="filter-group">
                        <label>Country:</label>
                        <select class="filter-select" id="filterCountry" onchange="filterIncidents()">
                            <option value="">All</option>
                            <option value="USA">USA</option>
                            <option value="UK">UK</option>
                            <option value="Germany">Germany</option>
                            <option value="France">France</option>
                            <option value="Japan">Japan</option>
                            <option value="Australia">Australia</option>
                            <option value="Brazil">Brazil</option>
                            <option value="South Africa">South Africa</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Region:</label>
                        <select class="filter-select" id="filterRegion" onchange="filterIncidents()">
                            <option value="">All</option>
                            <option value="NA">North America</option>
                            <option value="EU">Europe</option>
                            <option value="APAC">Asia Pacific</option>
                            <option value="LATAM">Latin America</option>
                            <option value="MEA">Middle East & Africa</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Legal Entity:</label>
                        <select class="filter-select" id="filterEntity" onchange="filterIncidents()">
                            <option value="">All</option>
                            <option value="CephasGM USA">CephasGM USA</option>
                            <option value="CephasGM Europe">CephasGM Europe</option>
                            <option value="CephasGM Asia">CephasGM Asia</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Severity:</label>
                        <select class="filter-select" id="filterSeverity" onchange="filterIncidents()">
                            <option value="">All</option>
                            <option value="Minor">Minor</option>
                            <option value="Moderate">Moderate</option>
                            <option value="Major">Major</option>
                            <option value="Critical">Critical</option>
                            <option value="Catastrophic">Catastrophic</option>
                        </select>
                    </div>
                </div>
                <div class="data-table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Country</th>
                                <th>Legal Entity</th>
                                <th>Region</th>
                                <th>Type</th>
                                <th>Date/Time</th>
                                <th>Location</th>
                                <th>Reported By</th>
                                <th>Severity</th>
                                <th>Status</th>
                                <th>Investigation</th>
                                <th>Root Cause</th>
                                <th>Corrective Actions</th>
                                <th>Injured Person</th>
                                <th>Nature of Injury</th>
                                <th>Days Lost</th>
                                <th>Regulatory</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="incidentsTableBody">
                            <!-- Incidents will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Risk Assessment Matrix -->
            <div class="risk-matrix">
                <div class="chart-header">
                    <div>
                        <div class="chart-title">Global Risk Assessment Matrix</div>
                        <div class="chart-subtitle">Multi-national risk profile with controls</div>
                    </div>
                    <div>
                        <button class="btn btn-success" onclick="saveRiskMatrix()">üíæ Save Matrix</button>
                        <button class="btn btn-outline" onclick="openModal('riskModal')">üîç View All Risks</button>
                    </div>
                </div>
                <div class="matrix-grid" id="riskMatrix">
                    <!-- Matrix cells will be generated -->
                </div>
            </div>

            <!-- OHS Management Modules Grid -->
            <div class="module-grid">
                <div class="module-card" onclick="openModal('incidentModal')">
                    <div class="module-icon">üö®</div>
                    <h3>Incident Management</h3>
                    <p>Full lifecycle incident management with investigation, root cause analysis, and corrective actions</p>
                </div>

                <div class="module-card" onclick="openModal('riskModal')">
                    <div class="module-icon">üìä</div>
                    <h3>Risk Assessment</h3>
                    <p>Comprehensive risk management with controls, residual risk, and action tracking</p>
                </div>

                <div class="module-card" onclick="openModal('ppeModal')">
                    <div class="module-icon">ü•Ω</div>
                    <h3>PPE Management</h3>
                    <p>Global PPE inventory, issuance, inspection, and compliance tracking</p>
                </div>

                <div class="module-card" onclick="openModal('healthModal')">
                    <div class="module-icon">üè•</div>
                    <h3>Health Surveillance</h3>
                    <p>Employee health monitoring, medical exams, and wellness programs</p>
                </div>

                <div class="module-card" onclick="openModal('contractorModal')">
                    <div class="module-icon">üë∑</div>
                    <h3>Contractor Safety</h3>
                    <p>Contractor pre-qualification, induction, permits, and performance monitoring</p>
                </div>

                <div class="module-card" onclick="openModal('auditModal')">
                    <div class="module-icon">üîç</div>
                    <h3>Audit & Inspection</h3>
                    <p>Scheduled audits, inspections, findings tracking, and closure management</p>
                </div>

                <div class="module-card" onclick="openModal('standardsModal')">
                    <div class="module-icon">üìã</div>
                    <h3>Standards Compliance</h3>
                    <p>International and national standards compliance with evidence tracking</p>
                </div>

                <div class="module-card" onclick="openModal('trainingModal')">
                    <div class="module-icon">üéì</div>
                    <h3>Safety Training</h3>
                    <p>Training management, certifications, and competency tracking</p>
                </div>

                <div class="module-card" onclick="openModal('emergencyModal')">
                    <div class="module-icon">üö®</div>
                    <h3>Emergency Preparedness</h3>
                    <p>Drills, equipment checks, and emergency response planning</p>
                </div>

                <div class="module-card" onclick="openModal('analyticsModal')">
                    <div class="module-icon">üìà</div>
                    <h3>Safety Analytics</h3>
                    <p>Advanced analytics, trends, and predictive insights</p>
                </div>
            </div>

            <!-- Footer -->
            <div class="footer">
                Copyright ¬© 2025 CephasGM Enterprise ERP System - Global Health & Safety Module v2.0
            </div>
        </main>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <div class="toast-icon"></div>
        <div class="toast-content">
            <div class="toast-title"></div>
            <div class="toast-message"></div>
        </div>
        <button class="close-toast" onclick="hideToast()">√ó</button>
    </div>

    <!-- Confirm Dialog -->
    <div class="confirm-dialog" id="confirmDialog">
        <div class="confirm-content">
            <div class="confirm-icon">‚ö†Ô∏è</div>
            <div class="confirm-title" id="confirmTitle">Confirm Action</div>
            <div class="confirm-message" id="confirmMessage">Are you sure you want to proceed?</div>
            <div class="confirm-buttons">
                <button class="btn btn-danger" id="confirmActionBtn">Confirm</button>
                <button class="btn btn-outline" onclick="hideConfirmDialog()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Report Incident Modal -->
    <div id="reportIncidentModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('reportIncidentModal')">√ó</button>
            <div class="modal-header">
                <h2>Report Safety Incident - Multi-National</h2>
                <p>Complete all required fields for global compliance</p>
            </div>
            
            <div class="success-message" id="reportSuccess">Incident reported successfully!</div>
            <div class="error-message" id="reportError">Please fill all required fields.</div>
            
            <div class="form-grid">
                <div class="form-group">
                    <label>Country *</label>
                    <select id="incidentCountry" required onchange="updateLocalRegulations()">
                        <option value="">Select country</option>
                        <option value="USA">United States - OSHA</option>
                        <option value="UK">United Kingdom - HSE</option>
                        <option value="Germany">Germany - DGUV</option>
                        <option value="France">France - INRS</option>
                        <option value="Canada">Canada - CCOHS</option>
                        <option value="Australia">Australia - Safe Work</option>
                        <option value="Japan">Japan - JISHA</option>
                        <option value="Brazil">Brazil - NRs</option>
                        <option value="South Africa">South Africa - DOL</option>
                        <option value="UAE">UAE - OSHAD</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Region *</label>
                    <select id="incidentRegion" required>
                        <option value="">Select region</option>
                        <option value="NA">North America</option>
                        <option value="EU">Europe</option>
                        <option value="APAC">Asia Pacific</option>
                        <option value="LATAM">Latin America</option>
                        <option value="MEA">Middle East & Africa</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Legal Entity / Subsidiary *</label>
                    <select id="incidentEntity" required>
                        <option value="">Select entity</option>
                        <option value="CephasGM USA">CephasGM USA</option>
                        <option value="CephasGM Europe">CephasGM Europe GmbH</option>
                        <option value="CephasGM UK">CephasGM UK Ltd</option>
                        <option value="CephasGM Asia">CephasGM Asia Pte Ltd</option>
                        <option value="CephasGM Brazil">CephasGM Brazil Ltda</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Local Regulatory Authority *</label>
                    <input type="text" id="incidentRegAuthority" readonly placeholder="Auto-fills based on country">
                </div>
                
                <div class="form-group">
                    <label>Applicable Local Laws</label>
                    <textarea id="incidentLocalLaws" readonly rows="2" placeholder="Auto-fills based on country"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Language for Documentation</label>
                    <select id="incidentLanguage">
                        <option value="en">English</option>
                        <option value="es">Spanish</option>
                        <option value="fr">French</option>
                        <option value="de">German</option>
                        <option value="ja">Japanese</option>
                        <option value="pt">Portuguese</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Local Emergency Contact</label>
                    <input type="text" id="incidentEmergencyContact" readonly placeholder="Auto-fills based on country">
                </div>
            </div>
            
            <div class="form-grid">
                <div class="form-group">
                    <label>Incident Type *</label>
                    <select id="incidentType" required>
                        <option value="">Select type</option>
                        <option value="Near Miss">Near Miss</option>
                        <option value="First Aid">First Aid</option>
                        <option value="Medical Treatment">Medical Treatment</option>
                        <option value="Lost Time Injury">Lost Time Injury</option>
                        <option value="Fatality">Fatality</option>
                        <option value="Property Damage">Property Damage</option>
                        <option value="Environmental Spill">Environmental Spill</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Severity Level *</label>
                    <select id="incidentSeverity" required>
                        <option value="">Select severity</option>
                        <option value="Minor">Minor</option>
                        <option value="Moderate">Moderate</option>
                        <option value="Major">Major</option>
                        <option value="Critical">Critical</option>
                        <option value="Catastrophic">Catastrophic</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Date & Time *</label>
                    <input type="datetime-local" id="incidentDateTime" required>
                </div>
                
                <div class="form-group">
                    <label>Location (Building, Floor, Area) *</label>
                    <input type="text" id="incidentLocation" placeholder="e.g., Building A, Floor 3, Warehouse" required>
                </div>
                
                <div class="form-group">
                    <label>Reported By *</label>
                    <input type="text" id="reportedBy" placeholder="Full name" required>
                </div>
                
                <div class="form-group">
                    <label>Reported Date & Time</label>
                    <input type="datetime-local" id="reportedDateTime" readonly>
                </div>
            </div>
            
            <div class="form-group">
                <label>Incident Description *</label>
                <textarea id="incidentDescription" rows="4" placeholder="Detailed description of what happened" required></textarea>
            </div>
            
            <div class="form-group">
                <label>Immediate Actions Taken</label>
                <textarea id="immediateActions" rows="3" placeholder="Actions taken immediately after incident"></textarea>
            </div>
            
            <h3>Injured Person Information</h3>
            <div class="form-grid">
                <div class="form-group">
                    <label>Injured Person Name(s)</label>
                    <input type="text" id="injuredNames" placeholder="Full name(s)">
                </div>
                
                <div class="form-group">
                    <label>Employee ID(s)</label>
                    <input type="text" id="injuredEmployeeIds" placeholder="Employee ID(s)">
                </div>
                
                <div class="form-group">
                    <label>Nature of Injury</label>
                    <select id="natureOfInjury">
                        <option value="">Select nature</option>
                        <option value="Cut/Laceration">Cut/Laceration</option>
                        <option value="Fracture">Fracture</option>
                        <option value="Burn">Burn</option>
                        <option value="Sprain/Strain">Sprain/Strain</option>
                        <option value="Concussion">Concussion</option>
                        <option value="Poisoning">Poisoning</option>
                        <option value="Respiratory">Respiratory</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Body Part Affected</label>
                    <input type="text" id="bodyPart" placeholder="e.g., Left hand, Head">
                </div>
                
                <div class="form-group">
                    <label>Days Lost (if LTI)</label>
                    <input type="number" id="daysLost" min="0" value="0">
                </div>
                
                <div class="form-group">
                    <label>Medical Treatment Received</label>
                    <textarea id="medicalTreatment" rows="2" placeholder="Details of medical treatment"></textarea>
                </div>
            </div>
            
            <h3>Witnesses & Evidence</h3>
            <div class="form-grid">
                <div class="form-group">
                    <label>Witness Names</label>
                    <input type="text" id="witnessNames" placeholder="Names separated by commas">
                </div>
                
                <div class="form-group">
                    <label>Witness Statements</label>
                    <textarea id="witnessStatements" rows="2" placeholder="Summary of witness statements"></textarea>
                </div>
            </div>
            
            <div class="form-group">
                <label>Upload Evidence (Photos, Reports, Documents)</label>
                <div class="file-upload-area" onclick="document.getElementById('incidentEvidence').click()">
                    <input type="file" id="incidentEvidence" style="display: none;" multiple accept=".pdf,.doc,.docx,.jpg,.png">
                    <div style="font-size: 3rem;">üìé</div>
                    <div style="margin: 1rem 0;">Click to upload evidence documents</div>
                    <div style="color: var(--text-light); font-size: 0.875rem;">Supported: PDF, DOC, JPG, PNG (Max 10MB each)</div>
                </div>
                <div class="file-list" id="incidentEvidenceList"></div>
            </div>
            
            <h3>Regulatory Notification</h3>
            <div class="form-grid">
                <div class="form-group">
                    <label>Regulatory Notification Required?</label>
                    <select id="regulatoryNotified">
                        <option value="No">No</option>
                        <option value="Yes">Yes</option>
                        <option value="Pending">Pending</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Notification Date</label>
                    <input type="date" id="regulatoryDate">
                </div>
                
                <div class="form-group">
                    <label>Regulatory Reference Number</label>
                    <input type="text" id="regulatoryReference" placeholder="Reference number">
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="submitIncidentReport()">Submit Report</button>
                <button class="btn btn-outline" onclick="closeModal('reportIncidentModal')">Cancel</button>
                <button class="btn btn-outline" onclick="saveAsDraft()">Save as Draft</button>
            </div>
        </div>
    </div>

    <!-- Incident Management Modal -->
    <div id="incidentModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('incidentModal')">√ó</button>
            <div class="modal-header">
                <h2>Global Incident Management System</h2>
                <p>Complete incident lifecycle management with investigation and corrective actions</p>
            </div>
            
            <div class="tab-container">
                <div class="tab-buttons">
                    <button class="tab-button active" onclick="switchIncidentTab('all')">All Incidents</button>
                    <button class="tab-button" onclick="switchIncidentTab('investigation')">Under Investigation</button>
                    <button class="tab-button" onclick="switchIncidentTab('corrective')">Corrective Actions</button>
                    <button class="tab-button" onclick="switchIncidentTab('statistics')">Statistics</button>
                </div>
                
                <div class="tab-content active" id="incidentAllTab">
                    <div class="filter-bar">
                        <div class="filter-group">
                            <label>Country:</label>
                            <select class="filter-select" onchange="filterModalIncidents()">
                                <option value="">All</option>
                                <option value="USA">USA</option>
                                <option value="UK">UK</option>
                                <option value="Germany">Germany</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Status:</label>
                            <select class="filter-select" onchange="filterModalIncidents()">
                                <option value="">All</option>
                                <option value="Reported">Reported</option>
                                <option value="Under Investigation">Under Investigation</option>
                                <option value="Resolved">Resolved</option>
                                <option value="Closed">Closed</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Severity:</label>
                            <select class="filter-select" onchange="filterModalIncidents()">
                                <option value="">All</option>
                                <option value="Minor">Minor</option>
                                <option value="Moderate">Moderate</option>
                                <option value="Major">Major</option>
                                <option value="Critical">Critical</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Country</th>
                                    <th>Type</th>
                                    <th>Date</th>
                                    <th>Location</th>
                                    <th>Severity</th>
                                    <th>Status</th>
                                    <th>Investigation</th>
                                    <th>Root Cause</th>
                                    <th>Corrective Actions</th>
                                    <th>Days Lost</th>
                                    <th>Regulatory</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="modalIncidentsTableBody">
                                <!-- Will be populated -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="tab-content" id="incidentInvestigationTab">
                    <h3>Active Investigations</h3>
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Incident ID</th>
                                    <th>Investigation Lead</th>
                                    <th>Team Members</th>
                                    <th>Start Date</th>
                                    <th>Findings</th>
                                    <th>Root Cause Category</th>
                                    <th>Contributing Factors</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="investigationTableBody">
                                <!-- Will be populated -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="tab-content" id="incidentCorrectiveTab">
                    <h3>Corrective & Preventive Actions</h3>
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Incident ID</th>
                                    <th>Action Type</th>
                                    <th>Description</th>
                                    <th>Owner</th>
                                    <th>Due Date</th>
                                    <th>Status</th>
                                    <th>Completion Date</th>
                                    <th>Effectiveness</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="correctiveTableBody">
                                <!-- Will be populated -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="tab-content" id="incidentStatisticsTab">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="modalLTIFR">0</div>
                            <div class="stat-label">LTIFR</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="modalTRIR">0</div>
                            <div class="stat-label">TRIR</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="modalSeverityRate">0</div>
                            <div class="stat-label">Severity Rate</div>
                        </div>
                    </div>
                    
                    <div class="chart-container" style="height: 300px;">
                        <canvas id="modalIncidentChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-outline" onclick="closeModal('incidentModal')">Close</button>
                <button class="btn btn-primary" onclick="openModal('reportIncidentModal')">+ Report New Incident</button>
                <button class="btn btn-outline" onclick="exportToExcel('incidents')">üì• Export All</button>
            </div>
        </div>
    </div>

    <!-- Risk Assessment Modal -->
    <div id="riskModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('riskModal')">√ó</button>
            <div class="modal-header">
                <h2>Global Risk Assessment Management</h2>
                <p>Comprehensive risk management with controls and residual risk tracking</p>
            </div>
            
            <div class="action-buttons" style="margin-bottom: 2rem;">
                <button class="btn btn-primary" onclick="addRisk()">+ Add New Risk</button>
                <button class="btn btn-success" onclick="saveRiskMatrix()">üíæ Save Matrix</button>
            </div>
            
            <div class="data-table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Risk ID</th>
                            <th>Country</th>
                            <th>Hazard Description</th>
                            <th>Hazard Category</th>
                            <th>Location/Activity</th>
                            <th>Initial Likelihood</th>
                            <th>Initial Severity</th>
                            <th>Initial Risk Level</th>
                            <th>Controls in Place</th>
                            <th>Control Effectiveness</th>
                            <th>Residual Likelihood</th>
                            <th>Residual Severity</th>
                            <th>Residual Risk Level</th>
                            <th>Action Required</th>
                            <th>Action Owner</th>
                            <th>Due Date</th>
                            <th>Status</th>
                            <th>Review Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="riskTableBody">
                        <!-- Will be populated -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- PPE Management Modal -->
    <div id="ppeModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('ppeModal')">√ó</button>
            <div class="modal-header">
                <h2>Global PPE Management System</h2>
                <p>Personal Protective Equipment inventory and compliance tracking</p>
            </div>
            
            <div class="action-buttons" style="margin-bottom: 2rem;">
                <button class="btn btn-primary" onclick="addPPEItem()">+ Add PPE Item</button>
                <button class="btn btn-outline" onclick="exportToExcel('ppe')">üì• Export</button>
            </div>
            
            <div class="data-table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>PPE ID</th>
                            <th>Item Name</th>
                            <th>Category</th>
                            <th>Size/Variant</th>
                            <th>Manufacturer</th>
                            <th>Model/Part</th>
                            <th>Certification</th>
                            <th>Expiry/Shelf Life</th>
                            <th>Storage Location</th>
                            <th>Stock Quantity</th>
                            <th>Reorder Level</th>
                            <th>Issued To</th>
                            <th>Issue Date</th>
                            <th>Return Date</th>
                            <th>Condition</th>
                            <th>Inspection Date</th>
                            <th>Inspected By</th>
                            <th>Result</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="ppeTableBody">
                        <!-- Will be populated -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Health Surveillance Modal -->
    <div id="healthModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('healthModal')">√ó</button>
            <div class="modal-header">
                <h2>Global Health Surveillance System</h2>
                <p>Employee health monitoring and wellness programs</p>
            </div>
            
            <div class="tab-container">
                <div class="tab-buttons">
                    <button class="tab-button active" onclick="switchHealthTab('records')">Health Records</button>
                    <button class="tab-button" onclick="switchHealthTab('exposure')">Exposure Monitoring</button>
                    <button class="tab-button" onclick="switchHealthTab('wellness')">Wellness Programs</button>
                    <button class="tab-button" onclick="switchHealthTab('attachments')">Attachments</button>
                </div>
                
                <div class="tab-content active" id="healthRecordsTab">
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Employee ID</th>
                                    <th>Name</th>
                                    <th>Country</th>
                                    <th>Department</th>
                                    <th>Surveillance Type</th>
                                    <th>Examination Date</th>
                                    <th>Examination Type</th>
                                    <th>Provider</th>
                                    <th>Results</th>
                                    <th>Fitness Certificate</th>
                                    <th>Expiry Date</th>
                                    <th>Restrictions</th>
                                    <th>Follow-up Required</th>
                                    <th>Follow-up Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="healthTableBody">
                                <!-- Will be populated -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="tab-content" id="exposureTab">
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Employee ID</th>
                                    <th>Monitoring Type</th>
                                    <th>Date</th>
                                    <th>Location</th>
                                    <th>Hazard</th>
                                    <th>Result</th>
                                    <th>Limit Exceeded</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="exposureTableBody">
                                <!-- Will be populated -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="tab-content" id="wellnessTab">
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Employee ID</th>
                                    <th>Program</th>
                                    <th>Activity</th>
                                    <th>Participation Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="wellnessTableBody">
                                <!-- Will be populated -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="tab-content" id="healthAttachmentsTab">
                    <div class="form-group">
                        <label>Select Employee</label>
                        <select id="healthEmployeeSelect" onchange="loadHealthAttachments()">
                            <option value="">Select employee</option>
                        </select>
                    </div>
                    
                    <div class="file-upload-area" onclick="document.getElementById('healthFileInput').click()">
                        <input type="file" id="healthFileInput" style="display: none;" multiple onchange="uploadHealthAttachment()">
                        <div style="font-size: 3rem;">üìé</div>
                        <div style="margin: 1rem 0;">Upload medical reports, certificates, etc.</div>
                    </div>
                    
                    <div class="file-list" id="healthAttachmentsList"></div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="addHealthRecord()">+ Add Record</button>
                <button class="btn btn-outline" onclick="closeModal('healthModal')">Close</button>
            </div>
        </div>
    </div>

    <!-- Contractor Safety Modal -->
    <div id="contractorModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('contractorModal')">√ó</button>
            <div class="modal-header">
                <h2>Global Contractor Safety Management</h2>
                <p>Contractor pre-qualification, permits, and performance monitoring</p>
            </div>
            
            <div class="tab-container">
                <div class="tab-buttons">
                    <button class="tab-button active" onclick="switchContractorTab('records')">Contractors</button>
                    <button class="tab-button" onclick="switchContractorTab('permits')">Permits</button>
                    <button class="tab-button" onclick="switchContractorTab('induction')">Inductions</button>
                    <button class="tab-button" onclick="switchContractorTab('attachments')">Documents</button>
                </div>
                
                <div class="tab-content active" id="contractorRecordsTab">
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Contractor ID</th>
                                    <th>Company Name</th>
                                    <th>Country</th>
                                    <th>Registration No.</th>
                                    <th>Contact Person</th>
                                    <th>Scope of Work</th>
                                    <th>Contract Start</th>
                                    <th>Contract End</th>
                                    <th>Pre-qualification</th>
                                    <th>Safety Rating</th>
                                    <th>Insurance Valid</th>
                                    <th>Safety Policy</th>
                                    <th>Training Records</th>
                                    <th>Performance Rating</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="contractorTableBody">
                                <!-- Will be populated -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="tab-content" id="contractorPermitsTab">
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Permit ID</th>
                                    <th>Contractor</th>
                                    <th>Permit Type</th>
                                    <th>Issue Date</th>
                                    <th>Expiry Date</th>
                                    <th>Issuer</th>
                                    <th>Holder</th>
                                    <th>Work Location</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="permitTableBody">
                                <!-- Will be populated -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="tab-content" id="contractorInductionTab">
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Contractor</th>
                                    <th>Worker Name</th>
                                    <th>Induction Date</th>
                                    <th>Completed By</th>
                                    <th>Expiry Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="inductionTableBody">
                                <!-- Will be populated -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="tab-content" id="contractorAttachmentsTab">
                    <div class="form-group">
                        <label>Select Contractor</label>
                        <select id="contractorSelect" onchange="loadContractorAttachments()">
                            <option value="">Select contractor</option>
                        </select>
                    </div>
                    
                    <div class="file-upload-area" onclick="document.getElementById('contractorFileInput').click()">
                        <input type="file" id="contractorFileInput" style="display: none;" multiple onchange="uploadContractorAttachment()">
                        <div style="font-size: 3rem;">üìé</div>
                        <div style="margin: 1rem 0;">Upload insurance, policies, certificates</div>
                    </div>
                    
                    <div class="file-list" id="contractorAttachmentsList"></div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="addContractor()">+ Add Contractor</button>
                <button class="btn btn-outline" onclick="closeModal('contractorModal')">Close</button>
            </div>
        </div>
    </div>

    <!-- Audit & Inspection Modal -->
    <div id="auditModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('auditModal')">√ó</button>
            <div class="modal-header">
                <h2>Global Audit & Inspection Management</h2>
                <p>Scheduled audits, findings tracking, and closure management</p>
            </div>
            
            <div class="tab-container">
                <div class="tab-buttons">
                    <button class="tab-button active" onclick="switchAuditTab('audits')">Audits</button>
                    <button class="tab-button" onclick="switchAuditTab('findings')">Findings</button>
                    <button class="tab-button" onclick="switchAuditTab('schedule')">Schedule</button>
                    <button class="tab-button" onclick="switchAuditTab('attachments')">Reports</button>
                </div>
                
                <div class="tab-content active" id="auditRecordsTab">
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Audit ID</th>
                                    <th>Country</th>
                                    <th>Type</th>
                                    <th>Title</th>
                                    <th>Scope/Area</th>
                                    <th>Scheduled Date</th>
                                    <th>Actual Date</th>
                                    <th>Auditor(s)</th>
                                    <th>Standard</th>
                                    <th>Status</th>
                                    <th>Score</th>
                                    <th>Findings Count</th>
                                    <th>Report</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="auditTableBody">
                                <!-- Will be populated -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="tab-content" id="auditFindingsTab">
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Finding ID</th>
                                    <th>Audit ID</th>
                                    <th>Finding Type</th>
                                    <th>Severity</th>
                                    <th>Description</th>
                                    <th>Corrective Action</th>
                                    <th>Owner</th>
                                    <th>Due Date</th>
                                    <th>Status</th>
                                    <th>Closure Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="findingsTableBody">
                                <!-- Will be populated -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="tab-content" id="auditScheduleTab">
                    <div class="calendar-view" id="auditCalendar">
                        <!-- Calendar will be generated -->
                    </div>
                </div>
                
                <div class="tab-content" id="auditAttachmentsTab">
                    <div class="form-group">
                        <label>Select Audit</label>
                        <select id="auditSelect" onchange="loadAuditAttachments()">
                            <option value="">Select audit</option>
                        </select>
                    </div>
                    
                    <div class="file-upload-area" onclick="document.getElementById('auditFileInput').click()">
                        <input type="file" id="auditFileInput" style="display: none;" multiple onchange="uploadAuditAttachment()">
                        <div style="font-size: 3rem;">üìé</div>
                        <div style="margin: 1rem 0;">Upload audit reports, evidence</div>
                    </div>
                    
                    <div class="file-list" id="auditAttachmentsList"></div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="addAudit()">+ Schedule Audit</button>
                <button class="btn btn-outline" onclick="closeModal('auditModal')">Close</button>
            </div>
        </div>
    </div>

    <!-- Standards Compliance Modal -->
    <div id="standardsModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('standardsModal')">√ó</button>
            <div class="modal-header">
                <h2>Global Standards & Compliance Management</h2>
                <p>International and national safety standards compliance tracking</p>
            </div>
            
            <div class="action-buttons" style="margin-bottom: 2rem;">
                <button class="btn btn-primary" onclick="addStandard()">+ Add Standard</button>
                <button class="btn btn-outline" onclick="exportToExcel('standards')">üì• Export</button>
            </div>
            
            <div class="data-table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Standard ID</th>
                            <th>Name</th>
                            <th>Issuing Body</th>
                            <th>Jurisdiction</th>
                            <th>Applicable Sites</th>
                            <th>Requirement</th>
                            <th>Compliance Status</th>
                            <th>Evidence</th>
                            <th>Last Review</th>
                            <th>Next Review</th>
                            <th>Responsible</th>
                            <th>Gaps/Notes</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="standardsTableBody">
                        <!-- Will be populated -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Training Management Modal -->
    <div id="trainingModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('trainingModal')">√ó</button>
            <div class="modal-header">
                <h2>Global Safety Training Management</h2>
                <p>Training courses, certifications, and competency tracking</p>
            </div>
            
            <div class="tab-container">
                <div class="tab-buttons">
                    <button class="tab-button active" onclick="switchTrainingTab('courses')">Courses</button>
                    <button class="tab-button" onclick="switchTrainingTab('records')">Training Records</button>
                    <button class="tab-button" onclick="switchTrainingTab('certifications')">Certifications</button>
                </div>
                
                <div class="tab-content active" id="trainingCoursesTab">
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Course ID</th>
                                    <th>Course Name</th>
                                    <th>Category</th>
                                    <th>Provider</th>
                                    <th>Trainer</th>
                                    <th>Duration</th>
                                    <th>Language</th>
                                    <th>Certification</th>
                                    <th>Validity Period</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="coursesTableBody">
                                <!-- Will be populated -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="tab-content" id="trainingRecordsTab">
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Employee ID</th>
                                    <th>Name</th>
                                    <th>Country</th>
                                    <th>Course</th>
                                    <th>Training Date</th>
                                    <th>Completion Status</th>
                                    <th>Assessment Score</th>
                                    <th>Certificate No.</th>
                                    <th>Certificate Expiry</th>
                                    <th>Refresher Due</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="trainingRecordsTableBody">
                                <!-- Will be populated -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="tab-content" id="certificationsTab">
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Certificate ID</th>
                                    <th>Employee</th>
                                    <th>Certification</th>
                                    <th>Issue Date</th>
                                    <th>Expiry Date</th>
                                    <th>Status</th>
                                    <th>Days to Expiry</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="certificationsTableBody">
                                <!-- Will be populated -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="addTraining()">+ Add Training</button>
                <button class="btn btn-outline" onclick="closeModal('trainingModal')">Close</button>
            </div>
        </div>
    </div>

    <!-- Emergency Preparedness Modal -->
    <div id="emergencyModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('emergencyModal')">√ó</button>
            <div class="modal-header">
                <h2>Global Emergency Preparedness</h2>
                <p>Drills, equipment checks, and emergency response planning</p>
            </div>
            
            <div class="tab-container">
                <div class="tab-buttons">
                    <button class="tab-button active" onclick="switchEmergencyTab('drills')">Drills</button>
                    <button class="tab-button" onclick="switchEmergencyTab('equipment')">Equipment</button>
                    <button class="tab-button" onclick="switchEmergencyTab('contacts')">Emergency Contacts</button>
                </div>
                
                <div class="tab-content active" id="drillsTab">
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Drill ID</th>
                                    <th>Country</th>
                                    <th>Type</th>
                                    <th>Date</th>
                                    <th>Location</th>
                                    <th>Scenario</th>
                                    <th>Duration</th>
                                    <th>Participants</th>
                                    <th>Evaluation</th>
                                    <th>Follow-up Actions</th>
                                    <th>Report</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="drillsTableBody">
                                <!-- Will be populated -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="tab-content" id="equipmentTab">
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Equipment ID</th>
                                    <th>Type</th>
                                    <th>Location</th>
                                    <th>Last Inspection</th>
                                    <th>Next Due</th>
                                    <th>Status</th>
                                    <th>Inspected By</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="emergencyEquipmentTableBody">
                                <!-- Will be populated -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="tab-content" id="contactsTab">
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Country</th>
                                    <th>Emergency Service</th>
                                    <th>Contact Number</th>
                                    <th>Alternative</th>
                                    <th>Updated</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="emergencyContactsTableBody">
                                <!-- Will be populated -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="addDrill()">+ Schedule Drill</button>
                <button class="btn btn-outline" onclick="closeModal('emergencyModal')">Close</button>
            </div>
        </div>
    </div>

    <!-- Analytics Modal -->
    <div id="analyticsModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('analyticsModal')">√ó</button>
            <div class="modal-header">
                <h2>Advanced Safety Analytics</h2>
                <p>Comprehensive analytics and predictive insights</p>
            </div>
            
            <div class="filter-bar">
                <div class="filter-group">
                    <label>Date Range:</label>
                    <select class="filter-select" id="analyticsDateRange" onchange="updateAnalytics()">
                        <option value="30">Last 30 Days</option>
                        <option value="90">Last 90 Days</option>
                        <option value="180">Last 6 Months</option>
                        <option value="365">Last Year</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Region:</label>
                    <select class="filter-select" id="analyticsRegion" onchange="updateAnalytics()">
                        <option value="all">All Regions</option>
                        <option value="NA">North America</option>
                        <option value="EU">Europe</option>
                        <option value="APAC">Asia Pacific</option>
                        <option value="LATAM">Latin America</option>
                        <option value="MEA">Middle East & Africa</option>
                    </select>
                </div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="analyticsLTIFR">0.0</div>
                    <div class="stat-label">LTIFR</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="analyticsTRIR">0.0</div>
                    <div class="stat-label">TRIR</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="analyticsSeverity">0</div>
                    <div class="stat-label">Severity Rate</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="analyticsCost">$0</div>
                    <div class="stat-label">Incident Costs</div>
                </div>
            </div>
            
            <div class="chart-container" style="height: 300px;">
                <canvas id="analyticsChart1"></canvas>
            </div>
            
            <div class="chart-container" style="height: 300px;">
                <canvas id="analyticsChart2"></canvas>
            </div>
        </div>
    </div>

    <!-- Reports Modal -->
    <div id="reportsModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('reportsModal')">√ó</button>
            <div class="modal-header">
                <h2>Safety Reports Dashboard</h2>
                <p>Generate and export comprehensive safety reports</p>
            </div>
            
            <div class="module-grid">
                <div class="module-card" onclick="generateReport('incident-summary')">
                    <div class="module-icon">üìä</div>
                    <h3>Incident Summary Report</h3>
                    <p>Summary of all incidents with trends and analysis</p>
                </div>
                
                <div class="module-card" onclick="generateReport('risk-profile')">
                    <div class="module-icon">‚ö†Ô∏è</div>
                    <h3>Risk Profile Report</h3>
                    <p>Current risk assessment status and controls</p>
                </div>
                
                <div class="module-card" onclick="generateReport('compliance-status')">
                    <div class="module-icon">‚úì</div>
                    <h3>Compliance Status Report</h3>
                    <p>Standards compliance and audit findings</p>
                </div>
                
                <div class="module-card" onclick="generateReport('training-status')">
                    <div class="module-icon">üéì</div>
                    <h3>Training Status Report</h3>
                    <p>Training completion and certification status</p>
                </div>
                
                <div class="module-card" onclick="generateReport('executive-dashboard')">
                    <div class="module-icon">üìà</div>
                    <h3>Executive Dashboard</h3>
                    <p>High-level KPIs for management</p>
                </div>
                
                <div class="module-card" onclick="generateReport('regulatory')">
                    <div class="module-icon">‚öñÔ∏è</div>
                    <h3>Regulatory Compliance Report</h3>
                    <p>Regulatory notifications and compliance</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let incidents = [];
        let risks = [];
        let ppeItems = [];
        let healthRecords = [];
        let contractors = [];
        let audits = [];
        let standards = [];
        let trainings = [];
        let drills = [];
        let emergencyContacts = [];
        let findings = [];
        let correctiveActions = [];
        let investigations = [];
        let exposureRecords = [];
        let wellnessRecords = [];
        let permits = [];
        let inductions = [];
        let certifications = [];
        let emergencyEquipment = [];
        let attachments = {
            incidents: {},
            health: {},
            contractor: {},
            audit: {},
            standards: {},
            training: {}
        };
        
        let incidentTrendChart = null;
        let analyticsChart1 = null;
        let analyticsChart2 = null;
        let modalIncidentChart = null;
        let editingCell = null;
        let currentChartType = 'line';
        let darkMode = false;
        let workerHours = 1000000; // Total hours worked for rate calculations
        let totalEmployees = 500;

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
            initializeCharts();
            loadAllTables();
            updateStatistics();
            generateHeatMap();
            loadRiskMatrix();
            setDefaultDates();
            loadEmergencyContacts();
            loadEmergencyEquipment();
        });

        function loadAllData() {
            // Load all data from localStorage with defaults
            incidents = JSON.parse(localStorage.getItem('globalIncidents')) || getDefaultIncidents();
            risks = JSON.parse(localStorage.getItem('globalRisks')) || getDefaultRisks();
            ppeItems = JSON.parse(localStorage.getItem('globalPPE')) || getDefaultPPE();
            healthRecords = JSON.parse(localStorage.getItem('globalHealth')) || getDefaultHealth();
            contractors = JSON.parse(localStorage.getItem('globalContractors')) || getDefaultContractors();
            audits = JSON.parse(localStorage.getItem('globalAudits')) || getDefaultAudits();
            standards = JSON.parse(localStorage.getItem('globalStandards')) || getDefaultStandards();
            trainings = JSON.parse(localStorage.getItem('globalTrainings')) || getDefaultTrainings();
            drills = JSON.parse(localStorage.getItem('globalDrills')) || getDefaultDrills();
            emergencyContacts = JSON.parse(localStorage.getItem('emergencyContacts')) || getDefaultEmergencyContacts();
            findings = JSON.parse(localStorage.getItem('auditFindings')) || [];
            correctiveActions = JSON.parse(localStorage.getItem('correctiveActions')) || [];
            investigations = JSON.parse(localStorage.getItem('investigations')) || [];
            exposureRecords = JSON.parse(localStorage.getItem('exposureRecords')) || [];
            wellnessRecords = JSON.parse(localStorage.getItem('wellnessRecords')) || [];
            permits = JSON.parse(localStorage.getItem('contractorPermits')) || [];
            inductions = JSON.parse(localStorage.getItem('contractorInductions')) || [];
            certifications = JSON.parse(localStorage.getItem('trainingCertifications')) || [];
            emergencyEquipment = JSON.parse(localStorage.getItem('emergencyEquipment')) || getDefaultEmergencyEquipment();
            attachments = JSON.parse(localStorage.getItem('safetyAttachments')) || {
                incidents: {}, health: {}, contractor: {}, audit: {}, standards: {}, training: {}
            };
            
            // Calculate worker hours (simulated)
            workerHours = incidents.length * 200000 + 1000000;
        }

        function getDefaultIncidents() {
            return [
                {
                    id: 'INC-2024-001',
                    country: 'USA',
                    region: 'NA',
                    entity: 'CephasGM USA',
                    regulatoryAuthority: 'OSHA',
                    localLaws: 'OSHA 29 CFR 1910',
                    language: 'en',
                    emergencyContact: '911',
                    type: 'Lost Time Injury',
                    severity: 'Major',
                    dateTime: '2024-01-15T10:30',
                    location: 'Building A, Floor 2, Manufacturing',
                    reportedBy: 'John Smith',
                    reportedDateTime: '2024-01-15T10:45',
                    description: 'Employee fell from ladder',
                    immediateActions: 'First aid administered, area secured',
                    injuredNames: 'Mike Johnson',
                    injuredEmployeeIds: 'EMP-1234',
                    natureOfInjury: 'Fracture',
                    bodyPart: 'Left arm',
                    daysLost: 15,
                    medicalTreatment: 'Hospital, cast applied',
                    witnessNames: 'Sarah Brown',
                    witnessStatements: 'Saw ladder slip',
                    status: 'Under Investigation',
                    investigationLead: 'Jane Doe',
                    investigationTeam: 'Safety Committee',
                    investigationStartDate: '2024-01-16',
                    investigationFindings: 'Ladder not properly maintained',
                    rootCauseCategory: 'Equipment Failure',
                    contributingFactors: 'No inspection program',
                    correctiveActions: 'Implement ladder inspection program',
                    correctiveActionOwner: 'Facilities Manager',
                    correctiveActionDue: '2024-02-01',
                    correctiveActionStatus: 'In Progress',
                    preventiveActions: 'Monthly equipment inspections',
                    regulatoryNotified: 'Yes',
                    regulatoryDate: '2024-01-16',
                    regulatoryReference: 'OSHA-2024-001',
                    lessonsLearned: 'Implement preventive maintenance',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 'INC-2024-002',
                    country: 'UK',
                    region: 'EU',
                    entity: 'CephasGM UK Ltd',
                    regulatoryAuthority: 'HSE',
                    localLaws: 'Health and Safety at Work Act',
                    language: 'en',
                    emergencyContact: '999',
                    type: 'Near Miss',
                    severity: 'Moderate',
                    dateTime: '2024-01-20T14:15',
                    location: 'Warehouse B',
                    reportedBy: 'Emma Watson',
                    reportedDateTime: '2024-01-20T14:30',
                    description: 'Forklift near miss with pedestrian',
                    immediateActions: 'Area cordoned off',
                    status: 'Resolved',
                    correctiveActions: 'Install pedestrian barriers',
                    correctiveActionOwner: 'Warehouse Manager',
                    correctiveActionDue: '2024-02-15',
                    correctiveActionStatus: 'Open'
                }
            ];
        }

        function getDefaultRisks() {
            return [
                {
                    id: 'RSK-001',
                    country: 'USA',
                    hazardDescription: 'Working at height',
                    hazardCategory: 'Physical',
                    location: 'Manufacturing Floor',
                    initialLikelihood: 'Possible',
                    initialSeverity: 'Major',
                    initialRiskLevel: 'High',
                    controlsInPlace: 'Guardrails, harness points',
                    controlEffectiveness: 'Partially Effective',
                    residualLikelihood: 'Unlikely',
                    residualSeverity: 'Moderate',
                    residualRiskLevel: 'Medium',
                    actionRequired: 'Install additional guardrails',
                    actionOwner: 'Engineering',
                    dueDate: '2024-03-01',
                    actionStatus: 'In Progress',
                    reviewDate: '2024-06-01'
                },
                {
                    id: 'RSK-002',
                    country: 'Germany',
                    hazardDescription: 'Chemical exposure',
                    hazardCategory: 'Chemical',
                    location: 'Lab',
                    initialLikelihood: 'Unlikely',
                    initialSeverity: 'Critical',
                    initialRiskLevel: 'Medium',
                    controlsInPlace: 'Ventilation, PPE',
                    controlEffectiveness: 'Effective',
                    residualLikelihood: 'Rare',
                    residualSeverity: 'Major',
                    residualRiskLevel: 'Low',
                    actionRequired: 'Monthly air monitoring',
                    actionOwner: 'Safety Officer',
                    dueDate: '2024-02-15',
                    actionStatus: 'Completed',
                    reviewDate: '2024-05-01'
                }
            ];
        }

        function getDefaultPPE() {
            return [
                {
                    id: 'PPE-001',
                    name: 'Safety Helmet',
                    category: 'Head',
                    sizeVariant: 'Universal',
                    manufacturer: '3M',
                    model: 'H-700',
                    certification: 'ANSI Z89.1',
                    expiryShelfLife: '5 years',
                    storageLocation: 'Warehouse A',
                    stockQuantity: 150,
                    reorderLevel: 50,
                    issuedTo: 'EMP-1234',
                    issueDate: '2024-01-15',
                    returnDate: '',
                    condition: 'Good',
                    inspectionDate: '2024-01-15',
                    inspectedBy: 'Safety Officer',
                    inspectionResult: 'Pass'
                }
            ];
        }

        function getDefaultHealth() {
            return [
                {
                    employeeId: 'EMP-1234',
                    name: 'John Smith',
                    country: 'USA',
                    department: 'Manufacturing',
                    surveillanceType: 'Periodic',
                    examinationDate: '2024-01-15',
                    examinationType: 'General Medical',
                    provider: 'Occupational Health Clinic',
                    results: 'Fit for duty',
                    fitnessCertificate: 'Yes',
                    certificateExpiry: '2025-01-15',
                    restrictions: 'None',
                    followUpRequired: 'No',
                    followUpDate: ''
                }
            ];
        }

        function getDefaultContractors() {
            return [
                {
                    id: 'CTR-001',
                    company: 'ABC Construction',
                    country: 'USA',
                    registrationNo: 'CON-12345',
                    contactPerson: 'Mike Brown',
                    scopeOfWork: 'Building Maintenance',
                    contractStart: '2024-01-01',
                    contractEnd: '2024-12-31',
                    preQualification: 'Approved',
                    safetyRating: 'A',
                    insuranceValid: 'Yes',
                    safetyPolicy: 'Yes',
                    trainingRecords: 'Yes',
                    performanceRating: '4.5'
                }
            ];
        }

        function getDefaultAudits() {
            return [
                {
                    id: 'AUD-001',
                    country: 'USA',
                    type: 'Internal',
                    title: 'Annual Safety Audit',
                    scopeArea: 'All Departments',
                    scheduledDate: '2024-03-15',
                    actualDate: '',
                    auditors: 'Safety Team',
                    standard: 'ISO 45001',
                    status: 'Scheduled',
                    score: '',
                    findingsCount: 0,
                    report: ''
                }
            ];
        }

        function getDefaultStandards() {
            return [
                {
                    id: 'STD-001',
                    name: 'ISO 45001:2018',
                    issuingBody: 'ISO',
                    jurisdiction: 'Global',
                    applicableSites: 'All',
                    requirement: 'OHS Management System',
                    complianceStatus: 'Compliant',
                    evidence: 'Certificate ISO-2024-001',
                    lastReview: '2024-01-15',
                    nextReview: '2025-01-15',
                    responsible: 'Safety Manager',
                    gaps: 'None'
                },
                {
                    id: 'STD-002',
                    name: 'OSHA 29 CFR 1910',
                    issuingBody: 'OSHA',
                    jurisdiction: 'USA',
                    applicableSites: 'US Operations',
                    requirement: 'General Industry Standards',
                    complianceStatus: 'Partially Compliant',
                    evidence: 'Audit Report 2024-001',
                    lastReview: '2024-02-01',
                    nextReview: '2024-08-01',
                    responsible: 'US Safety Officer',
                    gaps: 'Machine guarding updates needed'
                }
            ];
        }

        function getDefaultTrainings() {
            return [
                {
                    id: 'TRN-001',
                    name: 'Fire Safety Training',
                    category: 'Fire Safety',
                    provider: 'Internal',
                    trainer: 'John Doe',
                    duration: '4 hours',
                    language: 'English',
                    certification: 'Yes',
                    validityPeriod: '1 year'
                }
            ];
        }

        function getDefaultDrills() {
            return [
                {
                    id: 'DRL-001',
                    country: 'USA',
                    type: 'Fire Drill',
                    date: '2024-01-20',
                    location: 'Building A',
                    scenario: 'Office fire simulation',
                    duration: '15 minutes',
                    participants: 150,
                    evaluation: 'Good response time',
                    followUpActions: 'Additional signage needed',
                    report: 'drill-report-001.pdf'
                }
            ];
        }

        function getDefaultEmergencyContacts() {
            return [
                {
                    country: 'USA',
                    service: 'Police',
                    number: '911',
                    alternative: 'local police',
                    updated: '2024-01-01'
                },
                {
                    country: 'UK',
                    service: 'Emergency',
                    number: '999',
                    alternative: '111 (NHS)',
                    updated: '2024-01-01'
                },
                {
                    country: 'Germany',
                    service: 'Emergency',
                    number: '112',
                    alternative: '110 (Police)',
                    updated: '2024-01-01'
                }
            ];
        }

        function getDefaultEmergencyEquipment() {
            return [
                {
                    id: 'EQP-001',
                    type: 'Fire Extinguisher',
                    location: 'Building A - Floor 1',
                    lastInspection: '2024-01-15',
                    nextDue: '2024-07-15',
                    status: 'OK',
                    inspectedBy: 'Safety Officer'
                }
            ];
        }

        function saveAllData() {
            localStorage.setItem('globalIncidents', JSON.stringify(incidents));
            localStorage.setItem('globalRisks', JSON.stringify(risks));
            localStorage.setItem('globalPPE', JSON.stringify(ppeItems));
            localStorage.setItem('globalHealth', JSON.stringify(healthRecords));
            localStorage.setItem('globalContractors', JSON.stringify(contractors));
            localStorage.setItem('globalAudits', JSON.stringify(audits));
            localStorage.setItem('globalStandards', JSON.stringify(standards));
            localStorage.setItem('globalTrainings', JSON.stringify(trainings));
            localStorage.setItem('globalDrills', JSON.stringify(drills));
            localStorage.setItem('emergencyContacts', JSON.stringify(emergencyContacts));
            localStorage.setItem('auditFindings', JSON.stringify(findings));
            localStorage.setItem('correctiveActions', JSON.stringify(correctiveActions));
            localStorage.setItem('investigations', JSON.stringify(investigations));
            localStorage.setItem('exposureRecords', JSON.stringify(exposureRecords));
            localStorage.setItem('wellnessRecords', JSON.stringify(wellnessRecords));
            localStorage.setItem('contractorPermits', JSON.stringify(permits));
            localStorage.setItem('contractorInductions', JSON.stringify(inductions));
            localStorage.setItem('trainingCertifications', JSON.stringify(certifications));
            localStorage.setItem('emergencyEquipment', JSON.stringify(emergencyEquipment));
            localStorage.setItem('safetyAttachments', JSON.stringify(attachments));
        }

        function setDefaultDates() {
            const now = new Date();
            const endDate = new Date(now);
            const startDate = new Date(now);
            startDate.setMonth(startDate.getMonth() - 6);
            
            document.getElementById('startDate').valueAsDate = startDate;
            document.getElementById('endDate').valueAsDate = endDate;
            
            const reportedDateTime = document.getElementById('reportedDateTime');
            if (reportedDateTime) {
                const localDateTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000)
                    .toISOString().slice(0, 16);
                reportedDateTime.value = localDateTime;
            }
            
            const incidentDateTime = document.getElementById('incidentDateTime');
            if (incidentDateTime) {
                const localDateTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000)
                    .toISOString().slice(0, 16);
                incidentDateTime.value = localDateTime;
            }
        }

        function updateLocalRegulations() {
            const country = document.getElementById('incidentCountry').value;
            const regAuthority = document.getElementById('incidentRegAuthority');
            const localLaws = document.getElementById('incidentLocalLaws');
            const emergencyContact = document.getElementById('incidentEmergencyContact');
            
            const regulations = {
                'USA': { authority: 'OSHA', laws: 'OSHA 29 CFR 1910, 1926', emergency: '911' },
                'UK': { authority: 'HSE', laws: 'Health and Safety at Work Act 1974', emergency: '999' },
                'Germany': { authority: 'DGUV', laws: 'Arbeitsschutzgesetz (ArbSchG)', emergency: '112' },
                'France': { authority: 'INRS', laws: 'Code du travail', emergency: '112' },
                'Canada': { authority: 'CCOHS', laws: 'Canada Labour Code Part II', emergency: '911' },
                'Australia': { authority: 'Safe Work Australia', laws: 'Work Health and Safety Act', emergency: '000' },
                'Japan': { authority: 'JISHA', laws: 'Industrial Safety and Health Act', emergency: '119' },
                'Brazil': { authority: 'MTE', laws: 'NRs (Normas Regulamentadoras)', emergency: '190' },
                'South Africa': { authority: 'DOL', laws: 'OHSA Act 85 of 1993', emergency: '10177' },
                'UAE': { authority: 'OSHAD', laws: 'Abu Dhabi OSHAD-SF', emergency: '998' }
            };
            
            const reg = regulations[country] || { authority: '', laws: '', emergency: '' };
            
            if (regAuthority) regAuthority.value = reg.authority;
            if (localLaws) localLaws.value = reg.laws;
            if (emergencyContact) emergencyContact.value = reg.emergency;
        }

        function updateStatistics() {
            // Calculate LTIs
            const ltis = incidents.filter(i => i.type === 'Lost Time Injury').length;
            const ltifr = (ltis * 1000000) / workerHours;
            document.getElementById('ltifr').textContent = ltifr.toFixed(2);
            document.getElementById('ltiCount').textContent = ltis;
            document.getElementById('hoursWorked').textContent = workerHours.toLocaleString();
            
            // Calculate TRIR
            const recordables = incidents.filter(i => 
                ['Lost Time Injury', 'Medical Treatment', 'Fatality'].includes(i.type)
            ).length;
            const trir = (recordables * 200000) / workerHours;
            document.getElementById('trir').textContent = trir.toFixed(2);
            document.getElementById('recordableCount').textContent = recordables;
            
            // Calculate Severity Rate
            const totalDaysLost = incidents.reduce((sum, i) => sum + (parseInt(i.daysLost) || 0), 0);
            const severityRate = ltis > 0 ? Math.round(totalDaysLost / ltis) : 0;
            document.getElementById('severityRate').textContent = severityRate;
            document.getElementById('totalDaysLost').textContent = totalDaysLost;
            document.getElementById('avgDaysPerIncident').textContent = (ltis > 0 ? (totalDaysLost / ltis).toFixed(1) : 0);
            
            // Near Miss Rate
            const nearMisses = incidents.filter(i => i.type === 'Near Miss').length;
            document.getElementById('nearMissRate').textContent = nearMisses;
            document.getElementById('nearMissCount').textContent = nearMisses;
            
            // Training Completion
            const trainingsCompleted = Math.floor(totalEmployees * 0.85);
            document.getElementById('trainingCompletionRate').textContent = '85%';
            document.getElementById('trainingsCompleted').textContent = trainingsCompleted;
            document.getElementById('totalTrainings').textContent = totalEmployees;
            document.getElementById('certifiedCount').textContent = Math.floor(totalEmployees * 0.78);
            
            // PPE Compliance
            document.getElementById('ppeComplianceRate').textContent = '92%';
            document.getElementById('ppeObservations').textContent = '250';
            document.getElementById('ppeCompliant').textContent = '230';
            
            // Audit Closure Rate
            const totalFindings = 45;
            const closedFindings = 32;
            const closureRate = Math.round((closedFindings / totalFindings) * 100);
            document.getElementById('auditClosureRate').textContent = closureRate + '%';
            document.getElementById('closedFindings').textContent = closedFindings;
            document.getElementById('totalFindings').textContent = totalFindings;
            document.getElementById('overdueFindings').textContent = '8';
            
            // Risk Assessment
            document.getElementById('riskAssessmentRate').textContent = '78%';
            document.getElementById('assessedRisks').textContent = '78';
            document.getElementById('totalRisks').textContent = '100';
            document.getElementById('criticalRisks').textContent = '12';
        }

        function initializeCharts() {
            const ctx = document.getElementById('incidentTrendChart').getContext('2d');
            
            // Generate data for the last 6 months by region
            const months = [];
            const naData = [];
            const euData = [];
            const apacData = [];
            const latamData = [];
            const meaData = [];
            
            const endDate = new Date();
            const startDate = new Date();
            startDate.setMonth(startDate.getMonth() - 6);
            
            let currentDate = new Date(startDate);
            while (currentDate <= endDate) {
                const monthName = currentDate.toLocaleString('default', { month: 'short' });
                months.push(monthName);
                
                naData.push(Math.floor(Math.random() * 8) + 2);
                euData.push(Math.floor(Math.random() * 6) + 1);
                apacData.push(Math.floor(Math.random() * 5) + 1);
                latamData.push(Math.floor(Math.random() * 4) + 0);
                meaData.push(Math.floor(Math.random() * 3) + 0);
                
                currentDate.setMonth(currentDate.getMonth() + 1);
            }
            
            incidentTrendChart = new Chart(ctx, {
                type: currentChartType,
                data: {
                    labels: months,
                    datasets: [
                        { label: 'North America', data: naData, borderColor: '#ef4444', backgroundColor: '#ef4444' },
                        { label: 'Europe', data: euData, borderColor: '#f59e0b', backgroundColor: '#f59e0b' },
                        { label: 'Asia Pacific', data: apacData, borderColor: '#10b981', backgroundColor: '#10b981' },
                        { label: 'Latin America', data: latamData, borderColor: '#3b82f6', backgroundColor: '#3b82f6' },
                        { label: 'MEA', data: meaData, borderColor: '#8b5cf6', backgroundColor: '#8b5cf6' }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' }
                    },
                    scales: { y: { beginAtZero: true } }
                }
            });
        }

        function changeChartType(type) {
            currentChartType = type;
            document.querySelectorAll('.chart-type-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            incidentTrendChart.destroy();
            initializeCharts();
        }

        function updateChartWithCustomRange() {
            showToast('Chart Updated', 'Data range applied successfully', 'success');
        }

        function updateChartWithFilters() {
            showToast('Filters Applied', 'Chart filtered by region', 'success');
        }

        function generateHeatMap() {
            const heatMap = document.getElementById('incidentHeatMap');
            if (!heatMap) return;
            
            const regions = [
                { name: 'North America', value: Math.floor(Math.random() * 50) + 20, color: '#ef4444' },
                { name: 'Europe', value: Math.floor(Math.random() * 40) + 15, color: '#f59e0b' },
                { name: 'Asia Pacific', value: Math.floor(Math.random() * 60) + 25, color: '#10b981' },
                { name: 'Latin America', value: Math.floor(Math.random() * 30) + 10, color: '#3b82f6' },
                { name: 'Middle East & Africa', value: Math.floor(Math.random() * 25) + 5, color: '#8b5cf6' }
            ];
            
            heatMap.innerHTML = '';
            regions.forEach(region => {
                const intensity = Math.min(region.value, 100);
                const cell = document.createElement('div');
                cell.className = 'heat-cell';
                cell.style.background = `${region.color}${Math.floor(intensity * 2.55).toString(16).padStart(2, '0')}`;
                cell.innerHTML = `<div>${region.name}</div><div style="font-size: 1.5rem;">${region.value}</div><div>incidents</div>`;
                cell.onclick = () => openModalWithFilter('incidentModal', 'region', region.name);
                heatMap.appendChild(cell);
            });
        }

        function refreshHeatMap() {
            generateHeatMap();
            showToast('Heat Map Updated', 'Real-time incident data loaded', 'success');
        }

        function loadAllTables() {
            loadIncidentsTable();
            loadRiskTable();
            loadPPETable();
            loadHealthTable();
            loadContractorTable();
            loadAuditTable();
            loadStandardsTable();
            loadTrainingTables();
            loadDrillsTable();
            loadEmergencyEquipment();
            loadInvestigationsTable();
            loadCorrectiveActionsTable();
        }

        function loadIncidentsTable() {
            const table = document.getElementById('incidentsTableBody');
            const modalTable = document.getElementById('modalIncidentsTableBody');
            
            if (table) {
                table.innerHTML = '';
                incidents.forEach((incident, index) => {
                    const row = document.createElement('tr');
                    const date = new Date(incident.dateTime);
                    const formattedDate = date.toLocaleDateString('en-US', {
                        month: 'short', day: 'numeric', year: 'numeric', hour: '2-digit', minute: '2-digit'
                    });
                    
                    row.innerHTML = `
                        <td class="editable" onclick="editTableCell(this, 'incidents', ${index}, 'id')">${incident.id}</td>
                        <td class="editable" onclick="editTableCell(this, 'incidents', ${index}, 'country')">${incident.country || 'USA'}</td>
                        <td class="editable" onclick="editTableCell(this, 'incidents', ${index}, 'entity')">${incident.entity || 'CephasGM USA'}</td>
                        <td class="editable" onclick="editTableCell(this, 'incidents', ${index}, 'region')">${incident.region || 'NA'}</td>
                        <td class="editable" onclick="editTableCell(this, 'incidents', ${index}, 'type')">${incident.type}</td>
                        <td class="editable" onclick="editTableCell(this, 'incidents', ${index}, 'dateTime')">${formattedDate}</td>
                        <td class="editable" onclick="editTableCell(this, 'incidents', ${index}, 'location')">${incident.location}</td>
                        <td class="editable" onclick="editTableCell(this, 'incidents', ${index}, 'reportedBy')">${incident.reportedBy}</td>
                        <td class="editable" onclick="editTableCell(this, 'incidents', ${index}, 'severity')">${incident.severity}</td>
                        <td class="editable" onclick="editTableCell(this, 'incidents', ${index}, 'status')">${incident.status}</td>
                        <td class="editable" onclick="editTableCell(this, 'incidents', ${index}, 'investigationLead')">${incident.investigationLead || '-'}</td>
                        <td class="editable" onclick="editTableCell(this, 'incidents', ${index}, 'rootCauseCategory')">${incident.rootCauseCategory || '-'}</td>
                        <td class="editable" onclick="editTableCell(this, 'incidents', ${index}, 'correctiveActions')">${incident.correctiveActions || '-'}</td>
                        <td class="editable" onclick="editTableCell(this, 'incidents', ${index}, 'injuredNames')">${incident.injuredNames || '-'}</td>
                        <td class="editable" onclick="editTableCell(this, 'incidents', ${index}, 'natureOfInjury')">${incident.natureOfInjury || '-'}</td>
                        <td class="editable" onclick="editTableCell(this, 'incidents', ${index}, 'daysLost')">${incident.daysLost || 0}</td>
                        <td class="editable" onclick="editTableCell(this, 'incidents', ${index}, 'regulatoryNotified')">${incident.regulatoryNotified || 'No'}</td>
                        <td>
                            <button class="btn btn-sm btn-outline" onclick="openIncidentDetails(${index})">View</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteItem('incidents', ${index})">Delete</button>
                        </td>
                    `;
                    table.appendChild(row);
                });
            }
            
            if (modalTable) {
                modalTable.innerHTML = '';
                incidents.slice(0, 10).forEach((incident, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${incident.id}</td>
                        <td>${incident.country || 'USA'}</td>
                        <td>${incident.type}</td>
                        <td>${new Date(incident.dateTime).toLocaleDateString()}</td>
                        <td>${incident.location}</td>
                        <td>${incident.severity}</td>
                        <td>${incident.status}</td>
                        <td>${incident.investigationLead || '-'}</td>
                        <td>${incident.rootCauseCategory || '-'}</td>
                        <td>${incident.correctiveActions || '-'}</td>
                        <td>${incident.daysLost || 0}</td>
                        <td>${incident.regulatoryNotified || 'No'}</td>
                        <td>
                            <button class="btn btn-sm btn-outline" onclick="editIncident(${index})">Edit</button>
                        </td>
                    `;
                    modalTable.appendChild(row);
                });
            }
        }

        function loadRiskTable() {
            const table = document.getElementById('riskTableBody');
            if (!table) return;
            
            table.innerHTML = '';
            risks.forEach((risk, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="editable" onclick="editTableCell(this, 'risks', ${index}, 'id')">${risk.id}</td>
                    <td class="editable" onclick="editTableCell(this, 'risks', ${index}, 'country')">${risk.country}</td>
                    <td class="editable" onclick="editTableCell(this, 'risks', ${index}, 'hazardDescription')">${risk.hazardDescription}</td>
                    <td class="editable" onclick="editTableCell(this, 'risks', ${index}, 'hazardCategory')">${risk.hazardCategory}</td>
                    <td class="editable" onclick="editTableCell(this, 'risks', ${index}, 'location')">${risk.location}</td>
                    <td class="editable" onclick="editTableCell(this, 'risks', ${index}, 'initialLikelihood')">${risk.initialLikelihood}</td>
                    <td class="editable" onclick="editTableCell(this, 'risks', ${index}, 'initialSeverity')">${risk.initialSeverity}</td>
                    <td class="editable" onclick="editTableCell(this, 'risks', ${index}, 'initialRiskLevel')"><span class="badge ${getRiskBadgeClass(risk.initialRiskLevel)}">${risk.initialRiskLevel}</span></td>
                    <td class="editable" onclick="editTableCell(this, 'risks', ${index}, 'controlsInPlace')">${risk.controlsInPlace}</td>
                    <td class="editable" onclick="editTableCell(this, 'risks', ${index}, 'controlEffectiveness')">${risk.controlEffectiveness}</td>
                    <td class="editable" onclick="editTableCell(this, 'risks', ${index}, 'residualLikelihood')">${risk.residualLikelihood}</td>
                    <td class="editable" onclick="editTableCell(this, 'risks', ${index}, 'residualSeverity')">${risk.residualSeverity}</td>
                    <td class="editable" onclick="editTableCell(this, 'risks', ${index}, 'residualRiskLevel')"><span class="badge ${getRiskBadgeClass(risk.residualRiskLevel)}">${risk.residualRiskLevel}</span></td>
                    <td class="editable" onclick="editTableCell(this, 'risks', ${index}, 'actionRequired')">${risk.actionRequired}</td>
                    <td class="editable" onclick="editTableCell(this, 'risks', ${index}, 'actionOwner')">${risk.actionOwner}</td>
                    <td class="editable" onclick="editTableCell(this, 'risks', ${index}, 'dueDate')">${risk.dueDate}</td>
                    <td class="editable" onclick="editTableCell(this, 'risks', ${index}, 'actionStatus')"><span class="badge ${getStatusBadgeClass(risk.actionStatus)}">${risk.actionStatus}</span></td>
                    <td class="editable" onclick="editTableCell(this, 'risks', ${index}, 'reviewDate')">${risk.reviewDate}</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteItem('risks', ${index})">Delete</button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function loadPPETable() {
            const table = document.getElementById('ppeTableBody');
            if (!table) return;
            
            table.innerHTML = '';
            ppeItems.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="editable" onclick="editTableCell(this, 'ppeItems', ${index}, 'id')">${item.id}</td>
                    <td class="editable" onclick="editTableCell(this, 'ppeItems', ${index}, 'name')">${item.name}</td>
                    <td class="editable" onclick="editTableCell(this, 'ppeItems', ${index}, 'category')">${item.category}</td>
                    <td class="editable" onclick="editTableCell(this, 'ppeItems', ${index}, 'sizeVariant')">${item.sizeVariant}</td>
                    <td class="editable" onclick="editTableCell(this, 'ppeItems', ${index}, 'manufacturer')">${item.manufacturer}</td>
                    <td class="editable" onclick="editTableCell(this, 'ppeItems', ${index}, 'model')">${item.model}</td>
                    <td class="editable" onclick="editTableCell(this, 'ppeItems', ${index}, 'certification')">${item.certification}</td>
                    <td class="editable" onclick="editTableCell(this, 'ppeItems', ${index}, 'expiryShelfLife')">${item.expiryShelfLife}</td>
                    <td class="editable" onclick="editTableCell(this, 'ppeItems', ${index}, 'storageLocation')">${item.storageLocation}</td>
                    <td class="editable" onclick="editTableCell(this, 'ppeItems', ${index}, 'stockQuantity')">${item.stockQuantity}</td>
                    <td class="editable" onclick="editTableCell(this, 'ppeItems', ${index}, 'reorderLevel')">${item.reorderLevel}</td>
                    <td class="editable" onclick="editTableCell(this, 'ppeItems', ${index}, 'issuedTo')">${item.issuedTo || '-'}</td>
                    <td class="editable" onclick="editTableCell(this, 'ppeItems', ${index}, 'issueDate')">${item.issueDate || '-'}</td>
                    <td class="editable" onclick="editTableCell(this, 'ppeItems', ${index}, 'returnDate')">${item.returnDate || '-'}</td>
                    <td class="editable" onclick="editTableCell(this, 'ppeItems', ${index}, 'condition')">${item.condition}</td>
                    <td class="editable" onclick="editTableCell(this, 'ppeItems', ${index}, 'inspectionDate')">${item.inspectionDate}</td>
                    <td class="editable" onclick="editTableCell(this, 'ppeItems', ${index}, 'inspectedBy')">${item.inspectedBy}</td>
                    <td class="editable" onclick="editTableCell(this, 'ppeItems', ${index}, 'inspectionResult')"><span class="badge ${item.inspectionResult === 'Pass' ? 'badge-success' : 'badge-error'}">${item.inspectionResult}</span></td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteItem('ppeItems', ${index})">Delete</button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function loadHealthTable() {
            const table = document.getElementById('healthTableBody');
            if (!table) return;
            
            table.innerHTML = '';
            healthRecords.forEach((record, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="editable" onclick="editTableCell(this, 'healthRecords', ${index}, 'employeeId')">${record.employeeId}</td>
                    <td class="editable" onclick="editTableCell(this, 'healthRecords', ${index}, 'name')">${record.name}</td>
                    <td class="editable" onclick="editTableCell(this, 'healthRecords', ${index}, 'country')">${record.country}</td>
                    <td class="editable" onclick="editTableCell(this, 'healthRecords', ${index}, 'department')">${record.department}</td>
                    <td class="editable" onclick="editTableCell(this, 'healthRecords', ${index}, 'surveillanceType')">${record.surveillanceType}</td>
                    <td class="editable" onclick="editTableCell(this, 'healthRecords', ${index}, 'examinationDate')">${record.examinationDate}</td>
                    <td class="editable" onclick="editTableCell(this, 'healthRecords', ${index}, 'examinationType')">${record.examinationType}</td>
                    <td class="editable" onclick="editTableCell(this, 'healthRecords', ${index}, 'provider')">${record.provider}</td>
                    <td class="editable" onclick="editTableCell(this, 'healthRecords', ${index}, 'results')">${record.results}</td>
                    <td class="editable" onclick="editTableCell(this, 'healthRecords', ${index}, 'fitnessCertificate')">${record.fitnessCertificate}</td>
                    <td class="editable" onclick="editTableCell(this, 'healthRecords', ${index}, 'certificateExpiry')">${record.certificateExpiry}</td>
                    <td class="editable" onclick="editTableCell(this, 'healthRecords', ${index}, 'restrictions')">${record.restrictions || 'None'}</td>
                    <td class="editable" onclick="editTableCell(this, 'healthRecords', ${index}, 'followUpRequired')">${record.followUpRequired}</td>
                    <td class="editable" onclick="editTableCell(this, 'healthRecords', ${index}, 'followUpDate')">${record.followUpDate || '-'}</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteItem('healthRecords', ${index})">Delete</button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function loadContractorTable() {
            const table = document.getElementById('contractorTableBody');
            if (!table) return;
            
            table.innerHTML = '';
            contractors.forEach((contractor, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="editable" onclick="editTableCell(this, 'contractors', ${index}, 'id')">${contractor.id}</td>
                    <td class="editable" onclick="editTableCell(this, 'contractors', ${index}, 'company')">${contractor.company}</td>
                    <td class="editable" onclick="editTableCell(this, 'contractors', ${index}, 'country')">${contractor.country}</td>
                    <td class="editable" onclick="editTableCell(this, 'contractors', ${index}, 'registrationNo')">${contractor.registrationNo}</td>
                    <td class="editable" onclick="editTableCell(this, 'contractors', ${index}, 'contactPerson')">${contractor.contactPerson}</td>
                    <td class="editable" onclick="editTableCell(this, 'contractors', ${index}, 'scopeOfWork')">${contractor.scopeOfWork}</td>
                    <td class="editable" onclick="editTableCell(this, 'contractors', ${index}, 'contractStart')">${contractor.contractStart}</td>
                    <td class="editable" onclick="editTableCell(this, 'contractors', ${index}, 'contractEnd')">${contractor.contractEnd}</td>
                    <td class="editable" onclick="editTableCell(this, 'contractors', ${index}, 'preQualification')"><span class="badge ${contractor.preQualification === 'Approved' ? 'badge-success' : 'badge-warning'}">${contractor.preQualification}</span></td>
                    <td class="editable" onclick="editTableCell(this, 'contractors', ${index}, 'safetyRating')">${contractor.safetyRating}</td>
                    <td class="editable" onclick="editTableCell(this, 'contractors', ${index}, 'insuranceValid')">${contractor.insuranceValid}</td>
                    <td class="editable" onclick="editTableCell(this, 'contractors', ${index}, 'safetyPolicy')">${contractor.safetyPolicy}</td>
                    <td class="editable" onclick="editTableCell(this, 'contractors', ${index}, 'trainingRecords')">${contractor.trainingRecords}</td>
                    <td class="editable" onclick="editTableCell(this, 'contractors', ${index}, 'performanceRating')">${contractor.performanceRating}</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteItem('contractors', ${index})">Delete</button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function loadAuditTable() {
            const table = document.getElementById('auditTableBody');
            if (!table) return;
            
            table.innerHTML = '';
            audits.forEach((audit, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="editable" onclick="editTableCell(this, 'audits', ${index}, 'id')">${audit.id}</td>
                    <td class="editable" onclick="editTableCell(this, 'audits', ${index}, 'country')">${audit.country}</td>
                    <td class="editable" onclick="editTableCell(this, 'audits', ${index}, 'type')">${audit.type}</td>
                    <td class="editable" onclick="editTableCell(this, 'audits', ${index}, 'title')">${audit.title}</td>
                    <td class="editable" onclick="editTableCell(this, 'audits', ${index}, 'scopeArea')">${audit.scopeArea}</td>
                    <td class="editable" onclick="editTableCell(this, 'audits', ${index}, 'scheduledDate')">${audit.scheduledDate}</td>
                    <td class="editable" onclick="editTableCell(this, 'audits', ${index}, 'actualDate')">${audit.actualDate || '-'}</td>
                    <td class="editable" onclick="editTableCell(this, 'audits', ${index}, 'auditors')">${audit.auditors}</td>
                    <td class="editable" onclick="editTableCell(this, 'audits', ${index}, 'standard')">${audit.standard}</td>
                    <td class="editable" onclick="editTableCell(this, 'audits', ${index}, 'status')"><span class="badge ${getStatusBadgeClass(audit.status)}">${audit.status}</span></td>
                    <td class="editable" onclick="editTableCell(this, 'audits', ${index}, 'score')">${audit.score || '-'}</td>
                    <td class="editable" onclick="editTableCell(this, 'audits', ${index}, 'findingsCount')">${audit.findingsCount}</td>
                    <td class="editable" onclick="editTableCell(this, 'audits', ${index}, 'report')">${audit.report || '-'}</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteItem('audits', ${index})">Delete</button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function loadStandardsTable() {
            const table = document.getElementById('standardsTableBody');
            if (!table) return;
            
            table.innerHTML = '';
            standards.forEach((standard, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="editable" onclick="editTableCell(this, 'standards', ${index}, 'id')">${standard.id}</td>
                    <td class="editable" onclick="editTableCell(this, 'standards', ${index}, 'name')">${standard.name}</td>
                    <td class="editable" onclick="editTableCell(this, 'standards', ${index}, 'issuingBody')">${standard.issuingBody}</td>
                    <td class="editable" onclick="editTableCell(this, 'standards', ${index}, 'jurisdiction')">${standard.jurisdiction}</td>
                    <td class="editable" onclick="editTableCell(this, 'standards', ${index}, 'applicableSites')">${standard.applicableSites}</td>
                    <td class="editable" onclick="editTableCell(this, 'standards', ${index}, 'requirement')">${standard.requirement}</td>
                    <td class="editable" onclick="editTableCell(this, 'standards', ${index}, 'complianceStatus')"><span class="badge ${getComplianceBadgeClass(standard.complianceStatus)}">${standard.complianceStatus}</span></td>
                    <td class="editable" onclick="editTableCell(this, 'standards', ${index}, 'evidence')">${standard.evidence}</td>
                    <td class="editable" onclick="editTableCell(this, 'standards', ${index}, 'lastReview')">${standard.lastReview}</td>
                    <td class="editable" onclick="editTableCell(this, 'standards', ${index}, 'nextReview')">${standard.nextReview}</td>
                    <td class="editable" onclick="editTableCell(this, 'standards', ${index}, 'responsible')">${standard.responsible}</td>
                    <td class="editable" onclick="editTableCell(this, 'standards', ${index}, 'gaps')">${standard.gaps || 'None'}</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteItem('standards', ${index})">Delete</button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function loadTrainingTables() {
            const coursesTable = document.getElementById('coursesTableBody');
            if (coursesTable) {
                coursesTable.innerHTML = '';
                trainings.forEach((training, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="editable" onclick="editTableCell(this, 'trainings', ${index}, 'id')">${training.id}</td>
                        <td class="editable" onclick="editTableCell(this, 'trainings', ${index}, 'name')">${training.name}</td>
                        <td class="editable" onclick="editTableCell(this, 'trainings', ${index}, 'category')">${training.category}</td>
                        <td class="editable" onclick="editTableCell(this, 'trainings', ${index}, 'provider')">${training.provider}</td>
                        <td class="editable" onclick="editTableCell(this, 'trainings', ${index}, 'trainer')">${training.trainer}</td>
                        <td class="editable" onclick="editTableCell(this, 'trainings', ${index}, 'duration')">${training.duration}</td>
                        <td class="editable" onclick="editTableCell(this, 'trainings', ${index}, 'language')">${training.language}</td>
                        <td class="editable" onclick="editTableCell(this, 'trainings', ${index}, 'certification')">${training.certification}</td>
                        <td class="editable" onclick="editTableCell(this, 'trainings', ${index}, 'validityPeriod')">${training.validityPeriod}</td>
                        <td>
                            <button class="btn btn-sm btn-danger" onclick="deleteItem('trainings', ${index})">Delete</button>
                        </td>
                    `;
                    coursesTable.appendChild(row);
                });
            }
            
            const recordsTable = document.getElementById('trainingRecordsTableBody');
            if (recordsTable) {
                recordsTable.innerHTML = '<tr><td colspan="11" style="text-align: center;">Training records will appear here</td></tr>';
            }
            
            const certsTable = document.getElementById('certificationsTableBody');
            if (certsTable) {
                certsTable.innerHTML = '<tr><td colspan="8" style="text-align: center;">Certifications will appear here</td></tr>';
            }
        }

        function loadDrillsTable() {
            const table = document.getElementById('drillsTableBody');
            if (!table) return;
            
            table.innerHTML = '';
            drills.forEach((drill, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="editable" onclick="editTableCell(this, 'drills', ${index}, 'id')">${drill.id}</td>
                    <td class="editable" onclick="editTableCell(this, 'drills', ${index}, 'country')">${drill.country}</td>
                    <td class="editable" onclick="editTableCell(this, 'drills', ${index}, 'type')">${drill.type}</td>
                    <td class="editable" onclick="editTableCell(this, 'drills', ${index}, 'date')">${drill.date}</td>
                    <td class="editable" onclick="editTableCell(this, 'drills', ${index}, 'location')">${drill.location}</td>
                    <td class="editable" onclick="editTableCell(this, 'drills', ${index}, 'scenario')">${drill.scenario}</td>
                    <td class="editable" onclick="editTableCell(this, 'drills', ${index}, 'duration')">${drill.duration}</td>
                    <td class="editable" onclick="editTableCell(this, 'drills', ${index}, 'participants')">${drill.participants}</td>
                    <td class="editable" onclick="editTableCell(this, 'drills', ${index}, 'evaluation')">${drill.evaluation}</td>
                    <td class="editable" onclick="editTableCell(this, 'drills', ${index}, 'followUpActions')">${drill.followUpActions}</td>
                    <td class="editable" onclick="editTableCell(this, 'drills', ${index}, 'report')">${drill.report || '-'}</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteItem('drills', ${index})">Delete</button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function loadInvestigationsTable() {
            const table = document.getElementById('investigationTableBody');
            if (!table) return;
            
            table.innerHTML = '';
            const activeInvestigations = incidents.filter(i => i.status === 'Under Investigation');
            activeInvestigations.forEach((incident, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${incident.id}</td>
                    <td class="editable" onclick="editTableCell(this, 'incidents', ${incidents.indexOf(incident)}, 'investigationLead')">${incident.investigationLead || 'Unassigned'}</td>
                    <td class="editable" onclick="editTableCell(this, 'incidents', ${incidents.indexOf(incident)}, 'investigationTeam')">${incident.investigationTeam || '-'}</td>
                    <td class="editable" onclick="editTableCell(this, 'incidents', ${incidents.indexOf(incident)}, 'investigationStartDate')">${incident.investigationStartDate || '-'}</td>
                    <td class="editable" onclick="editTableCell(this, 'incidents', ${incidents.indexOf(incident)}, 'investigationFindings')">${incident.investigationFindings || '-'}</td>
                    <td class="editable" onclick="editTableCell(this, 'incidents', ${incidents.indexOf(incident)}, 'rootCauseCategory')">${incident.rootCauseCategory || '-'}</td>
                    <td class="editable" onclick="editTableCell(this, 'incidents', ${incidents.indexOf(incident)}, 'contributingFactors')">${incident.contributingFactors || '-'}</td>
                    <td><span class="badge badge-warning">In Progress</span></td>
                    <td>
                        <button class="btn btn-sm btn-outline" onclick="updateInvestigation(${incidents.indexOf(incident)})">Update</button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function loadCorrectiveActionsTable() {
            const table = document.getElementById('correctiveTableBody');
            if (!table) return;
            
            table.innerHTML = '';
            const actions = incidents.filter(i => i.correctiveActions && i.correctiveActionStatus !== 'Completed');
            actions.forEach((incident, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${incident.id}</td>
                    <td>Corrective</td>
                    <td class="editable" onclick="editTableCell(this, 'incidents', ${incidents.indexOf(incident)}, 'correctiveActions')">${incident.correctiveActions}</td>
                    <td class="editable" onclick="editTableCell(this, 'incidents', ${incidents.indexOf(incident)}, 'correctiveActionOwner')">${incident.correctiveActionOwner || 'Unassigned'}</td>
                    <td class="editable" onclick="editTableCell(this, 'incidents', ${incidents.indexOf(incident)}, 'correctiveActionDue')">${incident.correctiveActionDue || '-'}</td>
                    <td><span class="badge ${incident.correctiveActionStatus === 'Overdue' ? 'badge-error' : 'badge-warning'}">${incident.correctiveActionStatus || 'Open'}</span></td>
                    <td>-</td>
                    <td>-</td>
                    <td>
                        <button class="btn btn-sm btn-outline" onclick="completeAction(${incidents.indexOf(incident)})">Complete</button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function loadEmergencyEquipment() {
            const table = document.getElementById('emergencyEquipmentTableBody');
            if (!table) return;
            
            table.innerHTML = '';
            emergencyEquipment.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="editable" onclick="editTableCell(this, 'emergencyEquipment', ${index}, 'id')">${item.id}</td>
                    <td class="editable" onclick="editTableCell(this, 'emergencyEquipment', ${index}, 'type')">${item.type}</td>
                    <td class="editable" onclick="editTableCell(this, 'emergencyEquipment', ${index}, 'location')">${item.location}</td>
                    <td class="editable" onclick="editTableCell(this, 'emergencyEquipment', ${index}, 'lastInspection')">${item.lastInspection}</td>
                    <td class="editable" onclick="editTableCell(this, 'emergencyEquipment', ${index}, 'nextDue')">${item.nextDue}</td>
                    <td><span class="badge ${item.status === 'OK' ? 'badge-success' : 'badge-error'}">${item.status}</span></td>
                    <td class="editable" onclick="editTableCell(this, 'emergencyEquipment', ${index}, 'inspectedBy')">${item.inspectedBy}</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteItem('emergencyEquipment', ${index})">Delete</button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function loadEmergencyContacts() {
            const table = document.getElementById('emergencyContactsTableBody');
            if (!table) return;
            
            table.innerHTML = '';
            emergencyContacts.forEach((contact, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="editable" onclick="editTableCell(this, 'emergencyContacts', ${index}, 'country')">${contact.country}</td>
                    <td class="editable" onclick="editTableCell(this, 'emergencyContacts', ${index}, 'service')">${contact.service}</td>
                    <td class="editable" onclick="editTableCell(this, 'emergencyContacts', ${index}, 'number')">${contact.number}</td>
                    <td class="editable" onclick="editTableCell(this, 'emergencyContacts', ${index}, 'alternative')">${contact.alternative}</td>
                    <td class="editable" onclick="editTableCell(this, 'emergencyContacts', ${index}, 'updated')">${contact.updated}</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteItem('emergencyContacts', ${index})">Delete</button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function loadRiskMatrix() {
            const matrix = document.getElementById('riskMatrix');
            if (!matrix) return;
            
            const riskLevels = [
                { level: 'Low Risk', department: 'Admin', color: 'risk-low' },
                { level: 'Medium Risk', department: 'Sales', color: 'risk-medium' },
                { level: 'High Risk', department: 'Warehouse', color: 'risk-high' },
                { level: 'Very High Risk', department: 'Manufacturing', color: 'risk-very-high' },
                { level: 'Extreme Risk', department: 'Construction', color: 'risk-extreme' }
            ];
            
            matrix.innerHTML = '';
            riskLevels.forEach(risk => {
                const cell = document.createElement('div');
                cell.className = `matrix-cell ${risk.color}`;
                cell.innerHTML = `<div>${risk.level}</div><div>${risk.department}</div>`;
                cell.onclick = () => editRiskCell(cell);
                matrix.appendChild(cell);
            });
        }

        function getRiskBadgeClass(level) {
            switch(level) {
                case 'Low': return 'badge-success';
                case 'Medium': return 'badge-warning';
                case 'High': return 'badge-error';
                case 'Very High': return 'badge-error';
                case 'Extreme': return 'badge-error';
                default: return 'badge-info';
            }
        }

        function getStatusBadgeClass(status) {
            switch(status) {
                case 'Completed': case 'Resolved': case 'Closed': case 'Compliant':
                    return 'badge-success';
                case 'In Progress': case 'Under Investigation': case 'Scheduled':
                    return 'badge-warning';
                case 'Open': case 'Reported':
                    return 'badge-info';
                case 'Overdue': case 'Non-Compliant':
                    return 'badge-error';
                default:
                    return 'badge-info';
            }
        }

        function getComplianceBadgeClass(status) {
            switch(status) {
                case 'Compliant': return 'badge-success';
                case 'Partially Compliant': return 'badge-warning';
                case 'Non-Compliant': return 'badge-error';
                default: return 'badge-info';
            }
        }

        function editTableCell(cell, dataType, index, field) {
            if (editingCell) return;
            
            editingCell = cell;
            const originalValue = cell.textContent;
            
            let inputType = 'text';
            let options = [];
            
            // Determine input type based on field
            if (field.includes('Date') || field.includes('date')) {
                inputType = 'date';
            } else if (field.includes('Status') || field.includes('severity') || field.includes('type') || field.includes('category')) {
                inputType = 'select';
                if (field === 'severity') {
                    options = ['Minor', 'Moderate', 'Major', 'Critical', 'Catastrophic'];
                } else if (field === 'status') {
                    options = ['Reported', 'Under Investigation', 'Resolved', 'Closed'];
                } else if (field === 'type' && dataType === 'incidents') {
                    options = ['Near Miss', 'First Aid', 'Medical Treatment', 'Lost Time Injury', 'Fatality', 'Property Damage', 'Environmental Spill'];
                }
            }
            
            cell.classList.add('editing');
            cell.innerHTML = '';
            
            if (inputType === 'select') {
                const select = document.createElement('select');
                select.className = 'edit-select';
                
                options.forEach(option => {
                    const opt = document.createElement('option');
                    opt.value = option;
                    opt.textContent = option;
                    if (option === originalValue) opt.selected = true;
                    select.appendChild(opt);
                });
                
                select.onblur = function() {
                    saveTableCell(dataType, index, field, this.value, cell);
                };
                
                select.onkeypress = function(e) {
                    if (e.key === 'Enter') saveTableCell(dataType, index, field, this.value, cell);
                };
                
                cell.appendChild(select);
                select.focus();
            } else if (inputType === 'date') {
                const input = document.createElement('input');
                input.type = 'date';
                input.className = 'edit-input';
                input.value = originalValue;
                
                input.onblur = function() {
                    saveTableCell(dataType, index, field, this.value, cell);
                };
                
                input.onkeypress = function(e) {
                    if (e.key === 'Enter') saveTableCell(dataType, index, field, this.value, cell);
                };
                
                cell.appendChild(input);
                input.focus();
            } else {
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'edit-input';
                input.value = originalValue;
                
                input.onblur = function() {
                    saveTableCell(dataType, index, field, this.value, cell);
                };
                
                input.onkeypress = function(e) {
                    if (e.key === 'Enter') saveTableCell(dataType, index, field, this.value, cell);
                };
                
                cell.appendChild(input);
                input.focus();
                input.select();
            }
        }

        function saveTableCell(dataType, index, field, value, cell) {
            let dataArray;
            switch(dataType) {
                case 'incidents': dataArray = incidents; break;
                case 'risks': dataArray = risks; break;
                case 'ppeItems': dataArray = ppeItems; break;
                case 'healthRecords': dataArray = healthRecords; break;
                case 'contractors': dataArray = contractors; break;
                case 'audits': dataArray = audits; break;
                case 'standards': dataArray = standards; break;
                case 'trainings': dataArray = trainings; break;
                case 'drills': dataArray = drills; break;
                case 'emergencyEquipment': dataArray = emergencyEquipment; break;
                case 'emergencyContacts': dataArray = emergencyContacts; break;
                default: return;
            }
            
            if (dataArray[index]) {
                dataArray[index][field] = value;
                
                let displayValue = value;
                if (field.includes('Date') && value) {
                    const date = new Date(value);
                    if (!isNaN(date.getTime())) {
                        displayValue = date.toLocaleDateString();
                    }
                }
                
                cell.textContent = displayValue;
                cell.classList.remove('editing');
                
                saveAllData();
                loadAllTables();
                updateStatistics();
                
                showToast('Success', `${field} updated successfully!`, 'success');
            }
            
            editingCell = null;
        }

        function editRiskCell(cell) {
            if (editingCell) return;
            
            editingCell = cell;
            const originalContent = cell.innerHTML;
            const lines = cell.textContent.split('\n').map(l => l.trim()).filter(l => l);
            const riskLevel = lines[0] || 'Low Risk';
            const department = lines[1] || 'Department';
            
            cell.innerHTML = `
                <input type="text" class="edit-input mb-1" value="${riskLevel}" placeholder="Risk Level">
                <input type="text" class="edit-input mb-1" value="${department}" placeholder="Department">
                <select class="edit-select mb-1" id="riskColor">
                    <option value="risk-low">Low Risk</option>
                    <option value="risk-medium">Medium Risk</option>
                    <option value="risk-high">High Risk</option>
                    <option value="risk-very-high">Very High Risk</option>
                    <option value="risk-extreme">Extreme Risk</option>
                </select>
                <div class="mt-1">
                    <button class="btn btn-sm btn-success" onclick="saveRiskCellEdit(this)">Save</button>
                    <button class="btn btn-sm btn-outline" onclick="cancelRiskCellEdit(this, '${originalContent.replace(/'/g, "\\'")}')">Cancel</button>
                </div>
            `;
            
            cell.classList.add('editing');
        }

        function saveRiskCellEdit(button) {
            const cell = button.closest('.matrix-cell');
            const inputs = cell.querySelectorAll('input, select');
            
            const riskLevel = inputs[0].value;
            const department = inputs[1].value;
            const colorClass = inputs[2].value;
            
            cell.className = `matrix-cell ${colorClass}`;
            cell.innerHTML = `<div>${riskLevel}</div><div>${department}</div>`;
            cell.onclick = function() { editRiskCell(this); };
            
            editingCell = null;
            showToast('Success', 'Risk matrix updated!', 'success');
        }

        function cancelRiskCellEdit(button, originalContent) {
            const cell = button.closest('.matrix-cell');
            cell.innerHTML = originalContent;
            cell.classList.remove('editing');
            cell.onclick = function() { editRiskCell(this); };
            editingCell = null;
        }

        function saveRiskMatrix() {
            const matrixData = [];
            const cells = document.querySelectorAll('.matrix-cell:not(.editing)');
            
            cells.forEach(cell => {
                const lines = cell.textContent.split('\n').map(l => l.trim()).filter(l => l);
                matrixData.push({
                    riskLevel: lines[0] || 'Low Risk',
                    department: lines[1] || 'Department',
                    colorClass: Array.from(cell.classList).find(cls => cls.startsWith('risk-')) || 'risk-low'
                });
            });
            
            localStorage.setItem('riskMatrix', JSON.stringify(matrixData));
            showToast('Success', 'Risk matrix saved!', 'success');
        }

        function submitIncidentReport() {
            const required = [
                'incidentCountry', 'incidentRegion', 'incidentEntity', 'incidentType',
                'incidentSeverity', 'incidentDateTime', 'incidentLocation', 'reportedBy',
                'incidentDescription'
            ];
            
            for (let id of required) {
                if (!document.getElementById(id).value) {
                    document.getElementById('reportError').style.display = 'block';
                    setTimeout(() => document.getElementById('reportError').style.display = 'none', 3000);
                    return;
                }
            }
            
            const newIncident = {
                id: `INC-${new Date().getFullYear()}-${(incidents.length + 1).toString().padStart(3, '0')}`,
                country: document.getElementById('incidentCountry').value,
                region: document.getElementById('incidentRegion').value,
                entity: document.getElementById('incidentEntity').value,
                regulatoryAuthority: document.getElementById('incidentRegAuthority').value,
                localLaws: document.getElementById('incidentLocalLaws').value,
                language: document.getElementById('incidentLanguage').value,
                emergencyContact: document.getElementById('incidentEmergencyContact').value,
                type: document.getElementById('incidentType').value,
                severity: document.getElementById('incidentSeverity').value,
                dateTime: document.getElementById('incidentDateTime').value,
                location: document.getElementById('incidentLocation').value,
                reportedBy: document.getElementById('reportedBy').value,
                reportedDateTime: document.getElementById('reportedDateTime').value,
                description: document.getElementById('incidentDescription').value,
                immediateActions: document.getElementById('immediateActions').value,
                injuredNames: document.getElementById('injuredNames').value,
                injuredEmployeeIds: document.getElementById('injuredEmployeeIds').value,
                natureOfInjury: document.getElementById('natureOfInjury').value,
                bodyPart: document.getElementById('bodyPart').value,
                daysLost: document.getElementById('daysLost').value,
                medicalTreatment: document.getElementById('medicalTreatment').value,
                witnessNames: document.getElementById('witnessNames').value,
                witnessStatements: document.getElementById('witnessStatements').value,
                regulatoryNotified: document.getElementById('regulatoryNotified').value,
                regulatoryDate: document.getElementById('regulatoryDate').value,
                regulatoryReference: document.getElementById('regulatoryReference').value,
                status: 'Reported',
                createdAt: new Date().toISOString()
            };
            
            incidents.unshift(newIncident);
            saveAllData();
            
            document.getElementById('reportSuccess').style.display = 'block';
            
            setTimeout(() => {
                closeModal('reportIncidentModal');
                document.getElementById('reportSuccess').style.display = 'none';
                loadAllTables();
                updateStatistics();
                generateHeatMap();
            }, 2000);
        }

        function saveAsDraft() {
            showToast('Draft Saved', 'Incident report saved as draft', 'success');
        }

        function addRisk() {
            const newRisk = {
                id: `RSK-${new Date().getFullYear()}-${(risks.length + 1).toString().padStart(3, '0')}`,
                country: 'USA',
                hazardDescription: 'New Hazard',
                hazardCategory: 'Physical',
                location: 'Workplace',
                initialLikelihood: 'Possible',
                initialSeverity: 'Moderate',
                initialRiskLevel: 'Medium',
                controlsInPlace: 'Standard controls',
                controlEffectiveness: 'Effective',
                residualLikelihood: 'Unlikely',
                residualSeverity: 'Minor',
                residualRiskLevel: 'Low',
                actionRequired: 'Monitor',
                actionOwner: 'Safety Officer',
                dueDate: new Date().toISOString().split('T')[0],
                actionStatus: 'Open',
                reviewDate: new Date(new Date().setMonth(new Date().getMonth() + 6)).toISOString().split('T')[0]
            };
            
            risks.push(newRisk);
            saveAllData();
            loadRiskTable();
            showToast('Success', 'New risk added!', 'success');
        }

        function addPPEItem() {
            const newItem = {
                id: `PPE-${new Date().getFullYear()}-${(ppeItems.length + 1).toString().padStart(3, '0')}`,
                name: 'New Equipment',
                category: 'Head',
                sizeVariant: 'Universal',
                manufacturer: 'Unknown',
                model: 'Standard',
                certification: 'TBD',
                expiryShelfLife: '5 years',
                storageLocation: 'Warehouse',
                stockQuantity: 10,
                reorderLevel: 5,
                issuedTo: '',
                issueDate: '',
                returnDate: '',
                condition: 'New',
                inspectionDate: new Date().toISOString().split('T')[0],
                inspectedBy: 'Safety Officer',
                inspectionResult: 'Pass'
            };
            
            ppeItems.push(newItem);
            saveAllData();
            loadPPETable();
            showToast('Success', 'PPE item added!', 'success');
        }

        function addHealthRecord() {
            const newRecord = {
                employeeId: `EMP-${(healthRecords.length + 1000)}`,
                name: 'New Employee',
                country: 'USA',
                department: 'General',
                surveillanceType: 'Pre-employment',
                examinationDate: new Date().toISOString().split('T')[0],
                examinationType: 'General Medical',
                provider: 'Occupational Health',
                results: 'Fit for duty',
                fitnessCertificate: 'Yes',
                certificateExpiry: new Date(new Date().setFullYear(new Date().getFullYear() + 1)).toISOString().split('T')[0],
                restrictions: 'None',
                followUpRequired: 'No',
                followUpDate: ''
            };
            
            healthRecords.push(newRecord);
            saveAllData();
            loadHealthTable();
            showToast('Success', 'Health record added!', 'success');
        }

        function addContractor() {
            const newContractor = {
                id: `CTR-${new Date().getFullYear()}-${(contractors.length + 1).toString().padStart(3, '0')}`,
                company: 'New Contractor',
                country: 'USA',
                registrationNo: 'REG-001',
                contactPerson: 'Contact Name',
                scopeOfWork: 'Services',
                contractStart: new Date().toISOString().split('T')[0],
                contractEnd: new Date(new Date().setFullYear(new Date().getFullYear() + 1)).toISOString().split('T')[0],
                preQualification: 'Pending',
                safetyRating: 'TBD',
                insuranceValid: 'Yes',
                safetyPolicy: 'No',
                trainingRecords: 'No',
                performanceRating: '0.0'
            };
            
            contractors.push(newContractor);
            saveAllData();
            loadContractorTable();
            showToast('Success', 'Contractor added!', 'success');
        }

        function addAudit() {
            const newAudit = {
                id: `AUD-${new Date().getFullYear()}-${(audits.length + 1).toString().padStart(3, '0')}`,
                country: 'USA',
                type: 'Internal',
                title: 'New Safety Audit',
                scopeArea: 'All Areas',
                scheduledDate: new Date(new Date().setDate(new Date().getDate() + 30)).toISOString().split('T')[0],
                actualDate: '',
                auditors: 'Safety Team',
                standard: 'ISO 45001',
                status: 'Scheduled',
                score: '',
                findingsCount: 0,
                report: ''
            };
            
            audits.push(newAudit);
            saveAllData();
            loadAuditTable();
            showToast('Success', 'Audit scheduled!', 'success');
        }

        function addStandard() {
            const newStandard = {
                id: `STD-${new Date().getFullYear()}-${(standards.length + 1).toString().padStart(3, '0')}`,
                name: 'New Standard',
                issuingBody: 'ISO',
                jurisdiction: 'Global',
                applicableSites: 'All',
                requirement: 'Standard requirements',
                complianceStatus: 'Pending',
                evidence: 'TBD',
                lastReview: new Date().toISOString().split('T')[0],
                nextReview: new Date(new Date().setFullYear(new Date().getFullYear() + 1)).toISOString().split('T')[0],
                responsible: 'Compliance Officer',
                gaps: 'To be assessed'
            };
            
            standards.push(newStandard);
            saveAllData();
            loadStandardsTable();
            showToast('Success', 'Standard added!', 'success');
        }

        function addTraining() {
            const newTraining = {
                id: `TRN-${new Date().getFullYear()}-${(trainings.length + 1).toString().padStart(3, '0')}`,
                name: 'New Training Course',
                category: 'General Safety',
                provider: 'Internal',
                trainer: 'Trainer Name',
                duration: '4 hours',
                language: 'English',
                certification: 'Yes',
                validityPeriod: '1 year'
            };
            
            trainings.push(newTraining);
            saveAllData();
            loadTrainingTables();
            showToast('Success', 'Training added!', 'success');
        }

        function addDrill() {
            const newDrill = {
                id: `DRL-${new Date().getFullYear()}-${(drills.length + 1).toString().padStart(3, '0')}`,
                country: 'USA',
                type: 'Fire Drill',
                date: new Date(new Date().setDate(new Date().getDate() + 15)).toISOString().split('T')[0],
                location: 'Main Building',
                scenario: 'Emergency evacuation',
                duration: '30 minutes',
                participants: 100,
                evaluation: 'To be evaluated',
                followUpActions: '',
                report: ''
            };
            
            drills.push(newDrill);
            saveAllData();
            loadDrillsTable();
            showToast('Success', 'Drill scheduled!', 'success');
        }

        function deleteItem(dataType, index) {
            showConfirmDialog('Delete Item', 'Are you sure you want to delete this item?', function() {
                switch(dataType) {
                    case 'incidents': incidents.splice(index, 1); break;
                    case 'risks': risks.splice(index, 1); break;
                    case 'ppeItems': ppeItems.splice(index, 1); break;
                    case 'healthRecords': healthRecords.splice(index, 1); break;
                    case 'contractors': contractors.splice(index, 1); break;
                    case 'audits': audits.splice(index, 1); break;
                    case 'standards': standards.splice(index, 1); break;
                    case 'trainings': trainings.splice(index, 1); break;
                    case 'drills': drills.splice(index, 1); break;
                    case 'emergencyEquipment': emergencyEquipment.splice(index, 1); break;
                    case 'emergencyContacts': emergencyContacts.splice(index, 1); break;
                }
                
                saveAllData();
                loadAllTables();
                updateStatistics();
                showToast('Deleted', 'Item deleted successfully!', 'success');
            });
        }

        function openIncidentDetails(index) {
            showToast('Viewing', `Incident ${incidents[index].id}`, 'info');
        }

        function editIncident(index) {
            showToast('Edit Mode', `Editing incident ${incidents[index].id}`, 'info');
        }

        function updateInvestigation(index) {
            showToast('Update Investigation', `Updating investigation for incident ${incidents[index].id}`, 'info');
        }

        function completeAction(index) {
            showConfirmDialog('Complete Action', 'Mark this corrective action as completed?', function() {
                incidents[index].correctiveActionStatus = 'Completed';
                saveAllData();
                loadCorrectiveActionsTable();
                showToast('Success', 'Action marked as completed', 'success');
            });
        }

        function switchIncidentTab(tab) {
            document.querySelectorAll('#incidentModal .tab-button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            document.querySelectorAll('#incidentModal .tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`incident${tab.charAt(0).toUpperCase() + tab.slice(1)}Tab`).classList.add('active');
        }

        function switchHealthTab(tab) {
            document.querySelectorAll('#healthModal .tab-button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            document.querySelectorAll('#healthModal .tab-content').forEach(content => content.classList.remove('active'));
            
            if (tab === 'records') document.getElementById('healthRecordsTab').classList.add('active');
            else if (tab === 'exposure') document.getElementById('exposureTab').classList.add('active');
            else if (tab === 'wellness') document.getElementById('wellnessTab').classList.add('active');
            else if (tab === 'attachments') document.getElementById('healthAttachmentsTab').classList.add('active');
        }

        function switchContractorTab(tab) {
            document.querySelectorAll('#contractorModal .tab-button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            document.querySelectorAll('#contractorModal .tab-content').forEach(content => content.classList.remove('active'));
            
            if (tab === 'records') document.getElementById('contractorRecordsTab').classList.add('active');
            else if (tab === 'permits') document.getElementById('contractorPermitsTab').classList.add('active');
            else if (tab === 'induction') document.getElementById('contractorInductionTab').classList.add('active');
            else if (tab === 'attachments') document.getElementById('contractorAttachmentsTab').classList.add('active');
        }

        function switchAuditTab(tab) {
            document.querySelectorAll('#auditModal .tab-button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            document.querySelectorAll('#auditModal .tab-content').forEach(content => content.classList.remove('active'));
            
            if (tab === 'audits') document.getElementById('auditRecordsTab').classList.add('active');
            else if (tab === 'findings') document.getElementById('auditFindingsTab').classList.add('active');
            else if (tab === 'schedule') document.getElementById('auditScheduleTab').classList.add('active');
            else if (tab === 'attachments') document.getElementById('auditAttachmentsTab').classList.add('active');
        }

        function switchTrainingTab(tab) {
            document.querySelectorAll('#trainingModal .tab-button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            document.querySelectorAll('#trainingModal .tab-content').forEach(content => content.classList.remove('active'));
            
            if (tab === 'courses') document.getElementById('trainingCoursesTab').classList.add('active');
            else if (tab === 'records') document.getElementById('trainingRecordsTab').classList.add('active');
            else if (tab === 'certifications') document.getElementById('certificationsTab').classList.add('active');
        }

        function switchEmergencyTab(tab) {
            document.querySelectorAll('#emergencyModal .tab-button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            document.querySelectorAll('#emergencyModal .tab-content').forEach(content => content.classList.remove('active'));
            
            if (tab === 'drills') document.getElementById('drillsTab').classList.add('active');
            else if (tab === 'equipment') document.getElementById('equipmentTab').classList.add('active');
            else if (tab === 'contacts') document.getElementById('contactsTab').classList.add('active');
        }

        function loadHealthAttachments() {
            const employeeId = document.getElementById('healthEmployeeSelect').value;
            const list = document.getElementById('healthAttachmentsList');
            
            if (!employeeId) {
                list.innerHTML = '<div style="text-align: center; padding: 2rem;">Select an employee</div>';
                return;
            }
            
            const employeeAttachments = attachments.health[employeeId] || [];
            
            if (employeeAttachments.length === 0) {
                list.innerHTML = '<div style="text-align: center; padding: 2rem;">No attachments</div>';
                return;
            }
            
            list.innerHTML = '';
            employeeAttachments.forEach((att, index) => {
                const item = document.createElement('div');
                item.className = 'file-item';
                item.innerHTML = `
                    <div class="file-info">
                        <div class="file-name">${att.name}</div>
                        <div class="file-meta">${att.type} ‚Ä¢ ${att.size} ‚Ä¢ Uploaded ${new Date(att.uploaded).toLocaleDateString()}</div>
                    </div>
                    <button class="btn btn-sm btn-danger" onclick="deleteHealthAttachment('${employeeId}', ${index})">Delete</button>
                `;
                list.appendChild(item);
            });
        }

        function loadContractorAttachments() {
            const contractorId = document.getElementById('contractorSelect').value;
            const list = document.getElementById('contractorAttachmentsList');
            
            if (!contractorId) {
                list.innerHTML = '<div style="text-align: center; padding: 2rem;">Select a contractor</div>';
                return;
            }
            
            const contractorAttachments = attachments.contractor[contractorId] || [];
            
            if (contractorAttachments.length === 0) {
                list.innerHTML = '<div style="text-align: center; padding: 2rem;">No attachments</div>';
                return;
            }
            
            list.innerHTML = '';
            contractorAttachments.forEach((att, index) => {
                const item = document.createElement('div');
                item.className = 'file-item';
                item.innerHTML = `
                    <div class="file-info">
                        <div class="file-name">${att.name}</div>
                        <div class="file-meta">${att.type} ‚Ä¢ ${att.size} ‚Ä¢ Uploaded ${new Date(att.uploaded).toLocaleDateString()}</div>
                    </div>
                    <button class="btn btn-sm btn-danger" onclick="deleteContractorAttachment('${contractorId}', ${index})">Delete</button>
                `;
                list.appendChild(item);
            });
        }

        function loadAuditAttachments() {
            const auditId = document.getElementById('auditSelect').value;
            const list = document.getElementById('auditAttachmentsList');
            
            if (!auditId) {
                list.innerHTML = '<div style="text-align: center; padding: 2rem;">Select an audit</div>';
                return;
            }
            
            const auditAttachments = attachments.audit[auditId] || [];
            
            if (auditAttachments.length === 0) {
                list.innerHTML = '<div style="text-align: center; padding: 2rem;">No attachments</div>';
                return;
            }
            
            list.innerHTML = '';
            auditAttachments.forEach((att, index) => {
                const item = document.createElement('div');
                item.className = 'file-item';
                item.innerHTML = `
                    <div class="file-info">
                        <div class="file-name">${att.name}</div>
                        <div class="file-meta">${att.type} ‚Ä¢ ${att.size} ‚Ä¢ Uploaded ${new Date(att.uploaded).toLocaleDateString()}</div>
                    </div>
                    <button class="btn btn-sm btn-danger" onclick="deleteAuditAttachment('${auditId}', ${index})">Delete</button>
                `;
                list.appendChild(item);
            });
        }

        function uploadHealthAttachment() {
            const fileInput = document.getElementById('healthFileInput');
            const employeeId = document.getElementById('healthEmployeeSelect').value;
            
            if (!employeeId) {
                showToast('Error', 'Select an employee first', 'error');
                return;
            }
            
            if (fileInput.files.length === 0) return;
            
            Array.from(fileInput.files).forEach(file => {
                const attachment = {
                    name: file.name,
                    type: file.type || 'application/octet-stream',
                    size: formatFileSize(file.size),
                    uploaded: new Date().toISOString()
                };
                
                if (!attachments.health[employeeId]) attachments.health[employeeId] = [];
                attachments.health[employeeId].push(attachment);
            });
            
            saveAllData();
            loadHealthAttachments();
            showToast('Success', 'Files uploaded', 'success');
            fileInput.value = '';
        }

        function uploadContractorAttachment() {
            const fileInput = document.getElementById('contractorFileInput');
            const contractorId = document.getElementById('contractorSelect').value;
            
            if (!contractorId) {
                showToast('Error', 'Select a contractor first', 'error');
                return;
            }
            
            if (fileInput.files.length === 0) return;
            
            Array.from(fileInput.files).forEach(file => {
                const attachment = {
                    name: file.name,
                    type: file.type || 'application/octet-stream',
                    size: formatFileSize(file.size),
                    uploaded: new Date().toISOString()
                };
                
                if (!attachments.contractor[contractorId]) attachments.contractor[contractorId] = [];
                attachments.contractor[contractorId].push(attachment);
            });
            
            saveAllData();
            loadContractorAttachments();
            showToast('Success', 'Files uploaded', 'success');
            fileInput.value = '';
        }

        function uploadAuditAttachment() {
            const fileInput = document.getElementById('auditFileInput');
            const auditId = document.getElementById('auditSelect').value;
            
            if (!auditId) {
                showToast('Error', 'Select an audit first', 'error');
                return;
            }
            
            if (fileInput.files.length === 0) return;
            
            Array.from(fileInput.files).forEach(file => {
                const attachment = {
                    name: file.name,
                    type: file.type || 'application/octet-stream',
                    size: formatFileSize(file.size),
                    uploaded: new Date().toISOString()
                };
                
                if (!attachments.audit[auditId]) attachments.audit[auditId] = [];
                attachments.audit[auditId].push(attachment);
            });
            
            saveAllData();
            loadAuditAttachments();
            showToast('Success', 'Files uploaded', 'success');
            fileInput.value = '';
        }

        function deleteHealthAttachment(employeeId, index) {
            if (attachments.health[employeeId]) {
                attachments.health[employeeId].splice(index, 1);
                saveAllData();
                loadHealthAttachments();
                showToast('Deleted', 'Attachment removed', 'success');
            }
        }

        function deleteContractorAttachment(contractorId, index) {
            if (attachments.contractor[contractorId]) {
                attachments.contractor[contractorId].splice(index, 1);
                saveAllData();
                loadContractorAttachments();
                showToast('Deleted', 'Attachment removed', 'success');
            }
        }

        function deleteAuditAttachment(auditId, index) {
            if (attachments.audit[auditId]) {
                attachments.audit[auditId].splice(index, 1);
                saveAllData();
                loadAuditAttachments();
                showToast('Deleted', 'Attachment removed', 'success');
            }
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function filterIncidents() {
            showToast('Filter Applied', 'Incidents filtered', 'success');
        }

        function filterModalIncidents() {
            showToast('Filter Applied', 'Modal view filtered', 'success');
        }

        function openAdvancedFilters(type) {
            document.getElementById('incidentFilters').style.display = 'flex';
        }

        function exportToExcel(type) {
            let data = [];
            let filename = '';
            
            switch(type) {
                case 'incidents':
                    data = incidents;
                    filename = 'incidents_export.xlsx';
                    break;
                case 'ppe':
                    data = ppeItems;
                    filename = 'ppe_export.xlsx';
                    break;
                case 'standards':
                    data = standards;
                    filename = 'standards_export.xlsx';
                    break;
                default:
                    data = incidents;
                    filename = 'export.xlsx';
            }
            
            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Sheet1');
            XLSX.writeFile(wb, filename);
            
            showToast('Exported', `Data exported to ${filename}`, 'success');
        }

        function generateReport(type) {
            showToast('Report Generated', `${type} report created successfully`, 'success');
        }

        function updateAnalytics() {
            showToast('Analytics Updated', 'Dashboard refreshed', 'success');
        }

        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
            document.body.style.overflow = 'hidden';
            
            // Refresh data for the modal
            if (modalId === 'incidentModal') loadIncidentsTable();
            else if (modalId === 'riskModal') loadRiskTable();
            else if (modalId === 'ppeModal') loadPPETable();
            else if (modalId === 'healthModal') loadHealthTable();
            else if (modalId === 'contractorModal') loadContractorTable();
            else if (modalId === 'auditModal') loadAuditTable();
            else if (modalId === 'standardsModal') loadStandardsTable();
            else if (modalId === 'trainingModal') loadTrainingTables();
            else if (modalId === 'emergencyModal') {
                loadDrillsTable();
                loadEmergencyEquipment();
                loadEmergencyContacts();
            }
        }

        function openModalWithFilter(modalId, filterType, filterValue) {
            openModal(modalId);
            showToast('Filter Applied', `Showing: ${filterValue}`, 'info');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function showToast(title, message, type) {
            const toast = document.getElementById('toast');
            const toastTitle = toast.querySelector('.toast-title');
            const toastMessage = toast.querySelector('.toast-message');
            const toastIcon = toast.querySelector('.toast-icon');
            
            toast.className = `toast toast-${type}`;
            toastTitle.textContent = title;
            toastMessage.textContent = message;
            toastIcon.textContent = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ö†Ô∏è';
            
            toast.classList.add('show');
            
            setTimeout(() => hideToast(), 3000);
        }

        function hideToast() {
            document.getElementById('toast').classList.remove('show');
        }

        function showConfirmDialog(title, message, onConfirm) {
            const dialog = document.getElementById('confirmDialog');
            document.getElementById('confirmTitle').textContent = title;
            document.getElementById('confirmMessage').textContent = message;
            
            document.getElementById('confirmActionBtn').onclick = function() {
                hideConfirmDialog();
                if (onConfirm) onConfirm();
            };
            
            dialog.classList.add('show');
        }

        function hideConfirmDialog() {
            document.getElementById('confirmDialog').classList.remove('show');
        }

        function toggleDarkMode() {
            darkMode = !darkMode;
            if (darkMode) {
                document.body.classList.add('dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
            }
            showToast('Theme Changed', darkMode ? 'Dark mode enabled' : 'Light mode enabled', 'success');
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        };

        // Escape key to close modal
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                document.querySelectorAll('.modal').forEach(modal => {
                    if (modal.style.display === 'block') {
                        modal.style.display = 'none';
                        document.body.style.overflow = 'auto';
                    }
                });
            }
        });
    </script>
</body>
</html>
