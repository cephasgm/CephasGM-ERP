<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CephasGM ERP - Inventory & Warehouse</title>
<style>
  /* Reset & Base */
  * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
  body { 
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: #2d3748; 
    min-height: 100vh; 
    display: flex; 
    flex-direction: column;
    padding: 15px;
  }
  
  .container { 
    max-width: 1200px; 
    margin: 0 auto; 
    flex: 1;
    background: white;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    overflow: hidden;
  }
  
  /* Header */
  .header {
    background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
    color: white;
    padding: 20px 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .logo {
    font-size: 1.8rem;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
  }
  
  .nav-controls {
    display: flex;
    gap: 15px;
    align-items: center;
  }
  
  .nav-btn {
    padding: 10px 20px;
    background: rgba(255,255,255,0.2);
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s;
    font-weight: 500;
  }
  
  .nav-btn:hover, .nav-btn.active {
    background: rgba(255,255,255,0.3);
    transform: translateY(-2px);
  }
  
  .nav-btn.blue {
    background: #3498db;
  }
  
  .nav-btn.red {
    background: #e74c3c;
  }
  
  .nav-btn.red:hover {
    background: #c0392b;
  }
  
  /* Main Content */
  .main-content {
    padding: 25px 30px;
    min-height: 500px;
  }
  
  .section {
    display: none;
  }
  
  .section.active {
    display: block;
    animation: fadeIn 0.5s ease-in-out;
  }
  
  .section-title {
    color: #2c3e50;
    margin-bottom: 25px;
    border-bottom: 3px solid #3498db;
    padding-bottom: 10px;
  }
  
  /* Inventory Section */
  .inventory-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    border-bottom: 2px solid #e9ecef;
  }
  
  .inventory-tab {
    padding: 12px 25px;
    background: none;
    border: none;
    border-bottom: 3px solid transparent;
    cursor: pointer;
    font-weight: 500;
    color: #7f8c8d;
    transition: all 0.3s;
  }
  
  .inventory-tab.active {
    color: #3498db;
    border-bottom-color: #3498db;
  }
  
  .tab-content {
    display: none;
  }
  
  .tab-content.active {
    display: block;
  }
  
  .action-buttons {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }
  
  .btn {
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.3s;
  }
  
  .btn-primary {
    background: #3498db;
    color: white;
  }
  
  .btn-success {
    background: #27ae60;
    color: white;
  }
  
  .btn-warning {
    background: #f39c12;
    color: white;
  }
  
  .btn-danger {
    background: #e74c3c;
    color: white;
  }
  
  .btn-info {
    background: #17a2b8;
    color: white;
  }
  
  .btn-sm {
    padding: 5px 10px;
    font-size: 0.85rem;
  }
  
  .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
  }
  
  /* Batch Update Section */
  .batch-update-section {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 20px;
    border: 2px solid #3498db;
    display: none;
  }
  
  .batch-update-section.active {
    display: block;
  }
  
  /* Table Styling */
  .table-container {
    background: white;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    margin-bottom: 20px;
  }
  
  table {
    width: 100%;
    border-collapse: collapse;
  }
  
  th, td {
    padding: 15px;
    text-align: left;
    border-bottom: 1px solid #e9ecef;
  }
  
  th {
    background: #f8f9fa;
    font-weight: 600;
    color: #2c3e50;
  }
  
  tr:hover {
    background: #f8f9fa;
  }
  
  .action-buttons-cell {
    display: flex;
    gap: 5px;
    flex-wrap: wrap;
  }
  
  .status-badge {
    padding: 5px 10px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 500;
  }
  
  .status-available {
    background: #d4edda;
    color: #155724;
  }
  
  .status-low {
    background: #fff3cd;
    color: #856404;
  }
  
  .status-critical {
    background: #f8d7da;
    color: #721c24;
  }
  
  /* Warehouse Section */
  .warehouse-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
    margin-bottom: 25px;
  }
  
  .storage-card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    border-left: 5px solid #3498db;
    transition: transform 0.3s;
  }
  
  .storage-card:hover {
    transform: translateY(-5px);
  }
  
  .storage-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 15px;
  }
  
  .storage-title h3 {
    color: #2c3e50;
    margin-bottom: 5px;
  }
  
  .storage-id {
    color: #7f8c8d;
    font-size: 0.9rem;
  }
  
  .storage-actions {
    display: flex;
    gap: 5px;
  }
  
  .storage-actions button {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 1.1rem;
    padding: 5px;
  }
  
  .storage-details {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-bottom: 15px;
  }
  
  .storage-detail {
    font-size: 0.9rem;
  }
  
  .storage-detail strong {
    display: block;
    color: #7f8c8d;
    font-size: 0.8rem;
    margin-bottom: 3px;
  }
  
  .storage-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 15px;
    border-top: 1px solid #e9ecef;
  }
  
  .utilization-bar {
    width: 100px;
    height: 8px;
    background: #e9ecef;
    border-radius: 4px;
    overflow: hidden;
  }
  
  .utilization-fill {
    height: 100%;
    background: #3498db;
    border-radius: 4px;
  }
  
  /* Modal Styling */
  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }
  
  .modal.active {
    display: flex;
  }
  
  .modal-content {
    background: white;
    padding: 30px;
    border-radius: 12px;
    width: 90%;
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
    animation: modalFadeIn 0.3s ease;
  }
  
  @keyframes modalFadeIn {
    from { opacity: 0; transform: scale(0.9); }
    to { opacity: 1; transform: scale(1); }
  }
  
  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }
  
  .close {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: #7f8c8d;
  }
  
  .close:hover {
    color: #e74c3c;
  }
  
  .form-group {
    margin-bottom: 15px;
  }
  
  .form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: 500;
    color: #2c3e50;
  }
  
  .form-group input, .form-group select, .form-group textarea {
    width: 100%;
    padding: 10px;
    border: 2px solid #e9ecef;
    border-radius: 6px;
    font-size: 1rem;
  }
  
  .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
    border-color: #3498db;
    outline: none;
  }
  
  /* View Details Modal */
  .details-grid {
    display: grid;
    gap: 15px;
  }
  
  .detail-item {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid #e9ecef;
  }
  
  .detail-label {
    font-weight: 600;
    color: #2c3e50;
  }
  
  .detail-value {
    color: #7f8c8d;
  }
  
  /* Animations */
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="logo" onclick="goToHome()">
      <span>üè¢</span>
      <span>CephasGM ERP</span>
    </div>
    <div class="nav-controls">
      <button class="nav-btn blue active" data-target="inventory">Inventory</button>
      <button class="nav-btn" data-target="warehouse">Warehouse</button>
      <button class="nav-btn red" onclick="goToMainERP()">Home</button>
    </div>
  </div>

  <div class="main-content">
    <!-- Inventory Section -->
    <section id="inventory" class="section active">
      <h1 class="section-title">Inventory Management</h1>
      
      <!-- Batch Update Section -->
      <div class="batch-update-section" id="batchUpdateSection">
        <h3 style="margin-bottom: 15px;">Batch Update Selected Items</h3>
        <div style="display: flex; gap: 15px; margin-bottom: 15px;">
          <div style="flex: 1;">
            <label for="batchField"><strong>Field to Update:</strong></label>
            <select id="batchField" class="form-group" style="margin-bottom: 0;">
              <option value="quantity">Quantity</option>
              <option value="price">Price</option>
              <option value="location">Location</option>
              <option value="category">Category</option>
              <option value="status">Status</option>
            </select>
          </div>
          <div style="flex: 1;">
            <label for="batchValue"><strong>New Value:</strong></label>
            <input type="text" id="batchValue" placeholder="Enter new value" class="form-group" style="margin-bottom: 0;">
          </div>
        </div>
        <div class="action-buttons">
          <button class="btn btn-success" id="applyBatchUpdate">Apply to Selected Items</button>
          <button class="btn btn-danger" id="cancelBatchUpdate">Cancel</button>
        </div>
      </div>
      
      <div class="inventory-tabs">
        <button class="inventory-tab active" data-tab="items">Items</button>
        <button class="inventory-tab" data-tab="containers">Containers</button>
        <button class="inventory-tab" data-tab="batches">Batches</button>
        <button class="inventory-tab" data-tab="reports">Reports</button>
      </div>
      
      <!-- Items Tab -->
      <div id="items-tab" class="tab-content active">
        <div class="action-buttons">
          <button class="btn btn-primary" id="addItemBtn">Add Item</button>
          <button class="btn btn-success" id="importCSV">Import CSV</button>
          <button class="btn btn-warning" id="exportCSV">Export CSV</button>
          <button class="btn btn-danger" id="bulkDeleteBtn" style="display:none;">Delete Selected</button>
          <button class="btn btn-warning" id="batchUpdateBtn">Batch Update</button>
          <button class="btn btn-info" id="refreshItems">Refresh</button>
        </div>
        
        <div class="table-container">
          <table id="inventoryTable">
            <thead>
              <tr>
                <th><input type="checkbox" id="selectAll"></th>
                <th>ID/SKU</th>
                <th>Name</th>
                <th>Category</th>
                <th>Quantity</th>
                <th>Unit</th>
                <th>Status</th>
                <th>Location</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="inventoryTableBody">
              <!-- Items will be populated here -->
            </tbody>
          </table>
        </div>
        
        <div class="table-container">
          <div style="padding: 15px; background: #f8f9fa; border-radius: 8px;">
            <h4 style="margin-bottom: 10px;">Quick Summary</h4>
            <div style="display: flex; gap: 20px;">
              <div>
                <strong>Total Items:</strong> <span id="totalItemsCount">0</span>
              </div>
              <div>
                <strong>Low Stock Items:</strong> <span id="lowStockCount">0</span>
              </div>
              <div>
                <strong>Out of Stock:</strong> <span id="outOfStockCount">0</span>
              </div>
              <div>
                <strong>Total Value:</strong> <span id="totalValue">$0.00</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Containers Tab -->
      <div id="containers-tab" class="tab-content">
        <div class="action-buttons">
          <button class="btn btn-primary" id="addContainerBtn">Add Container</button>
          <button class="btn btn-success" id="trackContainerBtn">Track Container</button>
          <button class="btn btn-info" id="refreshContainers">Refresh</button>
        </div>
        
        <div class="table-container">
          <table id="containerTable">
            <thead>
              <tr>
                <th>Container ID</th>
                <th>Type</th>
                <th>Status</th>
                <th>Location</th>
                <th>Contents</th>
                <th>ETA</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="containerTableBody">
              <!-- Containers will be populated here -->
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- Batches Tab -->
      <div id="batches-tab" class="tab-content">
        <div class="action-buttons">
          <button class="btn btn-primary" id="addBatchBtn">Add Batch</button>
          <button class="btn btn-success" id="qualityCheckBtn">Quality Check</button>
          <button class="btn btn-warning" id="exportBatchesBtn">Export Batches</button>
          <button class="btn btn-info" id="refreshBatches">Refresh</button>
        </div>
        
        <div class="table-container">
          <table id="batchTable">
            <thead>
              <tr>
                <th>Batch ID</th>
                <th>Product</th>
                <th>Quantity</th>
                <th>Production Date</th>
                <th>Expiry Date</th>
                <th>Quality Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="batchTableBody">
              <!-- Batches will be populated here -->
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- Reports Tab -->
      <div id="reports-tab" class="tab-content">
        <div class="action-buttons">
          <button class="btn btn-primary" id="generateReportBtn">Generate Report</button>
          <button class="btn btn-success" id="exportReportBtn">Export Report</button>
          <button class="btn btn-warning" id="viewAnalyticsBtn">View Analytics</button>
        </div>
        
        <div class="table-container">
          <div style="padding: 20px;">
            <h4 style="margin-bottom: 15px;">Inventory Reports</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
              <div style="background: #e3f2fd; padding: 15px; border-radius: 8px;">
                <h5 style="margin-bottom: 10px;">Stock Level Report</h5>
                <p>View current stock levels and identify items that need reordering.</p>
                <button class="btn btn-sm btn-primary" onclick="generateStockReport()">Generate</button>
              </div>
              <div style="background: #e8f5e9; padding: 15px; border-radius: 8px;">
                <h5 style="margin-bottom: 10px;">Expiry Report</h5>
                <p>Check items approaching expiry date.</p>
                <button class="btn btn-sm btn-primary" onclick="generateExpiryReport()">Generate</button>
              </div>
              <div style="background: #fff3e0; padding: 15px; border-radius: 8px;">
                <h5 style="margin-bottom: 10px;">Value Report</h5>
                <p>Calculate total inventory value by category.</p>
                <button class="btn btn-sm btn-primary" onclick="generateValueReport()">Generate</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Warehouse Section -->
    <section id="warehouse" class="section">
      <h1 class="section-title">Warehouse Management</h1>
      
      <div class="action-buttons">
        <button class="btn btn-primary" id="buildStorageBtn">Build Storage Units</button>
        <button class="btn btn-success" id="addStorageBtn">Add Storage Unit</button>
        <button class="btn btn-warning" id="addZoneBtn">Add Zone</button>
        <button class="btn btn-danger" id="optimizeLayoutBtn">Optimize Layout</button>
        <button class="btn btn-info" id="refreshWarehouse">Refresh</button>
      </div>
      
      <div class="warehouse-grid" id="storageContainer">
        <!-- Storage units will be populated here -->
      </div>
      
      <div class="table-container">
        <h3 style="padding: 15px; margin: 0;">Storage Utilization Summary</h3>
        <div style="padding: 15px;">
          <div style="display: flex; height: 20px; background: #e9ecef; border-radius: 10px; overflow: hidden; margin: 10px 0;">
            <div id="usedSpace" style="background: #3498db; height: 100%;"></div>
            <div id="freeSpace" style="background: #27ae60; height: 100%;"></div>
            <div id="reservedSpace" style="background: #f39c12; height: 100%;"></div>
          </div>
          <div style="display: flex; justify-content: space-between; font-size: 0.9rem;">
            <span>Used: <span id="usedPercent">0%</span></span>
            <span>Free: <span id="freePercent">0%</span></span>
            <span>Reserved: <span id="reservedPercent">0%</span></span>
          </div>
        </div>
      </div>
    </section>
  </div>
</div>

<!-- Item Modal -->
<div id="itemModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="modalTitle">Add Inventory Item</h3>
      <button class="close">&times;</button>
    </div>
    <form id="itemForm">
      <input type="hidden" id="itemIndex">
      <div class="form-group">
        <label for="itemName">Item Name:</label>
        <input type="text" id="itemName" required>
      </div>
      <div class="form-group">
        <label for="itemSku">SKU:</label>
        <input type="text" id="itemSku" required>
      </div>
      <div class="form-group">
        <label for="itemCategory">Category:</label>
        <select id="itemCategory" required>
          <option value="">Select Category</option>
          <option value="Raw Materials">Raw Materials</option>
          <option value="Components">Components</option>
          <option value="Finished Goods">Finished Goods</option>
          <option value="Packaging">Packaging</option>
          <option value="MRO">MRO (Maintenance, Repair, Operations)</option>
          <option value="Office Supplies">Office Supplies</option>
        </select>
      </div>
      <div class="form-group">
        <label for="itemQuantity">Quantity:</label>
        <input type="number" id="itemQuantity" min="0" required>
      </div>
      <div class="form-group">
        <label for="itemUnit">Unit:</label>
        <select id="itemUnit" required>
          <option value="pcs">Pieces</option>
          <option value="kg">Kilograms</option>
          <option value="liters">Liters</option>
          <option value="meters">Meters</option>
          <option value="boxes">Boxes</option>
          <option value="pallets">Pallets</option>
        </select>
      </div>
      <div class="form-group">
        <label for="itemPrice">Price (per unit):</label>
        <input type="number" id="itemPrice" step="0.01" min="0" required>
      </div>
      <div class="form-group">
        <label for="itemLocation">Location:</label>
        <input type="text" id="itemLocation" required>
      </div>
      <div class="form-group">
        <label for="itemDescription">Description:</label>
        <textarea id="itemDescription" rows="3"></textarea>
      </div>
      <div class="form-group">
        <label for="itemMinQuantity">Minimum Quantity:</label>
        <input type="number" id="itemMinQuantity" min="0">
      </div>
      <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 15px;">Save Item</button>
    </form>
  </div>
</div>

<!-- View Item Details Modal -->
<div id="viewItemModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Item Details</h3>
      <button class="close">&times;</button>
    </div>
    <div class="details-grid" id="itemDetailsContent">
      <!-- Details will be populated here -->
    </div>
    <div style="display: flex; gap: 10px; margin-top: 20px;">
      <button class="btn btn-primary" id="editFromViewBtn">Edit Item</button>
      <button class="btn btn-danger" id="deleteFromViewBtn">Delete Item</button>
      <button class="btn btn-secondary" onclick="closeModal('viewItemModal')">Close</button>
    </div>
  </div>
</div>

<!-- Storage Unit Modal -->
<div id="storageModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="storageModalTitle">Add Storage Unit</h3>
      <button class="close">&times;</button>
    </div>
    <form id="storageForm">
      <input type="hidden" id="storageIndex">
      <div class="form-group">
        <label for="storageName">Storage Unit Name:</label>
        <input type="text" id="storageName" required>
      </div>
      <div class="form-group">
        <label for="storageType">Type:</label>
        <select id="storageType">
          <option value="pallet-rack">Pallet Rack</option>
          <option value="shelving">Shelving</option>
          <option value="bulk-storage">Bulk Storage</option>
          <option value="cold-storage">Cold Storage</option>
          <option value="hazardous">Hazardous Materials</option>
        </select>
      </div>
      <div class="form-group">
        <label for="storageCapacity">Capacity (units):</label>
        <input type="number" id="storageCapacity" required min="1">
      </div>
      <div class="form-group">
        <label for="storageLocation">Location (Zone):</label>
        <input type="text" id="storageLocation" required>
      </div>
      <div class="form-group">
        <label for="storageUtilization">Current Utilization (%):</label>
        <input type="number" id="storageUtilization" min="0" max="100" required>
      </div>
      <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 15px;">Save Storage Unit</button>
    </form>
  </div>
</div>

<!-- Container Modal -->
<div id="containerModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="containerModalTitle">Add Container</h3>
      <button class="close">&times;</button>
    </div>
    <form id="containerForm">
      <input type="hidden" id="containerIndex">
      <div class="form-group">
        <label for="containerId">Container ID:</label>
        <input type="text" id="containerId" required>
      </div>
      <div class="form-group">
        <label for="containerType">Type:</label>
        <select id="containerType">
          <option value="20ft Standard">20ft Standard</option>
          <option value="40ft Standard">40ft Standard</option>
          <option value="40ft High Cube">40ft High Cube</option>
          <option value="Reefer">Reefer</option>
          <option value="Tank">Tank</option>
        </select>
      </div>
      <div class="form-group">
        <label for="containerStatus">Status:</label>
        <select id="containerStatus">
          <option value="loaded">Loaded</option>
          <option value="empty">Empty</option>
          <option value="in-transit">In Transit</option>
          <option value="customs">Customs Hold</option>
        </select>
      </div>
      <div class="form-group">
        <label for="containerLocation">Current Location:</label>
        <input type="text" id="containerLocation" required>
      </div>
      <div class="form-group">
        <label for="containerContents">Contents:</label>
        <textarea id="containerContents" rows="3" required></textarea>
      </div>
      <div class="form-group">
        <label for="containerETA">ETA (Estimated Time of Arrival):</label>
        <input type="date" id="containerETA">
      </div>
      <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 15px;">Save Container</button>
    </form>
  </div>
</div>

<!-- Batch Modal -->
<div id="batchModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="batchModalTitle">Add Batch</h3>
      <button class="close">&times;</button>
    </div>
    <form id="batchForm">
      <input type="hidden" id="batchIndex">
      <div class="form-group">
        <label for="batchId">Batch ID:</label>
        <input type="text" id="batchId" required>
      </div>
      <div class="form-group">
        <label for="batchProduct">Product Name:</label>
        <input type="text" id="batchProduct" required>
      </div>
      <div class="form-group">
        <label for="batchQuantity">Quantity:</label>
        <input type="number" id="batchQuantity" min="1" required>
      </div>
      <div class="form-group">
        <label for="batchProductionDate">Production Date:</label>
        <input type="date" id="batchProductionDate" required>
      </div>
      <div class="form-group">
        <label for="batchExpiryDate">Expiry Date:</label>
        <input type="date" id="batchExpiryDate">
      </div>
      <div class="form-group">
        <label for="batchQualityStatus">Quality Status:</label>
        <select id="batchQualityStatus">
          <option value="pending">Pending</option>
          <option value="approved">Approved</option>
          <option value="rejected">Rejected</option>
          <option value="on-hold">On Hold</option>
        </select>
      </div>
      <div class="form-group">
        <label for="batchStorageLocation">Storage Location:</label>
        <input type="text" id="batchStorageLocation" required>
      </div>
      <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 15px;">Save Batch</button>
    </form>
  </div>
</div>

<!-- Confirmation Modal -->
<div id="confirmModal" class="modal">
  <div class="modal-content" style="max-width: 400px;">
    <div class="modal-header">
      <h3 id="confirmTitle">Confirm Action</h3>
      <button class="close">&times;</button>
    </div>
    <div style="padding: 20px;">
      <p id="confirmMessage">Are you sure you want to perform this action?</p>
    </div>
    <div style="display: flex; gap: 10px; padding: 20px; border-top: 1px solid #e9ecef;">
      <button class="btn btn-danger" id="confirmYes">Yes</button>
      <button class="btn btn-secondary" id="confirmNo">No</button>
    </div>
  </div>
</div>

<script>
  // Data Storage
  let inventory = JSON.parse(localStorage.getItem('inventory')) || [];
  let containers = JSON.parse(localStorage.getItem('containers')) || [];
  let batches = JSON.parse(localStorage.getItem('batches')) || [];
  let storageUnits = JSON.parse(localStorage.getItem('storageUnits')) || [];

  // Current editing item
  let currentEditIndex = null;
  let currentEditType = null;

  // Initialize the application
  function init() {
    // Load sample data if empty
    if (inventory.length === 0) loadSampleData();
    
    // Render initial data
    renderAllData();
    
    // Set up event listeners
    setupEventListeners();
  }

  // Load sample data for demonstration
  function loadSampleData() {
    // Sample inventory items
    inventory = [
      { 
        id: 'ITEM-001', 
        name: 'Steel Plates', 
        sku: 'STL-PLT-001',
        category: 'Raw Materials', 
        quantity: 500, 
        unit: 'pcs',
        price: 45.50, 
        location: 'Zone A, Rack 1', 
        status: 'available',
        description: 'Industrial grade steel plates',
        minQuantity: 100
      },
      { 
        id: 'ITEM-002', 
        name: 'Industrial Valves', 
        sku: 'IND-VLV-002',
        category: 'Components', 
        quantity: 3, 
        unit: 'pcs',
        price: 120.00, 
        location: 'Zone B, Rack 3', 
        status: 'low',
        description: 'High pressure industrial valves',
        minQuantity: 10
      },
      { 
        id: 'ITEM-003', 
        name: 'Crude Oil', 
        sku: 'OIL-CRD-003',
        category: 'Petroleum', 
        quantity: 0, 
        unit: 'liters',
        price: 75.30, 
        location: 'Tank Farm', 
        status: 'critical',
        description: 'Crude oil for refining',
        minQuantity: 10000
      },
      { 
        id: 'ITEM-004', 
        name: 'Wheat Flour', 
        sku: 'AGR-FLR-004',
        category: 'Agriculture', 
        quantity: 200, 
        unit: 'kg',
        price: 0.85, 
        location: 'Silo A', 
        status: 'available',
        description: 'Premium quality wheat flour',
        minQuantity: 50
      }
    ];
    
    // Sample containers
    containers = [
      { 
        id: 'CONT-001', 
        type: '40ft Standard', 
        status: 'loaded', 
        location: 'Port of Shanghai', 
        contents: 'Electronics, Textiles', 
        eta: '2025-04-15' 
      },
      { 
        id: 'CONT-002', 
        type: '20ft Standard', 
        status: 'empty', 
        location: 'ICD Delhi', 
        contents: 'Empty', 
        eta: 'N/A' 
      }
    ];
    
    // Sample batches
    batches = [
      { 
        id: 'BATCH-001', 
        product: 'Wheat Flour', 
        quantity: 1000, 
        productionDate: '2025-03-01', 
        expiryDate: '2025-09-01', 
        qualityStatus: 'approved',
        storageLocation: 'Silo A'
      },
      { 
        id: 'BATCH-002', 
        product: 'Steel Beams', 
        quantity: 500, 
        productionDate: '2025-02-15', 
        expiryDate: 'N/A', 
        qualityStatus: 'pending',
        storageLocation: 'Zone C'
      }
    ];
    
    // Sample storage units
    storageUnits = [
      { 
        id: 'STOR-001', 
        name: 'Main Storage Rack', 
        type: 'pallet-rack', 
        capacity: 100, 
        location: 'Zone A', 
        utilization: 65 
      },
      { 
        id: 'STOR-002', 
        name: 'Cold Storage Unit', 
        type: 'cold-storage', 
        capacity: 50, 
        location: 'Zone B', 
        utilization: 40 
      },
      { 
        id: 'STOR-003', 
        name: 'Bulk Storage Area', 
        type: 'bulk-storage', 
        capacity: 500, 
        location: 'Zone C', 
        utilization: 30 
      }
    ];
    
    // Save to localStorage
    saveAllData();
  }

  // Render all data
  function renderAllData() {
    renderInventory();
    renderContainers();
    renderBatches();
    renderStorageUnits();
    updateStorageUtilization();
    updateInventorySummary();
  }

  // Render inventory table
  function renderInventory() {
    const tbody = document.getElementById('inventoryTableBody');
    tbody.innerHTML = '';
    
    inventory.forEach((item, index) => {
      const tr = document.createElement('tr');
      
      let statusText = 'Available';
      let statusClass = 'status-available';
      
      if (item.quantity === 0) {
        statusText = 'Out of Stock';
        statusClass = 'status-critical';
      } else if (item.quantity <= (item.minQuantity || 5)) {
        statusText = 'Low Stock';
        statusClass = 'status-low';
      }
      
      tr.innerHTML = `
        <td><input type="checkbox" class="selectItem" data-index="${index}"></td>
        <td><strong>${item.sku || item.id}</strong></td>
        <td>${item.name}</td>
        <td>${item.category}</td>
        <td>${item.quantity}</td>
        <td>${item.unit || 'pcs'}</td>
        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
        <td>${item.location}</td>
        <td>
          <div class="action-buttons-cell">
            <button class="btn btn-sm btn-info" onclick="viewItem(${index})">View</button>
            <button class="btn btn-sm btn-primary" onclick="editItem(${index})">Edit</button>
            <button class="btn btn-sm btn-danger" onclick="deleteItem(${index})">Delete</button>
          </div>
        </td>
      `;
      
      tbody.appendChild(tr);
    });
    
    updateBulkDeleteButton();
  }

  // Update inventory summary
  function updateInventorySummary() {
    const totalItems = inventory.length;
    const lowStock = inventory.filter(item => item.quantity > 0 && item.quantity <= (item.minQuantity || 5)).length;
    const outOfStock = inventory.filter(item => item.quantity === 0).length;
    const totalValue = inventory.reduce((sum, item) => sum + (item.quantity * (item.price || 0)), 0);
    
    document.getElementById('totalItemsCount').textContent = totalItems;
    document.getElementById('lowStockCount').textContent = lowStock;
    document.getElementById('outOfStockCount').textContent = outOfStock;
    document.getElementById('totalValue').textContent = `$${totalValue.toFixed(2)}`;
  }

  // View item details
  function viewItem(index) {
    const item = inventory[index];
    const content = document.getElementById('itemDetailsContent');
    
    content.innerHTML = `
      <div class="detail-item">
        <span class="detail-label">Item Name:</span>
        <span class="detail-value">${item.name}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">SKU:</span>
        <span class="detail-value">${item.sku || item.id}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">Category:</span>
        <span class="detail-value">${item.category}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">Quantity:</span>
        <span class="detail-value">${item.quantity} ${item.unit || 'pcs'}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">Unit Price:</span>
        <span class="detail-value">$${item.price?.toFixed(2) || '0.00'}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">Total Value:</span>
        <span class="detail-value">$${(item.quantity * (item.price || 0)).toFixed(2)}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">Location:</span>
        <span class="detail-value">${item.location}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">Minimum Quantity:</span>
        <span class="detail-value">${item.minQuantity || 'Not set'}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">Description:</span>
        <span class="detail-value">${item.description || 'No description'}</span>
      </div>
    `;
    
    // Set up edit and delete buttons
    document.getElementById('editFromViewBtn').onclick = function() {
      closeModal('viewItemModal');
      editItem(index);
    };
    
    document.getElementById('deleteFromViewBtn').onclick = function() {
      closeModal('viewItemModal');
      deleteItem(index);
    };
    
    openModal('viewItemModal');
  }

  // Edit item
  function editItem(index) {
    const item = inventory[index];
    currentEditIndex = index;
    currentEditType = 'item';
    
    document.getElementById('modalTitle').textContent = 'Edit Inventory Item';
    document.getElementById('itemIndex').value = index;
    document.getElementById('itemName').value = item.name;
    document.getElementById('itemSku').value = item.sku || '';
    document.getElementById('itemCategory').value = item.category || '';
    document.getElementById('itemQuantity').value = item.quantity;
    document.getElementById('itemUnit').value = item.unit || 'pcs';
    document.getElementById('itemPrice').value = item.price || 0;
    document.getElementById('itemLocation').value = item.location || '';
    document.getElementById('itemDescription').value = item.description || '';
    document.getElementById('itemMinQuantity').value = item.minQuantity || '';
    
    openModal('itemModal');
  }

  // Delete item with confirmation
  function deleteItem(index) {
    showConfirmation(
      'Delete Item',
      `Are you sure you want to delete "${inventory[index].name}"?`,
      function() {
        inventory.splice(index, 1);
        saveAllData();
        renderAllData();
        showNotification('Item deleted successfully!', 'success');
      }
    );
  }

  // Render containers table
  function renderContainers() {
    const tbody = document.getElementById('containerTableBody');
    tbody.innerHTML = '';
    
    containers.forEach((container, index) => {
      const tr = document.createElement('tr');
      
      tr.innerHTML = `
        <td><strong>${container.id}</strong></td>
        <td>${container.type}</td>
        <td><span class="status-badge status-available">${container.status}</span></td>
        <td>${container.location}</td>
        <td>${container.contents}</td>
        <td>${container.eta}</td>
        <td>
          <div class="action-buttons-cell">
            <button class="btn btn-sm btn-info" onclick="viewContainer(${index})">View</button>
            <button class="btn btn-sm btn-primary" onclick="editContainer(${index})">Edit</button>
            <button class="btn btn-sm btn-danger" onclick="deleteContainer(${index})">Delete</button>
          </div>
        </td>
      `;
      
      tbody.appendChild(tr);
    });
  }

  // View container details
  function viewContainer(index) {
    const container = containers[index];
    showNotification(`Container ${container.id} details:\nType: ${container.type}\nStatus: ${container.status}\nLocation: ${container.location}\nContents: ${container.contents}\nETA: ${container.eta}`, 'info');
  }

  // Edit container
  function editContainer(index) {
    const container = containers[index];
    currentEditIndex = index;
    currentEditType = 'container';
    
    document.getElementById('containerModalTitle').textContent = 'Edit Container';
    document.getElementById('containerIndex').value = index;
    document.getElementById('containerId').value = container.id;
    document.getElementById('containerType').value = container.type;
    document.getElementById('containerStatus').value = container.status;
    document.getElementById('containerLocation').value = container.location;
    document.getElementById('containerContents').value = container.contents;
    document.getElementById('containerETA').value = container.eta || '';
    
    openModal('containerModal');
  }

  // Delete container
  function deleteContainer(index) {
    showConfirmation(
      'Delete Container',
      `Are you sure you want to delete container "${containers[index].id}"?`,
      function() {
        containers.splice(index, 1);
        saveAllData();
        renderAllData();
        showNotification('Container deleted successfully!', 'success');
      }
    );
  }

  // Render batches table
  function renderBatches() {
    const tbody = document.getElementById('batchTableBody');
    tbody.innerHTML = '';
    
    batches.forEach((batch, index) => {
      const tr = document.createElement('tr');
      
      tr.innerHTML = `
        <td><strong>${batch.id}</strong></td>
        <td>${batch.product}</td>
        <td>${batch.quantity}</td>
        <td>${batch.productionDate}</td>
        <td>${batch.expiryDate || 'N/A'}</td>
        <td><span class="status-badge status-available">${batch.qualityStatus}</span></td>
        <td>
          <div class="action-buttons-cell">
            <button class="btn btn-sm btn-info" onclick="viewBatch(${index})">View</button>
            <button class="btn btn-sm btn-primary" onclick="editBatch(${index})">Edit</button>
            <button class="btn btn-sm btn-danger" onclick="deleteBatch(${index})">Delete</button>
          </div>
        </td>
      `;
      
      tbody.appendChild(tr);
    });
  }

  // View batch details
  function viewBatch(index) {
    const batch = batches[index];
    showNotification(`Batch ${batch.id} details:\nProduct: ${batch.product}\nQuantity: ${batch.quantity}\nProduction Date: ${batch.productionDate}\nExpiry Date: ${batch.expiryDate || 'N/A'}\nQuality Status: ${batch.qualityStatus}\nStorage: ${batch.storageLocation}`, 'info');
  }

  // Edit batch
  function editBatch(index) {
    const batch = batches[index];
    currentEditIndex = index;
    currentEditType = 'batch';
    
    document.getElementById('batchModalTitle').textContent = 'Edit Batch';
    document.getElementById('batchIndex').value = index;
    document.getElementById('batchId').value = batch.id;
    document.getElementById('batchProduct').value = batch.product;
    document.getElementById('batchQuantity').value = batch.quantity;
    document.getElementById('batchProductionDate').value = batch.productionDate;
    document.getElementById('batchExpiryDate').value = batch.expiryDate || '';
    document.getElementById('batchQualityStatus').value = batch.qualityStatus;
    document.getElementById('batchStorageLocation').value = batch.storageLocation || '';
    
    openModal('batchModal');
  }

  // Delete batch
  function deleteBatch(index) {
    showConfirmation(
      'Delete Batch',
      `Are you sure you want to delete batch "${batches[index].id}"?`,
      function() {
        batches.splice(index, 1);
        saveAllData();
        renderAllData();
        showNotification('Batch deleted successfully!', 'success');
      }
    );
  }

  // Render storage units
  function renderStorageUnits() {
    const container = document.getElementById('storageContainer');
    container.innerHTML = '';
    
    if (storageUnits.length === 0) {
      container.innerHTML = '<p style="grid-column: 1 / -1; text-align: center; padding: 20px; color: #7f8c8d;">No storage units configured. Click "Build Storage Units" to create some.</p>';
      return;
    }
    
    storageUnits.forEach((unit, index) => {
      const card = document.createElement('div');
      card.className = 'storage-card';
      
      card.innerHTML = `
        <div class="storage-header">
          <div class="storage-title">
            <h3>${unit.name}</h3>
            <div class="storage-id">${unit.id}</div>
          </div>
          <div class="storage-actions">
            <button onclick="editStorageUnit(${index})" title="Edit">‚úèÔ∏è</button>
            <button onclick="deleteStorageUnit(${index})" title="Delete">üóëÔ∏è</button>
          </div>
        </div>
        
        <div class="storage-details">
          <div class="storage-detail">
            <strong>Type:</strong>
            <span>${unit.type.replace('-', ' ').toUpperCase()}</span>
          </div>
          <div class="storage-detail">
            <strong>Capacity:</strong>
            <span>${unit.capacity} units</span>
          </div>
          <div class="storage-detail">
            <strong>Location:</strong>
            <span>${unit.location}</span>
          </div>
          <div class="storage-detail">
            <strong>Utilization:</strong>
            <span>${unit.utilization}%</span>
          </div>
        </div>
        
        <div class="storage-footer">
          <div class="utilization-bar">
            <div class="utilization-fill" style="width: ${unit.utilization}%"></div>
          </div>
          <div>
            <button class="btn btn-sm btn-info" onclick="viewStorageUnit(${index})">View</button>
          </div>
        </div>
      `;
      
      container.appendChild(card);
    });
  }

  // View storage unit details
  function viewStorageUnit(index) {
    const unit = storageUnits[index];
    showNotification(`Storage Unit ${unit.id} details:\nName: ${unit.name}\nType: ${unit.type}\nCapacity: ${unit.capacity} units\nLocation: ${unit.location}\nUtilization: ${unit.utilization}%`, 'info');
  }

  // Edit storage unit
  function editStorageUnit(index) {
    const unit = storageUnits[index];
    currentEditIndex = index;
    currentEditType = 'storage';
    
    document.getElementById('storageModalTitle').textContent = 'Edit Storage Unit';
    document.getElementById('storageIndex').value = index;
    document.getElementById('storageName').value = unit.name;
    document.getElementById('storageType').value = unit.type;
    document.getElementById('storageCapacity').value = unit.capacity;
    document.getElementById('storageLocation').value = unit.location;
    document.getElementById('storageUtilization').value = unit.utilization;
    
    openModal('storageModal');
  }

  // Delete storage unit
  function deleteStorageUnit(index) {
    showConfirmation(
      'Delete Storage Unit',
      `Are you sure you want to delete storage unit "${storageUnits[index].name}"?`,
      function() {
        storageUnits.splice(index, 1);
        saveAllData();
        renderAllData();
        showNotification('Storage unit deleted successfully!', 'success');
      }
    );
  }

  // Update storage utilization display
  function updateStorageUtilization() {
    const totalCapacity = storageUnits.reduce((sum, unit) => sum + unit.capacity, 0);
    const usedCapacity = storageUnits.reduce((sum, unit) => sum + (unit.capacity * (unit.utilization / 100)), 0);
    const usedPercent = totalCapacity > 0 ? Math.round((usedCapacity / totalCapacity) * 100) : 0;
    const freePercent = 100 - usedPercent;
    
    document.getElementById('usedSpace').style.width = `${usedPercent}%`;
    document.getElementById('freeSpace').style.width = `${freePercent}%`;
    document.getElementById('reservedSpace').style.width = `0%`;
    
    document.getElementById('usedPercent').textContent = `${usedPercent}%`;
    document.getElementById('freePercent').textContent = `${freePercent}%`;
    document.getElementById('reservedPercent').textContent = `0%`;
  }

  // Update bulk delete button visibility
  function updateBulkDeleteButton() {
    const checkedItems = document.querySelectorAll('.selectItem:checked');
    document.getElementById('bulkDeleteBtn').style.display = 
      checkedItems.length > 0 ? 'inline-block' : 'none';
  }

  // Save all data to localStorage
  function saveAllData() {
    localStorage.setItem('inventory', JSON.stringify(inventory));
    localStorage.setItem('containers', JSON.stringify(containers));
    localStorage.setItem('batches', JSON.stringify(batches));
    localStorage.setItem('storageUnits', JSON.stringify(storageUnits));
  }

  // Setup all event listeners
  function setupEventListeners() {
    // Navigation
    document.querySelectorAll('.nav-btn').forEach(btn => {
      if (btn.classList.contains('red')) return; // Skip the Home button
      btn.addEventListener('click', () => {
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(btn.dataset.target).classList.add('active');
      });
    });
    
    // Inventory tabs
    document.querySelectorAll('.inventory-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.inventory-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(tab.dataset.tab + '-tab').classList.add('active');
      });
    });
    
    // Select all checkbox
    document.getElementById('selectAll').addEventListener('change', function() {
      const checkboxes = document.querySelectorAll('.selectItem');
      checkboxes.forEach(checkbox => {
        checkbox.checked = this.checked;
      });
      updateBulkDeleteButton();
    });
    
    // Individual checkbox changes
    document.addEventListener('change', function(e) {
      if (e.target.classList.contains('selectItem')) {
        updateBulkDeleteButton();
      }
    });
    
    // Add item button
    document.getElementById('addItemBtn').addEventListener('click', () => {
      currentEditIndex = null;
      currentEditType = 'item';
      document.getElementById('modalTitle').textContent = 'Add Inventory Item';
      document.getElementById('itemForm').reset();
      document.getElementById('itemSku').value = 'ITEM-' + Math.random().toString(36).substr(2, 9).toUpperCase();
      openModal('itemModal');
    });
    
    // Add container button
    document.getElementById('addContainerBtn').addEventListener('click', () => {
      currentEditIndex = null;
      currentEditType = 'container';
      document.getElementById('containerModalTitle').textContent = 'Add Container';
      document.getElementById('containerForm').reset();
      document.getElementById('containerId').value = 'CONT-' + Math.random().toString(36).substr(2, 9).toUpperCase();
      openModal('containerModal');
    });
    
    // Add batch button
    document.getElementById('addBatchBtn').addEventListener('click', () => {
      currentEditIndex = null;
      currentEditType = 'batch';
      document.getElementById('batchModalTitle').textContent = 'Add Batch';
      document.getElementById('batchForm').reset();
      document.getElementById('batchId').value = 'BATCH-' + Math.random().toString(36).substr(2, 9).toUpperCase();
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('batchProductionDate').value = today;
      openModal('batchModal');
    });
    
    // Add storage unit button
    document.getElementById('addStorageBtn').addEventListener('click', () => {
      currentEditIndex = null;
      currentEditType = 'storage';
      document.getElementById('storageModalTitle').textContent = 'Add Storage Unit';
      document.getElementById('storageForm').reset();
      document.getElementById('storageUtilization').value = 0;
      openModal('storageModal');
    });
    
    // Build storage units button
    document.getElementById('buildStorageBtn').addEventListener('click', () => {
      if (storageUnits.length === 0) {
        // Create default storage units
        const defaultStorage = [
          { id: 'STOR-001', name: 'Main Storage Rack', type: 'pallet-rack', capacity: 100, location: 'Zone A', utilization: 65 },
          { id: 'STOR-002', name: 'Cold Storage Unit', type: 'cold-storage', capacity: 50, location: 'Zone B', utilization: 40 },
          { id: 'STOR-003', name: 'Bulk Storage Area', type: 'bulk-storage', capacity: 500, location: 'Zone C', utilization: 30 }
        ];
        
        storageUnits.push(...defaultStorage);
        saveAllData();
        renderAllData();
        showNotification('Storage units built successfully!', 'success');
      } else {
        showNotification('Storage units already exist. Use "Add Storage Unit" to create more.', 'warning');
      }
    });
    
    // Add zone button
    document.getElementById('addZoneBtn').addEventListener('click', () => {
      const zoneName = prompt('Enter zone name:');
      if (zoneName) {
        showNotification(`Zone "${zoneName}" added successfully`, 'success');
      }
    });
    
    // Optimize layout button
    document.getElementById('optimizeLayoutBtn').addEventListener('click', () => {
      // Simulate layout optimization
      storageUnits.forEach(unit => {
        // Increase utilization by 5-15% for demonstration
        const improvement = 5 + Math.floor(Math.random() * 10);
        unit.utilization = Math.min(100, unit.utilization + improvement);
      });
      
      saveAllData();
      renderAllData();
      showNotification('Warehouse layout optimized successfully! Storage utilization improved.', 'success');
    });
    
    // Import CSV button
    document.getElementById('importCSV').addEventListener('click', () => {
      // Create file input
      const fileInput = document.createElement('input');
      fileInput.type = 'file';
      fileInput.accept = '.csv';
      
      fileInput.onchange = (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (event) => {
            const csvData = event.target.result;
            const lines = csvData.split('\n');
            let importedCount = 0;
            
            for (let i = 1; i < lines.length; i++) {
              const line = lines[i].trim();
              if (line) {
                const [name, category, quantity, price, location] = line.split(',');
                
                if (name && category) {
                  inventory.push({
                    id: 'ITEM-' + Math.random().toString(36).substr(2, 9).toUpperCase(),
                    sku: 'IMP-' + Math.random().toString(36).substr(2, 6).toUpperCase(),
                    name: name.trim(),
                    category: category.trim(),
                    quantity: parseInt(quantity) || 0,
                    price: parseFloat(price) || 0,
                    location: location?.trim() || 'Unknown',
                    status: 'available',
                    unit: 'pcs'
                  });
                  importedCount++;
                }
              }
            }
            
            saveAllData();
            renderAllData();
            showNotification(`CSV imported successfully! Added ${importedCount} items.`, 'success');
          };
          reader.readAsText(file);
        }
      };
      
      fileInput.click();
    });
    
    // Export CSV button
    document.getElementById('exportCSV').addEventListener('click', () => {
      // Create CSV content
      let csv = 'Name,Category,Quantity,Price,Location,Status\n';
      inventory.forEach(item => {
        const status = item.quantity === 0 ? 'Out of Stock' : 
                      item.quantity <= (item.minQuantity || 5) ? 'Low Stock' : 'Available';
        csv += `${item.name},${item.category},${item.quantity},${item.price},${item.location},${status}\n`;
      });
      
      // Create download link
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `inventory_export_${new Date().toISOString().split('T')[0]}.csv`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showNotification('Inventory exported to CSV successfully', 'success');
    });
    
    // Batch Update button
    document.getElementById('batchUpdateBtn').addEventListener('click', () => {
      const checkedItems = document.querySelectorAll('.selectItem:checked');
      if (checkedItems.length === 0) {
        showNotification('Please select at least one item to update', 'warning');
        return;
      }
      document.getElementById('batchUpdateSection').classList.add('active');
    });
    
    // Apply Batch Update button
    document.getElementById('applyBatchUpdate').addEventListener('click', () => {
      const field = document.getElementById('batchField').value;
      const value = document.getElementById('batchValue').value;
      
      if (!value) {
        showNotification('Please enter a value for the batch update', 'warning');
        return;
      }
      
      const checkedItems = document.querySelectorAll('.selectItem:checked');
      const indices = Array.from(checkedItems).map(item => 
        parseInt(item.dataset.index)).sort((a, b) => b - a);
      
      let updateCount = 0;
      indices.forEach(index => {
        if (field === 'quantity') {
          inventory[index].quantity = parseInt(value);
          updateCount++;
        } else if (field === 'price') {
          inventory[index].price = parseFloat(value);
          updateCount++;
        } else if (field === 'location') {
          inventory[index].location = value;
          updateCount++;
        } else if (field === 'category') {
          inventory[index].category = value;
          updateCount++;
        } else if (field === 'status') {
          inventory[index].status = value;
          updateCount++;
        }
      });
      
      saveAllData();
      renderAllData();
      document.getElementById('batchUpdateSection').classList.remove('active');
      document.getElementById('batchValue').value = '';
      
      showNotification(`Batch update completed! ${updateCount} items updated.`, 'success');
    });
    
    // Cancel Batch Update button
    document.getElementById('cancelBatchUpdate').addEventListener('click', () => {
      document.getElementById('batchUpdateSection').classList.remove('active');
      document.getElementById('batchValue').value = '';
    });
    
    // Bulk delete button
    document.getElementById('bulkDeleteBtn').addEventListener('click', () => {
      const checkedItems = document.querySelectorAll('.selectItem:checked');
      if (checkedItems.length === 0) return;
      
      showConfirmation(
        'Delete Items',
        `Are you sure you want to delete ${checkedItems.length} selected item(s)?`,
        () => {
          const indices = Array.from(checkedItems).map(item => 
            parseInt(item.dataset.index)).sort((a, b) => b - a);
          
          indices.forEach(index => {
            inventory.splice(index, 1);
          });
          
          saveAllData();
          renderAllData();
          document.getElementById('selectAll').checked = false;
          
          showNotification(`${indices.length} items deleted successfully`, 'success');
        }
      );
    });
    
    // Item form submission
    document.getElementById('itemForm').addEventListener('submit', e => {
      e.preventDefault();
      const newItem = {
        id: 'ITEM-' + Math.random().toString(36).substr(2, 9).toUpperCase(),
        name: document.getElementById('itemName').value,
        sku: document.getElementById('itemSku').value,
        category: document.getElementById('itemCategory').value,
        quantity: parseInt(document.getElementById('itemQuantity').value),
        unit: document.getElementById('itemUnit').value,
        price: parseFloat(document.getElementById('itemPrice').value),
        location: document.getElementById('itemLocation').value,
        description: document.getElementById('itemDescription').value,
        minQuantity: document.getElementById('itemMinQuantity').value ? parseInt(document.getElementById('itemMinQuantity').value) : null,
        status: 'available'
      };
      
      if (currentEditIndex !== null && currentEditType === 'item') {
        inventory[currentEditIndex] = newItem;
        showNotification('Item updated successfully!', 'success');
      } else {
        inventory.push(newItem);
        showNotification('Item added successfully!', 'success');
      }
      
      saveAllData();
      renderAllData();
      closeModal('itemModal');
    });
    
    // Storage form submission
    document.getElementById('storageForm').addEventListener('submit', e => {
      e.preventDefault();
      const newUnit = {
        id: 'STOR-' + Math.random().toString(36).substr(2, 9).toUpperCase(),
        name: document.getElementById('storageName').value,
        type: document.getElementById('storageType').value,
        capacity: parseInt(document.getElementById('storageCapacity').value),
        location: document.getElementById('storageLocation').value,
        utilization: parseInt(document.getElementById('storageUtilization').value)
      };
      
      if (currentEditIndex !== null && currentEditType === 'storage') {
        storageUnits[currentEditIndex] = newUnit;
        showNotification('Storage unit updated successfully!', 'success');
      } else {
        storageUnits.push(newUnit);
        showNotification('Storage unit added successfully!', 'success');
      }
      
      saveAllData();
      renderAllData();
      closeModal('storageModal');
    });
    
    // Container form submission
    document.getElementById('containerForm').addEventListener('submit', e => {
      e.preventDefault();
      const newContainer = {
        id: document.getElementById('containerId').value,
        type: document.getElementById('containerType').value,
        status: document.getElementById('containerStatus').value,
        location: document.getElementById('containerLocation').value,
        contents: document.getElementById('containerContents').value,
        eta: document.getElementById('containerETA').value || 'N/A'
      };
      
      if (currentEditIndex !== null && currentEditType === 'container') {
        containers[currentEditIndex] = newContainer;
        showNotification('Container updated successfully!', 'success');
      } else {
        containers.push(newContainer);
        showNotification('Container added successfully!', 'success');
      }
      
      saveAllData();
      renderAllData();
      closeModal('containerModal');
    });
    
    // Batch form submission
    document.getElementById('batchForm').addEventListener('submit', e => {
      e.preventDefault();
      const newBatch = {
        id: document.getElementById('batchId').value,
        product: document.getElementById('batchProduct').value,
        quantity: parseInt(document.getElementById('batchQuantity').value),
        productionDate: document.getElementById('batchProductionDate').value,
        expiryDate: document.getElementById('batchExpiryDate').value || 'N/A',
        qualityStatus: document.getElementById('batchQualityStatus').value,
        storageLocation: document.getElementById('batchStorageLocation').value
      };
      
      if (currentEditIndex !== null && currentEditType === 'batch') {
        batches[currentEditIndex] = newBatch;
        showNotification('Batch updated successfully!', 'success');
      } else {
        batches.push(newBatch);
        showNotification('Batch added successfully!', 'success');
      }
      
      saveAllData();
      renderAllData();
      closeModal('batchModal');
    });
    
    // Close modals
    document.querySelectorAll('.close').forEach(closeBtn => {
      closeBtn.addEventListener('click', function() {
        const modal = this.closest('.modal');
        modal.classList.remove('active');
      });
    });
    
    // Close modals when clicking outside
    window.addEventListener('click', (e) => {
      if (e.target.classList.contains('modal')) {
        e.target.classList.remove('active');
      }
    });
    
    // Refresh buttons
    document.getElementById('refreshItems').addEventListener('click', () => {
      renderAllData();
      showNotification('Inventory data refreshed!', 'info');
    });
    
    document.getElementById('refreshContainers').addEventListener('click', () => {
      renderContainers();
      showNotification('Containers data refreshed!', 'info');
    });
    
    document.getElementById('refreshBatches').addEventListener('click', () => {
      renderBatches();
      showNotification('Batches data refreshed!', 'info');
    });
    
    document.getElementById('refreshWarehouse').addEventListener('click', () => {
      renderStorageUnits();
      updateStorageUtilization();
      showNotification('Warehouse data refreshed!', 'info');
    });
    
    // Track container button
    document.getElementById('trackContainerBtn').addEventListener('click', () => {
      if (containers.length === 0) {
        showNotification('No containers available to track', 'warning');
        return;
      }
      
      let trackingInfo = 'Container Tracking Status:\n\n';
      containers.forEach(container => {
        trackingInfo += `${container.id}: ${container.status} at ${container.location}\n`;
      });
      
      showNotification(trackingInfo, 'info');
    });
    
    // Quality check button
    document.getElementById('qualityCheckBtn').addEventListener('click', () => {
      if (batches.length === 0) {
        showNotification('No batches available for quality check', 'warning');
        return;
      }
      
      let qualityReport = 'Quality Check Report:\n\n';
      batches.forEach(batch => {
        qualityReport += `${batch.id}: ${batch.qualityStatus}\n`;
      });
      
      showNotification(qualityReport, 'info');
    });
    
    // Export batches button
    document.getElementById('exportBatchesBtn').addEventListener('click', () => {
      // Create CSV content for batches
      let csv = 'Batch ID,Product,Quantity,Production Date,Expiry Date,Quality Status\n';
      batches.forEach(batch => {
        csv += `${batch.id},${batch.product},${batch.quantity},${batch.productionDate},${batch.expiryDate},${batch.qualityStatus}\n`;
      });
      
      // Create download link
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `batches_export_${new Date().toISOString().split('T')[0]}.csv`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showNotification('Batches exported to CSV successfully', 'success');
    });
    
    // Report generation functions
    window.generateStockReport = function() {
      const lowStock = inventory.filter(item => item.quantity <= (item.minQuantity || 5));
      let report = 'Stock Level Report:\n\n';
      
      if (lowStock.length === 0) {
        report += 'All items have sufficient stock levels.';
      } else {
        report += 'Items with low stock:\n';
        lowStock.forEach(item => {
          report += `${item.name} (${item.sku}): ${item.quantity} ${item.unit} - Minimum: ${item.minQuantity || 5}\n`;
        });
      }
      
      showNotification(report, 'info');
    };
    
    window.generateExpiryReport = function() {
      const today = new Date();
      const upcomingBatches = batches.filter(batch => {
        if (batch.expiryDate === 'N/A') return false;
        const expiryDate = new Date(batch.expiryDate);
        const daysDiff = Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));
        return daysDiff <= 30; // Items expiring within 30 days
      });
      
      let report = 'Expiry Report:\n\n';
      
      if (upcomingBatches.length === 0) {
        report += 'No items expiring within the next 30 days.';
      } else {
        report += 'Items expiring soon:\n';
        upcomingBatches.forEach(batch => {
          report += `${batch.product} (${batch.id}): Expires ${batch.expiryDate}\n`;
        });
      }
      
      showNotification(report, 'info');
    };
    
    window.generateValueReport = function() {
      const categoryValue = {};
      inventory.forEach(item => {
        const value = item.quantity * (item.price || 0);
        categoryValue[item.category] = (categoryValue[item.category] || 0) + value;
      });
      
      let report = 'Inventory Value Report:\n\n';
      Object.entries(categoryValue).forEach(([category, value]) => {
        report += `${category}: $${value.toFixed(2)}\n`;
      });
      
      const totalValue = Object.values(categoryValue).reduce((sum, val) => sum + val, 0);
      report += `\nTotal Inventory Value: $${totalValue.toFixed(2)}`;
      
      showNotification(report, 'info');
    };
    
    // Confirm modal
    document.getElementById('confirmYes').addEventListener('click', function() {
      const action = this.dataset.action;
      if (action && window[action]) {
        window[action]();
      }
      closeModal('confirmModal');
    });
    
    document.getElementById('confirmNo').addEventListener('click', function() {
      closeModal('confirmModal');
    });
  }

  // Modal functions
  function openModal(modalId) {
    document.getElementById(modalId).classList.add('active');
  }

  function closeModal(modalId) {
    document.getElementById(modalId).classList.remove('active');
  }

  // Show confirmation dialog
  function showConfirmation(title, message, yesCallback) {
    document.getElementById('confirmTitle').textContent = title;
    document.getElementById('confirmMessage').textContent = message;
    document.getElementById('confirmYes').dataset.action = 'tempAction';
    
    // Create temporary function for the yes callback
    window.tempAction = yesCallback;
    
    openModal('confirmModal');
  }

  // Show notification
  function showNotification(message, type = 'info') {
    alert(message);
  }

  // Navigation functions
  function goToHome() {
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.querySelector('[data-target="inventory"]').classList.add('active');
    document.getElementById('inventory').classList.add('active');
  }

  function goToMainERP() {
    window.location.href = 'https://cephasgm.github.io/CephasGM-ERP/';
  }

  // Initialize the application when the page loads
  window.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
