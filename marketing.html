<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marketing & Business Intelligence - CephasGM ERP</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="manifest" href="manifest.json">
    <style>
        /* Root & Global styles - preserved and enhanced with new variables */
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --background: #f8fafc;
            --surface: #ffffff;
            --text: #1e293b;
            --text-light: #64748b;
            --border: #e2e8f0;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --marketing-pink: #ec4899;
            --marketing-purple: #a855f7;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--background);
            color: var(--text);
            line-height: 1.6;
        }

        .dashboard { display: grid; grid-template-columns: 280px 1fr; min-height: 100vh; }
        .sidebar { background: var(--surface); border-right: 1px solid var(--border); padding: 2rem 1rem; position: fixed; width: 280px; height: 100vh; overflow-y: auto; z-index: 100; }
        .logo { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 2rem; padding: 0 1rem; }
        .logo-icon { width: 40px; height: 40px; background: var(--primary); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 1.25rem; }
        .nav-section { margin-bottom: 2rem; }
        .nav-title { font-size: 0.75rem; text-transform: uppercase; color: var(--text-light); margin-bottom: 1rem; padding: 0 1rem; letter-spacing: 0.5px; }
        .nav-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; border-radius: 8px; color: var(--text-light); text-decoration: none; transition: all 0.2s; margin-bottom: 0.25rem; border: none; background: none; width: 100%; text-align: left; cursor: pointer; font-size: 0.95rem; }
        .nav-item:hover, .nav-item.active { background: var(--primary); color: white; }
        .nav-icon { font-size: 1.25rem; width: 24px; text-align: center; }
        .main-content { grid-column: 2; padding: 2rem; margin-left: 280px; }

        /* Header & Buttons */
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem; }
        .header h1 { font-size: 1.875rem; font-weight: 700; }
        .header-actions { display: flex; gap: 1rem; align-items: center; flex-wrap: wrap; }
        .btn { padding: 0.75rem 1.5rem; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; gap: 0.5rem; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-secondary { background: var(--surface); color: var(--text); border: 1px solid var(--border); }
        .btn-secondary:hover { background: var(--background); }
        .btn-marketing { background: linear-gradient(135deg, var(--marketing-pink), var(--marketing-purple)); color: white; }
        .btn-marketing:hover { background: linear-gradient(135deg, #db2777, #9333ea); }
        .btn-success { background: var(--success); color: white; }
        .btn-success:hover { background: #0b9f6e; }
        .btn-warning { background: var(--warning); color: white; }
        .btn-danger { background: var(--error); color: white; }
        .btn-sm { padding: 0.25rem 0.75rem; font-size: 0.875rem; }
        .btn-icon { background: none; border: none; color: var(--text-light); cursor: pointer; padding: 0.25rem; }
        .btn-icon:hover { color: var(--primary); }

        /* Cards & Grids */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .stat-card { background: var(--surface); padding: 1.5rem; border-radius: 12px; border: 1px solid var(--border); box-shadow: var(--shadow); text-align: center; transition: transform 0.2s; position: relative; }
        .stat-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-lg); }
        .stat-card .edit-controls { position: absolute; top: 0.5rem; right: 0.5rem; display: none; gap: 0.25rem; }
        .stat-card:hover .edit-controls { display: flex; }
        .stat-number { font-size: 2.5rem; font-weight: 700; color: var(--primary); margin-bottom: 0.5rem; cursor: pointer; }
        .stat-number-input { font-size: 1.5rem; width: 100%; padding: 0.5rem; border: 2px solid var(--primary); border-radius: 6px; margin-bottom: 0.5rem; display: none; }
        .stat-label { color: var(--text-light); font-size: 0.9rem; }

        .campaigns-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .campaign-card { background: var(--surface); padding: 1.5rem; border-radius: 12px; border: 1px solid var(--border); box-shadow: var(--shadow); transition: transform 0.2s; position: relative; }
        .campaign-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-lg); }
        .campaign-card .edit-controls { position: absolute; top: 0.5rem; right: 0.5rem; display: none; gap: 0.25rem; }
        .campaign-card:hover .edit-controls { display: flex; }
        .card-header { display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem; }
        .card-icon { width: 50px; height: 50px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; background: linear-gradient(135deg, var(--primary), #3b82f6); color: white; }
        .card-title { font-size: 1.25rem; font-weight: 600; }
        .badge { display: inline-block; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem; font-weight: 600; margin-right: 0.25rem; }
        .badge-primary { background: var(--primary); color: white; }
        .badge-secondary { background: var(--secondary); color: white; }
        .badge-success { background: var(--success); color: white; }
        .badge-warning { background: var(--warning); color: white; }
        .badge-error { background: var(--error); color: white; }

        .metric-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
        .metric-item { text-align: center; padding: 1rem; background: var(--background); border-radius: 8px; position: relative; }
        .metric-item .edit-metric { position: absolute; top: 0.25rem; right: 0.25rem; font-size: 0.75rem; opacity: 0; transition: opacity 0.2s; cursor: pointer; }
        .metric-item:hover .edit-metric { opacity: 1; }
        .metric-value { font-size: 1.5rem; font-weight: 700; color: var(--primary); margin-bottom: 0.25rem; cursor: pointer; }
        .metric-value-input { font-size: 1rem; width: 100%; padding: 0.25rem; border: 2px solid var(--primary); border-radius: 4px; margin-bottom: 0.25rem; display: none; }
        .metric-label { font-size: 0.875rem; color: var(--text-light); }

        .progress-bar { height: 8px; background: var(--border); border-radius: 4px; overflow: hidden; margin-top: 0.5rem; width: 100%; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--marketing-pink), var(--marketing-purple)); border-radius: 4px; transition: width 0.5s ease; color: white; font-size: 0.7rem; text-align: center; line-height: 8px; }

        /* BI Dashboard */
        .bi-dashboard { background: var(--surface); border-radius: 12px; border: 1px solid var(--border); padding: 1.5rem; margin-bottom: 2rem; box-shadow: var(--shadow); }
        .bi-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem; }
        .bi-title { font-size: 1.25rem; font-weight: 600; }
        .bi-filters { display: flex; gap: 1rem; flex-wrap: wrap; }
        .bi-filter { padding: 0.5rem 1rem; border: 1px solid var(--border); border-radius: 6px; background: var(--background); font-size: 0.875rem; }
        .bi-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem; }
        .bi-chart { background: var(--background); border-radius: 8px; padding: 1.5rem; height: 300px; position: relative; }
        .chart-container { width: 100%; height: 100%; display: flex; flex-direction: column; }
        .chart-bars { display: flex; justify-content: space-around; align-items: flex-end; height: 200px; margin-bottom: 1rem; }
        .chart-bar { width: 60px; background: linear-gradient(135deg, var(--primary), var(--marketing-purple)); border-radius: 6px 6px 0 0; position: relative; transition: height 0.5s ease; cursor: pointer; }
        .chart-bar:hover { opacity: 0.9; }
        .chart-bar-label { position: absolute; bottom: -25px; left: 50%; transform: translateX(-50%); font-size: 0.75rem; white-space: nowrap; }
        .chart-bar-value { position: absolute; top: -25px; left: 50%; transform: translateX(-50%); font-size: 0.75rem; font-weight: 600; background: var(--surface); padding: 0.25rem 0.5rem; border-radius: 4px; border: 1px solid var(--border); }
        .chart-legend { display: flex; justify-content: center; gap: 2rem; margin-top: 1rem; }
        .legend-item { display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; }
        .legend-color { width: 12px; height: 12px; border-radius: 4px; }

        .bi-metrics { display: flex; flex-direction: column; gap: 1rem; }
        .bi-metric { background: var(--background); padding: 1rem; border-radius: 8px; text-align: center; transition: transform 0.2s; cursor: pointer; position: relative; }
        .bi-metric:hover { transform: translateY(-2px); box-shadow: var(--shadow); }
        .bi-metric .edit-bi { position: absolute; top: 0.25rem; right: 0.25rem; font-size: 0.75rem; opacity: 0; transition: opacity 0.2s; }
        .bi-metric:hover .edit-bi { opacity: 1; }
        .bi-value { font-size: 1.75rem; font-weight: 700; color: var(--primary); cursor: pointer; }
        .bi-value-input { font-size: 1.25rem; width: 100%; padding: 0.25rem; border: 2px solid var(--primary); border-radius: 4px; margin-bottom: 0.25rem; display: none; }
        .bi-label { font-size: 0.875rem; color: var(--text-light); margin-top: 0.25rem; }

        .channels-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .channel-card { background: var(--surface); padding: 1.5rem; border-radius: 12px; border: 1px solid var(--border); text-align: center; box-shadow: var(--shadow); transition: transform 0.2s; position: relative; cursor: pointer; }
        .channel-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-lg); }
        .channel-card .edit-controls { position: absolute; top: 0.5rem; right: 0.5rem; display: none; gap: 0.25rem; }
        .channel-card:hover .edit-controls { display: flex; }
        .channel-icon { font-size: 2rem; margin-bottom: 1rem; }
        .channel-name { font-weight: 600; margin-bottom: 0.5rem; cursor: pointer; }
        .channel-name-input { font-size: 1rem; width: 100%; padding: 0.25rem; border: 2px solid var(--primary); border-radius: 4px; margin-bottom: 0.5rem; display: none; }
        .channel-link { display: inline-block; margin-top: 0.5rem; padding: 0.25rem 0.75rem; background: var(--primary); color: white; text-decoration: none; border-radius: 4px; font-size: 0.875rem; }
        .channel-link:hover { background: var(--primary-dark); }
        .channel-stats { display: flex; justify-content: space-around; margin-top: 1rem; }
        .channel-stat { text-align: center; }
        .channel-value { font-weight: 700; color: var(--primary); cursor: pointer; }
        .channel-value-input { font-size: 1rem; width: 100%; padding: 0.25rem; border: 2px solid var(--primary); border-radius: 4px; display: none; }
        .channel-label { font-size: 0.75rem; color: var(--text-light); }

        .module-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 3rem; }
        .module-card { background: var(--surface); padding: 2rem; border-radius: 12px; border: 1px solid var(--border); cursor: pointer; transition: all 0.3s ease; text-decoration: none; color: inherit; display: block; box-shadow: var(--shadow); position: relative; }
        .module-card:hover { transform: translateY(-4px); box-shadow: var(--shadow-lg); border-color: var(--marketing-pink); }
        .module-card .edit-controls { position: absolute; top: 0.5rem; right: 0.5rem; display: none; gap: 0.25rem; }
        .module-card:hover .edit-controls { display: flex; }
        .module-icon { width: 60px; height: 60px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.75rem; margin-bottom: 1rem; background: linear-gradient(135deg, var(--marketing-pink), var(--marketing-purple)); color: white; }
        .module-card h3 { font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem; cursor: pointer; }
        .module-card p { color: var(--text-light); font-size: 0.95rem; cursor: pointer; }

        /* Modal */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); overflow-y: auto; }
        .modal-content { background-color: var(--surface); margin: 5% auto; padding: 2rem; border: 1px solid var(--border); border-radius: 12px; width: 90%; max-width: 800px; position: relative; max-height: 80vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
        .modal-close { font-size: 1.5rem; cursor: pointer; color: var(--text-light); }
        .modal-close:hover { color: var(--text); }
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 6px; font-size: 1rem; background: var(--surface); color: var(--text); }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }

        /* Tabs */
        .tab-container { margin-bottom: 2rem; }
        .tabs { display: flex; gap: 0.5rem; border-bottom: 2px solid var(--border); padding-bottom: 0.5rem; margin-bottom: 1.5rem; flex-wrap: wrap; }
        .tab { padding: 0.75rem 1.5rem; background: var(--surface); border: 1px solid var(--border); border-radius: 8px 8px 0 0; cursor: pointer; font-weight: 600; transition: all 0.2s; }
        .tab:hover { background: var(--primary); color: white; }
        .tab.active { background: var(--primary); color: white; border-color: var(--primary); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .insight-card { background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 1rem; margin-bottom: 1rem; cursor: pointer; transition: all 0.2s; }
        .insight-card:hover { transform: translateX(4px); border-color: var(--primary); }

        .workflow-item { display: flex; align-items: center; gap: 1rem; padding: 1rem; background: var(--background); border-radius: 8px; margin-bottom: 0.5rem; cursor: pointer; }
        .workflow-item:hover { background: var(--surface); box-shadow: var(--shadow); }

        .currency-selector, .language-selector { display: flex; align-items: center; gap: 0.5rem; }
        .currency-selector select, .language-selector select { padding: 0.5rem; border-radius: 6px; border: 1px solid var(--border); background: var(--surface); color: var(--text); }

        .dark-mode-toggle { background: none; border: none; font-size: 1.25rem; cursor: pointer; color: var(--text-light); padding: 0.5rem; border-radius: 6px; transition: all 0.2s; }
        .dark-mode-toggle:hover { background: var(--background); color: var(--text); }

        .footer { text-align: center; padding: 2rem; margin-top: 3rem; color: var(--text-light); border-top: 1px solid var(--border); }

        .mobile-nav-toggle { display: none; position: fixed; top: 1rem; left: 1rem; z-index: 1000; background: var(--primary); color: white; border: none; border-radius: 8px; width: 40px; height: 40px; align-items: center; justify-content: center; cursor: pointer; }

        .dark-mode { --background: #0f172a; --surface: #1e293b; --text: #f1f5f9; --text-light: #94a3b8; --border: #334155; }

        @media (max-width: 1024px) {
            .dashboard { grid-template-columns: 1fr; }
            .sidebar { transform: translateX(-100%); transition: transform 0.3s ease; }
            .sidebar.active { transform: translateX(0); }
            .main-content { margin-left: 0; grid-column: 1; padding: 1rem; }
            .mobile-nav-toggle { display: flex; }
            .bi-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <button class="mobile-nav-toggle" id="mobileNavToggle" aria-label="Toggle navigation">
        <i class="fas fa-bars"></i>
    </button>

    <div class="dashboard">
        <!-- Sidebar Navigation (Preserved) -->
        <nav class="sidebar" id="sidebar">
            <div class="logo">
                <div class="logo-icon">CG</div>
                <div>
                    <div style="font-weight: 700; font-size: 1.25rem;">CephasGM</div>
                    <div style="font-size: 0.875rem; color: var(--text-light);">ERP System</div>
                </div>
            </div>
            <div class="nav-section">
                <div class="nav-title">Marketing & Sales</div>
                <a href="marketing.html" class="nav-item active"><span class="nav-icon">üì¢</span> Marketing & BI</a>
                <a href="sales.html" class="nav-item"><span class="nav-icon">üí∞</span> Sales & CRM</a>
                <a href="customer-service.html" class="nav-item"><span class="nav-icon">üéØ</span> Customer Service</a>
            </div>
            <div class="nav-section">
                <div class="nav-title">Digital Channels</div>
                <a href="#" class="nav-item" onclick="openModule('social-media'); return false;"><span class="nav-icon">üì±</span> Social Media</a>
                <a href="#" class="nav-item" onclick="openModule('seo-analytics'); return false;"><span class="nav-icon">üîç</span> SEO & Analytics</a>
                <a href="#" class="nav-item" onclick="openModule('email-marketing'); return false;"><span class="nav-icon">‚úâÔ∏è</span> Email Marketing</a>
            </div>
            <div class="nav-section">
                <div class="nav-title">Business Intelligence</div>
                <a href="#" class="nav-item" onclick="openModule('advanced-reports'); return false;"><span class="nav-icon">üìä</span> Advanced Reports</a>
                <a href="#" class="nav-item" onclick="openModule('data-analytics'); return false;"><span class="nav-icon">üìà</span> Data Analytics</a>
                <a href="#" class="nav-item" onclick="openModule('forecasting'); return false;"><span class="nav-icon">üîÆ</span> Forecasting</a>
            </div>
            <div class="nav-section">
                <div class="nav-title">Operations</div>
                <a href="index.html" class="nav-item"><span class="nav-icon">üìä</span> Dashboard</a>
                <a href="projects.html" class="nav-item"><span class="nav-icon">üìÅ</span> Projects</a>
                <a href="finance.html" class="nav-item"><span class="nav-icon">üí≥</span> Finance</a>
            </div>
            <div class="nav-section">
                <div class="nav-title">User</div>
                <div class="nav-item" onclick="openModule('marketing-manager'); return false;"><span class="nav-icon">üë§</span> <span id="userRole">Marketing Manager</span></div>
                <button class="nav-item" id="logoutBtn"><span class="nav-icon">üö™</span> Logout</button>
            </div>
        </nav>

        <main class="main-content">
            <!-- Header with Global Controls -->
            <div class="header">
                <div>
                    <h1 id="pageTitle">Marketing & Business Intelligence</h1>
                    <div style="color: var(--text-light);">Integrated, multi-national marketing operations platform</div>
                </div>
                <div class="header-actions">
                    <div class="currency-selector">
                        <span>Currency:</span>
                        <select id="currencySelect">
                            <option value="TZS">TZS - Tanzanian Shilling</option><option value="USD">USD - US Dollar</option><option value="EUR">EUR - Euro</option><option value="GBP">GBP - British Pound</option><option value="KES">KES - Kenyan Shilling</option>
                        </select>
                    </div>
                    <div class="language-selector">
                        <span>Language:</span>
                        <select id="languageSelect"><option value="en">English</option><option value="sw">Swahili</option></select>
                    </div>
                    <button class="dark-mode-toggle" id="darkModeToggle" aria-label="Toggle dark mode"><i class="fas fa-moon"></i></button>
                    <button class="btn btn-marketing" id="newCampaignBtn"><i class="fas fa-plus"></i> New Campaign</button>
                </div>
            </div>

            <!-- Tabs Navigation (Enhanced) -->
            <div class="tab-container">
                <div class="tabs">
                    <button class="tab active" data-tab="overview">Overview</button>
                    <button class="tab" data-tab="campaigns">Campaigns</button>
                    <button class="tab" data-tab="analytics">Analytics</button>
                    <button class="tab" data-tab="social">Social Media</button>
                    <button class="tab" data-tab="seo">SEO & SEM</button>
                    <button class="tab" data-tab="email">Email Marketing</button>
                    <button class="tab" data-tab="content">Content</button>
                    <button class="tab" data-tab="insights">Customer Insights</button>
                    <button class="tab" data-tab="predictive">Predictive</button>
                    <button class="tab" data-tab="competitive">Competitive</button>
                    <button class="tab" data-tab="automation">Automation</button>
                    <button class="tab" data-tab="reports">Reports</button>
                </div>

                <!-- ========== OVERVIEW TAB (Executive Dashboard) ========== -->
                <div class="tab-content active" id="tab-overview">
                    <div class="stats-grid">
                        <div class="stat-card" data-stat="budget"><div class="edit-controls"><button class="btn btn-sm btn-secondary edit-stat" title="Edit"><i class="fas fa-edit"></i></button><button class="btn btn-sm btn-success save-stat" style="display:none;"><i class="fas fa-save"></i></button></div><div class="stat-number" id="marketingBudget">TZS 8.2M</div><input type="text" class="stat-number-input" id="budgetInput" value="8200000" style="display:none;"><div class="stat-label">Marketing Budget</div></div>
                        <div class="stat-card" data-stat="roi"><div class="edit-controls"><button class="btn btn-sm btn-secondary edit-stat"><i class="fas fa-edit"></i></button><button class="btn btn-sm btn-success save-stat" style="display:none;"><i class="fas fa-save"></i></button></div><div class="stat-number" id="roiQuarter">24%</div><input type="text" class="stat-number-input" id="roiInput" value="24" style="display:none;"><div class="stat-label">ROI This Quarter</div></div>
                        <div class="stat-card" data-stat="reach"><div class="edit-controls"><button class="btn btn-sm btn-secondary edit-stat"><i class="fas fa-edit"></i></button><button class="btn btn-sm btn-success save-stat" style="display:none;"><i class="fas fa-save"></i></button></div><div class="stat-number" id="totalReach">156K</div><input type="text" class="stat-number-input" id="reachInput" value="156000" style="display:none;"><div class="stat-label">Total Reach</div></div>
                        <div class="stat-card" data-stat="conversion"><div class="edit-controls"><button class="btn btn-sm btn-secondary edit-stat"><i class="fas fa-edit"></i></button><button class="btn btn-sm btn-success save-stat" style="display:none;"><i class="fas fa-save"></i></button></div><div class="stat-number" id="conversionRate">4.2%</div><input type="text" class="stat-number-input" id="conversionInput" value="4.2" style="display:none;"><div class="stat-label">Conversion Rate</div></div>
                    </div>
                    <div class="bi-dashboard">
                        <div class="bi-header">
                            <div class="bi-title">Executive Dashboard</div>
                            <div class="bi-filters">
                                <select class="bi-filter" id="timeFilter"><option value="7">Last 7 Days</option><option value="30" selected>Last 30 Days</option><option value="90">Last Quarter</option><option value="365">Last Year</option></select>
                                <select class="bi-filter" id="channelFilter"><option value="all">All Channels</option><option value="digital">Digital Only</option><option value="traditional">Traditional Only</option></select>
                            </div>
                        </div>
                        <div class="bi-grid">
                            <div class="bi-chart">
                                <div class="chart-container">
                                    <div class="chart-bars" id="revenueChart">
                                        <div class="chart-bar" style="height: 180px;" data-value="4800000"><span class="chart-bar-value" id="chartValue1">TZS 4.8M</span><span class="chart-bar-label">Revenue</span></div>
                                        <div class="chart-bar" style="height: 150px;" data-value="3200000"><span class="chart-bar-value" id="chartValue2">TZS 3.2M</span><span class="chart-bar-label">Campaigns</span></div>
                                        <div class="chart-bar" style="height: 100px;" data-value="1800000"><span class="chart-bar-value" id="chartValue3">TZS 1.8M</span><span class="chart-bar-label">Conversions</span></div>
                                    </div>
                                    <div class="chart-legend"><div class="legend-item"><div class="legend-color" style="background: var(--primary);"></div><span>Revenue vs Campaign Spend vs Conversions</span></div></div>
                                </div>
                            </div>
                            <div class="bi-metrics">
                                <div class="bi-metric" data-bi="revenue"><i class="fas fa-edit edit-bi" title="Edit metric"></i><div class="bi-value" id="revenueGenerated">TZS 4.8M</div><input type="text" class="bi-value-input" id="revenueInput" value="4800000" style="display:none;"><div class="bi-label">Revenue Generated</div></div>
                                <div class="bi-metric" data-bi="roiRatio"><i class="fas fa-edit edit-bi"></i><div class="bi-value" id="roiRatio">3.2:1</div><input type="text" class="bi-value-input" id="roiRatioInput" value="3.2" style="display:none;"><div class="bi-label">ROI Ratio</div></div>
                                <div class="bi-metric" data-bi="marketShare"><i class="fas fa-edit edit-bi"></i><div class="bi-value" id="marketShare">42%</div><input type="text" class="bi-value-input" id="marketShareInput" value="42" style="display:none;"><div class="bi-label">Market Share</div></div>
                                <div class="bi-metric" data-bi="growthRate"><i class="fas fa-edit edit-bi"></i><div class="bi-value" id="growthRate">8.4%</div><input type="text" class="bi-value-input" id="growthRateInput" value="8.4" style="display:none;"><div class="bi-label">Growth Rate</div></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ========== CAMPAIGNS TAB (Fully Enhanced) ========== -->
                <div class="tab-content" id="tab-campaigns">
                    <div class="campaigns-grid" id="campaignsGrid"></div>
                </div>

                <!-- ========== ANALYTICS TAB (Digital Analytics) ========== -->
                <div class="tab-content" id="tab-analytics">
                    <div class="bi-dashboard">
                        <div class="bi-header"><div class="bi-title">Digital Analytics Dashboard</div><div class="bi-filters"><select class="bi-filter" id="analyticsDateRange"><option value="7">Last 7 Days</option><option value="30">Last 30 Days</option><option value="90">Last Quarter</option></select></div></div>
                        <div class="metrics-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem;" id="analyticsMetrics">
                            <!-- Populated by JS -->
                        </div>
                        <div style="margin-top: 2rem;" id="trafficSources">
                            <h3>Traffic Source Breakdown</h3>
                            <div class="progress-bar"><div class="progress-fill" style="width: 35%;">Direct 35%</div></div>
                            <div class="progress-bar"><div class="progress-fill" style="width: 25%;">Organic Search 25%</div></div>
                            <div class="progress-bar"><div class="progress-fill" style="width: 20%;">Social Media 20%</div></div>
                            <div class="progress-bar"><div class="progress-fill" style="width: 15%;">Referral 15%</div></div>
                            <div class="progress-bar"><div class="progress-fill" style="width: 5%;">Email 5%</div></div>
                        </div>
                    </div>
                </div>

                <!-- ========== SOCIAL MEDIA TAB ========== -->
                <div class="tab-content" id="tab-social">
                    <div class="channels-grid" id="socialChannelsGrid"></div>
                </div>

                <!-- ========== SEO & SEM TAB ========== -->
                <div class="tab-content" id="tab-seo">
                    <div class="bi-dashboard">
                        <div class="bi-header"><div class="bi-title">SEO & SEM Performance</div></div>
                        <div class="metrics-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem;" id="seoMetrics"></div>
                    </div>
                </div>

                <!-- ========== EMAIL MARKETING TAB ========== -->
                <div class="tab-content" id="tab-email">
                    <div class="bi-dashboard">
                        <div class="bi-header"><div class="bi-title">Email Marketing Performance</div></div>
                        <div class="metrics-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem;" id="emailMetrics"></div>
                    </div>
                </div>

                <!-- ========== CONTENT MARKETING TAB ========== -->
                <div class="tab-content" id="tab-content">
                    <div class="module-grid" id="contentGrid"></div>
                </div>

                <!-- ========== CUSTOMER INSIGHTS TAB ========== -->
                <div class="tab-content" id="tab-insights">
                    <div class="bi-dashboard">
                        <div class="bi-header"><div class="bi-title">Customer Segmentation & Insights</div></div>
                        <div id="segmentsGrid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem;"></div>
                    </div>
                </div>

                <!-- ========== PREDICTIVE ANALYTICS TAB ========== -->
                <div class="tab-content" id="tab-predictive">
                    <div class="bi-dashboard">
                        <div class="bi-header"><div class="bi-title">Predictive Analytics</div></div>
                        <div class="metrics-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;" id="predictiveMetrics"></div>
                    </div>
                </div>

                <!-- ========== COMPETITIVE INTELLIGENCE TAB ========== -->
                <div class="tab-content" id="tab-competitive">
                    <div class="bi-dashboard">
                        <div class="bi-header"><div class="bi-title">Competitive Analysis</div></div>
                        <div id="competitorsGrid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;"></div>
                    </div>
                </div>

                <!-- ========== MARKETING AUTOMATION TAB ========== -->
                <div class="tab-content" id="tab-automation">
                    <div class="bi-dashboard">
                        <div class="bi-header"><div class="bi-title">Automation Workflows</div></div>
                        <div id="workflowsList"></div>
                    </div>
                </div>

                <!-- ========== REPORTS TAB (New) ========== -->
                <div class="tab-content" id="tab-reports">
                    <div class="bi-dashboard">
                        <div class="bi-header"><div class="bi-title">Reporting & Export</div></div>
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 1rem;">
                            <button class="btn btn-secondary" onclick="scheduleReport()"><i class="far fa-calendar-alt"></i> Schedule Report</button>
                            <button class="btn btn-secondary" onclick="exportData('pdf')"><i class="fas fa-file-pdf"></i> Export PDF</button>
                            <button class="btn btn-secondary" onclick="exportData('excel')"><i class="fas fa-file-excel"></i> Export Excel</button>
                            <button class="btn btn-secondary" onclick="exportData('csv')"><i class="fas fa-file-csv"></i> Export CSV</button>
                        </div>
                        <div id="scheduledReportsList"></div>
                    </div>
                </div>
            </div>
            <div class="footer">Copyright ¬© 2025 CephasGM ERP System - Marketing Module v2.0</div>
        </main>
    </div>

    <!-- Campaign Modal (Enhanced with all 28 campaign fields) -->
    <div id="campaignModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2 id="campaignModalTitle">Create New Campaign</h2><span class="modal-close" onclick="closeCampaignModal()">&times;</span></div>
            <form id="campaignForm" onsubmit="saveCampaign(event)">
                <input type="hidden" id="campaignId" name="campaignId">
                <div class="form-row">
                    <div class="form-group"><label>Campaign Name *</label><input type="text" id="campaignName" required></div>
                    <div class="form-group"><label>Campaign ID</label><input type="text" id="campaignIdDisplay" readonly></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Objective</label><select id="campaignObjective"><option value="awareness">Brand Awareness</option><option value="leadgen">Lead Generation</option><option value="sales">Sales</option><option value="retention">Customer Retention</option><option value="launch">Product Launch</option></select></div>
                    <div class="form-group"><label>Type</label><select id="campaignType"><option value="digital">Digital</option><option value="email">Email</option><option value="social">Social Media</option><option value="seo">SEO</option><option value="content">Content</option><option value="print">Print</option><option value="tv">TV</option><option value="radio">Radio</option><option value="outdoor">Outdoor</option><option value="event">Event</option><option value="integrated">Integrated</option></select></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Region/Country</label><input type="text" id="campaignRegion" placeholder="e.g., Tanzania, East Africa"></div>
                    <div class="form-group"><label>Local Market Manager</label><input type="text" id="marketManager" placeholder="Responsible person"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Local Currency</label><select id="campaignCurrency"><option value="TZS">TZS</option><option value="USD">USD</option><option value="EUR">EUR</option><option value="GBP">GBP</option><option value="KES">KES</option></select></div>
                    <div class="form-group"><label>Exchange Rate (to TZS)</label><input type="number" id="exchangeRate" step="0.0001" value="1.0"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Budget Allocated (local)</label><input type="number" id="campaignBudget" required></div>
                    <div class="form-group"><label>Status</label><select id="campaignStatus"><option value="planned">Planned</option><option value="in-progress">In Progress</option><option value="paused">Paused</option><option value="completed">Completed</option><option value="archived">Archived</option></select></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Start Date</label><input type="date" id="campaignStart" required></div>
                    <div class="form-group"><label>End Date</label><input type="date" id="campaignEnd" required></div>
                </div>
                <div class="form-group"><label>Channel Mix</label><input type="text" id="channelMix" placeholder="e.g., Facebook, Google Ads, Email"></div>
                <div class="form-row">
                    <div class="form-group"><label>Target Audience</label><textarea id="targetAudience" rows="2" placeholder="e.g., IT Decision Makers, 25-45, Urban"></textarea></div>
                    <div class="form-group"><label>Target Reach</label><input type="number" id="targetReach" placeholder="Planned audience size"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Landing Page URL</label><input type="url" id="landingPage" placeholder="https://..."></div>
                    <div class="form-group"><label>UTM Parameters</label><input type="text" id="utmParams" placeholder="utm_source=..."></div>
                </div>
                <div class="form-group"><label>Creative Assets (links)</label><input type="text" id="creativeAssets" placeholder="Links to images/videos"></div>
                <div class="form-row">
                    <div class="form-group"><label>Local Requirements</label><textarea id="localRequirements" rows="2" placeholder="Cultural notes, translations..."></textarea></div>
                    <div class="form-group"><label>Compliance</label><select id="compliance"><option value="gdpr">GDPR (EU)</option><option value="ccpa">CCPA (California)</option><option value="local">Local Regulations</option><option value="none">None</option></select></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Cultural Adaptation Notes</label><textarea id="culturalNotes" rows="2" placeholder="Localization notes..."></textarea></div>
                    <div class="form-group"><label>Local Holidays/Events</label><input type="text" id="localHolidays" placeholder="e.g., Independence Day"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Approval Status</label><select id="approvalStatus"><option value="pending">Pending</option><option value="approved">Approved</option><option value="rejected">Rejected</option></select></div>
                    <div class="form-group"><label>A/B Test Results</label><input type="text" id="abTestResults" placeholder="Link to results"></div>
                </div>
                <div class="form-group"><label>Post-Mortem Report</label><textarea id="postMortem" rows="3" placeholder="Lessons learned..."></textarea></div>
                <div class="form-group"><button type="submit" class="btn btn-success">Save Campaign</button> <button type="button" class="btn btn-secondary" onclick="closeCampaignModal()">Cancel</button></div>
            </form>
        </div>
    </div>

    <!-- Module Content Modal -->
    <div id="moduleModal" class="modal"><div class="modal-content"><div class="modal-header"><h2 id="moduleModalTitle">Module</h2><span class="modal-close" onclick="closeModuleModal()">&times;</span></div><div id="moduleModalContent"></div></div></div>

    <script>
        // ==================== GLOBAL STATE ====================
        const currencyRates = { 'TZS': { rate: 1, symbol: 'TZS ' }, 'USD': { rate: 0.00043, symbol: '$' }, 'EUR': { rate: 0.00040, symbol: '‚Ç¨' }, 'GBP': { rate: 0.00034, symbol: '¬£' }, 'KES': { rate: 0.062, symbol: 'KSh ' } };
        let currentCurrency = 'TZS';
        
        // Data stores
        let campaigns = JSON.parse(localStorage.getItem('campaigns') || '[]');
        let socialChannels = JSON.parse(localStorage.getItem('socialChannels') || '[]');
        let contentItems = JSON.parse(localStorage.getItem('contentItems') || '[]');
        let customerSegments = JSON.parse(localStorage.getItem('customerSegments') || '[]');
        let competitors = JSON.parse(localStorage.getItem('competitors') || '[]');
        let workflows = JSON.parse(localStorage.getItem('workflows') || '[]');
        let marketingStats = JSON.parse(localStorage.getItem('marketingStats') || '{"budget":8200000,"roi":24,"reach":156000,"conversion":4.2}');
        let analyticsData = JSON.parse(localStorage.getItem('analyticsData') || '{"sessions":45200,"visitors":32800,"bounceRate":42,"avgDuration":"2:45","pagesPerSession":3.2}');
        let seoData = JSON.parse(localStorage.getItem('seoData') || '{"keywords":156,"avgPosition":8,"organicTraffic":12400,"backlinks":342,"da":52}');
        let emailData = JSON.parse(localStorage.getItem('emailData') || '{"listSize":24800,"openRate":68,"clickRate":12.4,"unsubscribeRate":0.8}');
        let predictiveData = JSON.parse(localStorage.getItem('predictiveData') || '{"leadScore":85,"churnRisk":12,"ltv":45000}');
        let reportsList = JSON.parse(localStorage.getItem('reportsList') || '[]');

        // ==================== INITIALIZATION ====================
        function initializeData() {
            if (campaigns.length === 0) {
                campaigns = [
                    { id: 'CAMP-001', name: 'Summer Sale 2025', objective: 'sales', type: 'digital', region: 'Tanzania', marketManager: 'John Doe', currency: 'TZS', exchangeRate: 1.0, budget: 2500000, status: 'in-progress', start: '2025-06-01', end: '2025-08-31', channelMix: 'Facebook, Instagram', targetAudience: 'Young adults', targetReach: 50000, landingPage: 'https://cephasgm.com/summer', utmParams: 'utm_source=summer', creativeAssets: '/assets/summer', localRequirements: 'Swahili', compliance: 'local', culturalNotes: 'Use local influencers', localHolidays: 'Saba Saba', approvalStatus: 'approved', abTestResults: '', postMortem: '', actualReach: 32450, actualSpend: 1850000, roi: 0.32, roas: 2.1 },
                    { id: 'CAMP-002', name: 'Product Launch X1', objective: 'launch', type: 'integrated', region: 'East Africa', marketManager: 'Jane Smith', currency: 'TZS', exchangeRate: 1.0, budget: 5000000, status: 'completed', start: '2025-03-15', end: '2025-05-30', channelMix: 'TV, Radio, Social', targetAudience: 'Tech enthusiasts', targetReach: 100000, landingPage: 'https://cephasgm.com/x1', utmParams: 'utm_source=launch', creativeAssets: '/assets/x1', localRequirements: 'Multi-country', compliance: 'gdpr', culturalNotes: 'Avoid sensitive topics', localHolidays: 'Easter', approvalStatus: 'approved', abTestResults: 'Variant A won', postMortem: 'Good engagement', actualReach: 87500, actualSpend: 4200000, roi: 0.45, roas: 3.2 }
                ];
                localStorage.setItem('campaigns', JSON.stringify(campaigns));
            }
            if (socialChannels.length === 0) {
                socialChannels = [
                    { name: 'Facebook', icon: 'üìò', reach: 24000, engagement: 3.2, followers: 15200, link: 'https://facebook.com/cephasgm', growth: 2.1, demographics: '25-34', optimalTime: '3PM' },
                    { name: 'Instagram', icon: 'üì∑', reach: 18000, engagement: 4.8, followers: 12300, link: 'https://instagram.com/cephasgm', growth: 3.4, demographics: '18-29', optimalTime: '7PM' },
                    { name: 'LinkedIn', icon: 'üíº', reach: 8400, engagement: 2.1, followers: 5600, link: 'https://linkedin.com/company/cephasgm', growth: 1.2, demographics: '35-54', optimalTime: '12PM' }
                ];
                localStorage.setItem('socialChannels', JSON.stringify(socialChannels));
            }
            if (contentItems.length === 0) {
                contentItems = [
                    { title: 'Digital Transformation Guide', type: 'E-book', owner: 'Content Team', publishDate: '2025-01-15', status: 'Published', views: 3450, conversions: 89, keyword: 'digital transformation', url: '/guides/digital', stage: 'Consideration' },
                    { title: 'Why ERP Matters', type: 'Blog Post', owner: 'John', publishDate: '2025-02-10', status: 'Published', views: 2100, conversions: 34, keyword: 'erp benefits', url: '/blog/why-erp', stage: 'Awareness' }
                ];
                localStorage.setItem('contentItems', JSON.stringify(contentItems));
            }
            if (customerSegments.length === 0) {
                customerSegments = [
                    { name: 'Enterprise Clients', size: 45, value: 'TZS 2.5M', behavior: 'High engagement', nps: 72, persona: 'IT Director', goals: 'Efficiency', channels: 'LinkedIn, Email' },
                    { name: 'SMB Owners', size: 230, value: 'TZS 450K', behavior: 'Price sensitive', nps: 68, persona: 'Business Owner', goals: 'Growth', channels: 'Facebook, Google' }
                ];
                localStorage.setItem('customerSegments', JSON.stringify(customerSegments));
            }
            if (competitors.length === 0) {
                competitors = [
                    { name: 'Competitor A', website: 'compA.com', marketShare: 28, pricing: 'Premium', socialFollowers: 45000, keyProducts: 'ERP Pro', swot: 'Strong brand, weak support' },
                    { name: 'Competitor B', website: 'compB.com', marketShare: 15, pricing: 'Mid-range', socialFollowers: 23000, keyProducts: 'Business Suite', swot: 'Good value, limited features' }
                ];
                localStorage.setItem('competitors', JSON.stringify(competitors));
            }
            if (workflows.length === 0) {
                workflows = [
                    { name: 'Welcome Series', trigger: 'Form Fill', actions: 'Send 5 emails', completion: 78, conversion: 12, rules: 'If opens, send offer' },
                    { name: 'Abandoned Cart', trigger: 'Cart Abandonment', actions: 'Send 3 reminders', completion: 65, conversion: 8, rules: 'If clicked, stop' }
                ];
                localStorage.setItem('workflows', JSON.stringify(workflows));
            }
        }

        // ==================== RENDERING FUNCTIONS ====================
        function renderCampaigns() {
            const grid = document.getElementById('campaignsGrid');
            if (!grid) return;
            grid.innerHTML = campaigns.map(c => `
                <div class="campaign-card" data-id="${c.id}">
                    <div class="edit-controls">
                        <button class="btn btn-sm btn-secondary" onclick="editCampaign('${c.id}')"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-sm btn-danger" onclick="deleteCampaign('${c.id}')"><i class="fas fa-trash"></i></button>
                    </div>
                    <div class="card-header"><div class="card-icon">üì¢</div><div class="card-title">${c.name}</div></div>
                    <div style="margin-bottom:0.5rem;"><span class="badge badge-primary">${c.status}</span><span class="badge badge-secondary">${c.region}</span><span class="badge badge-warning">${c.marketManager || 'Unassigned'}</span></div>
                    <div class="metric-grid">
                        <div class="metric-item"><div class="metric-value">${c.currency} ${formatNumber(c.budget)}</div><div class="metric-label">Budget</div></div>
                        <div class="metric-item"><div class="metric-value">${c.actualReach || 0}K</div><div class="metric-label">Reach</div></div>
                        <div class="metric-item"><div class="metric-value">${c.roi ? (c.roi*100).toFixed(0)+'%' : '0%'}</div><div class="metric-label">ROI</div></div>
                        <div class="metric-item"><div class="metric-value">${c.roas || 0}:1</div><div class="metric-label">ROAS</div></div>
                    </div>
                    <div style="font-size:0.8rem; margin-top:0.5rem;"><i class="fas fa-calendar"></i> ${c.start} to ${c.end} | <i class="fas fa-users"></i> ${c.targetAudience || 'N/A'}</div>
                </div>
            `).join('');
        }

        function renderSocialChannels() {
            const grid = document.getElementById('socialChannelsGrid');
            if (!grid) return;
            grid.innerHTML = socialChannels.map((c, i) => `
                <div class="channel-card">
                    <div class="edit-controls"><button class="btn btn-sm btn-secondary" onclick="editSocialChannel(${i})"><i class="fas fa-edit"></i></button><button class="btn btn-sm btn-danger" onclick="deleteSocialChannel(${i})"><i class="fas fa-trash"></i></button></div>
                    <div class="channel-icon">${c.icon}</div><div class="channel-name">${c.name}</div>
                    <a href="${c.link}" target="_blank" class="channel-link">Visit</a>
                    <div class="channel-stats">
                        <div class="channel-stat"><div class="channel-value">${c.followers}K</div><div class="channel-label">Followers</div></div>
                        <div class="channel-stat"><div class="channel-value">${c.engagement}%</div><div class="channel-label">Engage</div></div>
                        <div class="channel-stat"><div class="channel-value">${c.growth || 0}%</div><div class="channel-label">Growth</div></div>
                    </div>
                    <div style="font-size:0.7rem; margin-top:0.5rem;">Best: ${c.optimalTime || 'N/A'} | Demo: ${c.demographics || 'All'}</div>
                </div>
            `).join('');
        }

        function renderContentItems() {
            const grid = document.getElementById('contentGrid');
            if (!grid) return;
            grid.innerHTML = contentItems.map((c, i) => `
                <div class="module-card">
                    <div class="edit-controls"><button class="btn btn-sm btn-secondary" onclick="editContent(${i})"><i class="fas fa-edit"></i></button><button class="btn btn-sm btn-danger" onclick="deleteContent(${i})"><i class="fas fa-trash"></i></button></div>
                    <div class="module-icon">üìù</div><h3>${c.title}</h3><p>${c.type} - ${c.status}</p>
                    <div class="metric-grid"><div class="metric-item"><div class="metric-value">${c.views}K</div><div class="metric-label">Views</div></div><div class="metric-item"><div class="metric-value">${c.conversions}</div><div class="metric-label">Conversions</div></div></div>
                    <p style="font-size:0.8rem;">Keyword: ${c.keyword || 'N/A'} | Stage: ${c.stage || 'N/A'}</p>
                </div>
            `).join('');
        }

        function renderCustomerSegments() {
            const grid = document.getElementById('segmentsGrid');
            if (!grid) return;
            grid.innerHTML = customerSegments.map(s => `
                <div class="insight-card"><h4>${s.name}</h4><p>Size: ${s.size} | Value: ${s.value}</p><p>NPS: ${s.nps} | Behavior: ${s.behavior}</p><p>Persona: ${s.persona || 'N/A'} | Channels: ${s.channels || 'N/A'}</p></div>
            `).join('');
        }

        function renderCompetitors() {
            const grid = document.getElementById('competitorsGrid');
            if (!grid) return;
            grid.innerHTML = competitors.map(c => `
                <div class="insight-card"><h4>${c.name}</h4><p>Market Share: ${c.marketShare}% | Pricing: ${c.pricing}</p><p>Social: ${c.socialFollowers}K | Key Product: ${c.keyProducts}</p><p>SWOT: ${c.swot || 'N/A'}</p></div>
            `).join('');
        }

        function renderWorkflows() {
            const list = document.getElementById('workflowsList');
            if (!list) return;
            list.innerHTML = workflows.map(w => `
                <div class="workflow-item"><div style="flex:1;"><strong>${w.name}</strong><div>Trigger: ${w.trigger}</div><div>Rules: ${w.rules || 'None'}</div></div><div>${w.completion}% Complete | ${w.conversion}% Convert</div></div>
            `).join('');
        }

        function renderAnalytics() {
            const container = document.getElementById('analyticsMetrics');
            if (container) container.innerHTML = `
                <div class="metric-item"><div class="metric-value" onclick="editMetric(this,'sessions')">${analyticsData.sessions}K</div><div class="metric-label">Sessions</div></div>
                <div class="metric-item"><div class="metric-value" onclick="editMetric(this,'visitors')">${analyticsData.visitors}K</div><div class="metric-label">Unique Visitors</div></div>
                <div class="metric-item"><div class="metric-value" onclick="editMetric(this,'bounceRate')">${analyticsData.bounceRate}%</div><div class="metric-label">Bounce Rate</div></div>
                <div class="metric-item"><div class="metric-value" onclick="editMetric(this,'avgDuration')">${analyticsData.avgDuration}</div><div class="metric-label">Avg Duration</div></div>
                <div class="metric-item"><div class="metric-value" onclick="editMetric(this,'pagesPerSession')">${analyticsData.pagesPerSession}</div><div class="metric-label">Pages/Session</div></div>
            `;
        }

        function renderSEO() {
            const container = document.getElementById('seoMetrics');
            if (container) container.innerHTML = `
                <div class="metric-item"><div class="metric-value">${seoData.keywords}</div><div class="metric-label">Keywords Tracked</div></div>
                <div class="metric-item"><div class="metric-value">#${seoData.avgPosition}</div><div class="metric-label">Avg Position</div></div>
                <div class="metric-item"><div class="metric-value">${seoData.organicTraffic}K</div><div class="metric-label">Organic Traffic</div></div>
                <div class="metric-item"><div class="metric-value">${seoData.backlinks}</div><div class="metric-label">Backlinks</div></div>
                <div class="metric-item"><div class="metric-value">${seoData.da}</div><div class="metric-label">Domain Authority</div></div>
            `;
        }

        function renderEmail() {
            const container = document.getElementById('emailMetrics');
            if (container) container.innerHTML = `
                <div class="metric-item"><div class="metric-value">${emailData.listSize}K</div><div class="metric-label">List Size</div></div>
                <div class="metric-item"><div class="metric-value">${emailData.openRate}%</div><div class="metric-label">Open Rate</div></div>
                <div class="metric-item"><div class="metric-value">${emailData.clickRate}%</div><div class="metric-label">Click Rate</div></div>
                <div class="metric-item"><div class="metric-value">${emailData.unsubscribeRate}%</div><div class="metric-label">Unsubscribe</div></div>
            `;
        }

        function renderPredictive() {
            const container = document.getElementById('predictiveMetrics');
            if (container) container.innerHTML = `
                <div class="metric-item"><div class="metric-value">${predictiveData.leadScore}</div><div class="metric-label">Avg Lead Score</div></div>
                <div class="metric-item"><div class="metric-value">${predictiveData.churnRisk}%</div><div class="metric-label">Churn Risk</div></div>
                <div class="metric-item"><div class="metric-value">TZS ${formatNumber(predictiveData.ltv)}</div><div class="metric-label">Customer LTV</div></div>
            `;
        }

        function renderReports() {
            const list = document.getElementById('scheduledReportsList');
            if (list) list.innerHTML = reportsList.length ? reportsList.map(r => `<div class="insight-card">${r.name} - ${r.schedule}</div>`).join('') : '<p>No scheduled reports. Click "Schedule Report" to create one.</p>';
        }

        // ==================== UTILITIES ====================
        function formatNumber(num) { if (num >= 1e6) return (num/1e6).toFixed(1)+'M'; if (num >= 1e3) return (num/1e3).toFixed(0)+'K'; return num.toString(); }

        function updateCurrencyForElement(id, value, rateInfo) {
            const el = document.getElementById(id);
            if (el) {
                let converted = value * rateInfo.rate;
                if (value >= 1e6) converted = (converted/1e6).toFixed(1)+'M';
                else if (value >= 1e3) converted = (converted/1e3).toFixed(0)+'K';
                else converted = converted.toFixed(0);
                el.textContent = `${rateInfo.symbol}${converted}`;
            }
        }

        // ==================== EVENT LISTENERS ====================
        function setupEventListeners() {
            document.querySelectorAll('.tab').forEach(tab => tab.addEventListener('click', function() {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                this.classList.add('active');
                document.getElementById(`tab-${this.dataset.tab}`).classList.add('active');
                switch(this.dataset.tab) {
                    case 'campaigns': renderCampaigns(); break;
                    case 'social': renderSocialChannels(); break;
                    case 'content': renderContentItems(); break;
                    case 'insights': renderCustomerSegments(); break;
                    case 'competitive': renderCompetitors(); break;
                    case 'automation': renderWorkflows(); break;
                    case 'analytics': renderAnalytics(); break;
                    case 'seo': renderSEO(); break;
                    case 'email': renderEmail(); break;
                    case 'predictive': renderPredictive(); break;
                    case 'reports': renderReports(); break;
                }
            }));

            document.getElementById('currencySelect').addEventListener('change', function() {
                currentCurrency = this.value;
                const rate = currencyRates[currentCurrency];
                updateCurrencyForElement('marketingBudget', marketingStats.budget, rate);
                updateCurrencyForElement('revenueGenerated', 4800000, rate);
                updateCurrencyForElement('chartValue1', 4800000, rate);
                updateCurrencyForElement('chartValue2', 3200000, rate);
                updateCurrencyForElement('chartValue3', 1800000, rate);
            });

            document.getElementById('languageSelect').addEventListener('change', function() {
                const lang = this.value;
                document.getElementById('pageTitle').textContent = lang === 'en' ? 'Marketing & Business Intelligence' : 'Masoko na Akili ya Biashara';
                document.querySelector('.btn-marketing').innerHTML = `<i class="fas fa-plus"></i> ${lang === 'en' ? 'New Campaign' : 'Kampeni Mpya'}`;
            });

            document.getElementById('darkModeToggle').addEventListener('click', function() {
                document.body.classList.toggle('dark-mode');
                this.querySelector('i').classList.toggle('fa-moon');
                this.querySelector('i').classList.toggle('fa-sun');
            });

            document.getElementById('mobileNavToggle').addEventListener('click', () => document.getElementById('sidebar').classList.toggle('active'));

            document.getElementById('newCampaignBtn').addEventListener('click', () => {
                document.getElementById('campaignModalTitle').textContent = 'Create New Campaign';
                document.getElementById('campaignId').value = 'CAMP-' + Date.now();
                document.getElementById('campaignIdDisplay').value = 'CAMP-' + Date.now();
                document.getElementById('campaignForm').reset();
                document.getElementById('campaignModal').style.display = 'block';
            });

            document.querySelectorAll('.edit-stat').forEach(btn => btn.addEventListener('click', function() {
                const card = this.closest('.stat-card');
                card.querySelector('.stat-number').style.display = 'none';
                card.querySelector('.stat-number-input').style.display = 'block';
                this.style.display = 'none';
                card.querySelector('.save-stat').style.display = 'inline-block';
            }));

            document.querySelectorAll('.save-stat').forEach(btn => btn.addEventListener('click', function() {
                const card = this.closest('.stat-card');
                const num = card.querySelector('.stat-number');
                const inp = card.querySelector('.stat-number-input');
                const edit = card.querySelector('.edit-stat');
                let val = parseFloat(inp.value);
                const stat = card.dataset.stat;
                marketingStats[stat] = val;
                localStorage.setItem('marketingStats', JSON.stringify(marketingStats));
                num.textContent = stat.includes('roi') || stat.includes('conversion') ? val + '%' : formatNumber(val);
                num.style.display = 'block';
                inp.style.display = 'none';
                edit.style.display = 'inline-block';
                this.style.display = 'none';
            }));

            document.getElementById('logoutBtn').addEventListener('click', () => { if(confirm('Logout?')) window.location.href = 'login.html'; });

            window.onclick = e => { if(e.target.classList.contains('modal')) e.target.style.display = 'none'; };
        }

        // ==================== CRUD OPERATIONS ====================
        window.saveCampaign = function(e) {
            e.preventDefault();
            const campaign = {
                id: document.getElementById('campaignId').value,
                name: document.getElementById('campaignName').value,
                objective: document.getElementById('campaignObjective').value,
                type: document.getElementById('campaignType').value,
                region: document.getElementById('campaignRegion').value,
                marketManager: document.getElementById('marketManager').value,
                currency: document.getElementById('campaignCurrency').value,
                exchangeRate: parseFloat(document.getElementById('exchangeRate').value),
                budget: parseFloat(document.getElementById('campaignBudget').value),
                status: document.getElementById('campaignStatus').value,
                start: document.getElementById('campaignStart').value,
                end: document.getElementById('campaignEnd').value,
                channelMix: document.getElementById('channelMix').value,
                targetAudience: document.getElementById('targetAudience').value,
                targetReach: document.getElementById('targetReach').value,
                landingPage: document.getElementById('landingPage').value,
                utmParams: document.getElementById('utmParams').value,
                creativeAssets: document.getElementById('creativeAssets').value,
                localRequirements: document.getElementById('localRequirements').value,
                compliance: document.getElementById('compliance').value,
                culturalNotes: document.getElementById('culturalNotes').value,
                localHolidays: document.getElementById('localHolidays').value,
                approvalStatus: document.getElementById('approvalStatus').value,
                abTestResults: document.getElementById('abTestResults').value,
                postMortem: document.getElementById('postMortem').value,
                actualReach: 0, actualSpend: 0, roi: 0, roas: 0
            };
            const existingIndex = campaigns.findIndex(c => c.id === campaign.id);
            if (existingIndex >= 0) campaigns[existingIndex] = campaign;
            else campaigns.push(campaign);
            localStorage.setItem('campaigns', JSON.stringify(campaigns));
            alert('Campaign saved!');
            closeCampaignModal();
            renderCampaigns();
        };

        window.editCampaign = function(id) {
            const c = campaigns.find(c => c.id === id);
            if (!c) return;
            document.getElementById('campaignModalTitle').textContent = 'Edit Campaign';
            document.getElementById('campaignId').value = c.id;
            document.getElementById('campaignIdDisplay').value = c.id;
            document.getElementById('campaignName').value = c.name || '';
            document.getElementById('campaignObjective').value = c.objective || 'awareness';
            document.getElementById('campaignType').value = c.type || 'digital';
            document.getElementById('campaignRegion').value = c.region || '';
            document.getElementById('marketManager').value = c.marketManager || '';
            document.getElementById('campaignCurrency').value = c.currency || 'TZS';
            document.getElementById('exchangeRate').value = c.exchangeRate || 1.0;
            document.getElementById('campaignBudget').value = c.budget || 0;
            document.getElementById('campaignStatus').value = c.status || 'planned';
            document.getElementById('campaignStart').value = c.start || '';
            document.getElementById('campaignEnd').value = c.end || '';
            document.getElementById('channelMix').value = c.channelMix || '';
            document.getElementById('targetAudience').value = c.targetAudience || '';
            document.getElementById('targetReach').value = c.targetReach || '';
            document.getElementById('landingPage').value = c.landingPage || '';
            document.getElementById('utmParams').value = c.utmParams || '';
            document.getElementById('creativeAssets').value = c.creativeAssets || '';
            document.getElementById('localRequirements').value = c.localRequirements || '';
            document.getElementById('compliance').value = c.compliance || 'none';
            document.getElementById('culturalNotes').value = c.culturalNotes || '';
            document.getElementById('localHolidays').value = c.localHolidays || '';
            document.getElementById('approvalStatus').value = c.approvalStatus || 'pending';
            document.getElementById('abTestResults').value = c.abTestResults || '';
            document.getElementById('postMortem').value = c.postMortem || '';
            document.getElementById('campaignModal').style.display = 'block';
        };

        window.deleteCampaign = function(id) {
            if (confirm('Delete campaign?')) {
                campaigns = campaigns.filter(c => c.id !== id);
                localStorage.setItem('campaigns', JSON.stringify(campaigns));
                renderCampaigns();
            }
        };

        window.editSocialChannel = i => { /* implement inline editing or modal */ alert('Edit social channel'); };
        window.deleteSocialChannel = i => { if(confirm('Delete?')) { socialChannels.splice(i,1); localStorage.setItem('socialChannels',JSON.stringify(socialChannels)); renderSocialChannels(); } };
        window.editContent = i => alert('Edit content');
        window.deleteContent = i => { if(confirm('Delete?')) { contentItems.splice(i,1); localStorage.setItem('contentItems',JSON.stringify(contentItems)); renderContentItems(); } };
        window.editMetric = (el, key) => { /* inline metric editing */ let newVal = prompt('Enter new value:', el.textContent); if(newVal) { el.textContent = newVal; analyticsData[key] = newVal; localStorage.setItem('analyticsData',JSON.stringify(analyticsData)); } };

        window.openModule = (name) => {
            const modal = document.getElementById('moduleModal');
            document.getElementById('moduleModalTitle').textContent = name.replace('-',' ').toUpperCase();
            document.getElementById('moduleModalContent').innerHTML = `<p>Integrated module content for ${name}. Full CRUD operations available.</p><button class="btn btn-primary" onclick="alert('Action for ${name}')">Perform Action</button>`;
            modal.style.display = 'block';
        };

        window.closeCampaignModal = () => document.getElementById('campaignModal').style.display = 'none';
        window.closeModuleModal = () => document.getElementById('moduleModal').style.display = 'none';

        // Report functions
        window.scheduleReport = () => { let name = prompt('Report name:'); if(name) { reportsList.push({name, schedule:'daily'}); localStorage.setItem('reportsList',JSON.stringify(reportsList)); renderReports(); } };
        window.exportData = (format) => alert(`Exporting as ${format}...`);

        // ==================== INIT ====================
        document.addEventListener('DOMContentLoaded', function() {
            initializeData();
            setupEventListeners();
            renderCampaigns();
            renderSocialChannels();
            renderContentItems();
            renderCustomerSegments();
            renderCompetitors();
            renderWorkflows();
            renderAnalytics();
            renderSEO();
            renderEmail();
            renderPredictive();
            renderReports();
            // Load stats
            document.getElementById('marketingBudget').textContent = formatNumber(marketingStats.budget);
            document.getElementById('roiQuarter').textContent = marketingStats.roi + '%';
            document.getElementById('totalReach').textContent = formatNumber(marketingStats.reach);
            document.getElementById('conversionRate').textContent = marketingStats.conversion + '%';
        });

        // Service Worker
        if ('serviceWorker' in navigator) window.addEventListener('load', () => navigator.serviceWorker.register('/sw.js').catch(console.log));
    </script>
</body>
</html>
