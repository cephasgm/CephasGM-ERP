<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#003366">
  <title>CephasGM ‚Äì ERP | Finance Management</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icons/icon-192.png">
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      margin: 0;
      background: linear-gradient(120deg, #e8f5e8, #f0f4ff);
      color: #333;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    header {
      background: #003366;
      color: white;
      padding: 15px 20px;
      text-align: left;
      font-size: 22px;
      font-weight: bold;
      position: sticky;
      top: 0;
      z-index: 100;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .nav-back {
      color: white;
      text-decoration: none;
      font-size: 14px;
      font-weight: normal;
      background: rgba(255,255,255,0.2);
      padding: 5px 10px;
      border-radius: 4px;
      transition: background 0.3s;
    }
    .nav-back:hover {
      background: rgba(255,255,255,0.3);
    }
    header span { font-size: 16px; font-weight: normal; opacity: 0.8; }
    footer {
      background: #003366;
      color: white;
      text-align: center;
      padding: 10px 0;
      font-size: 14px;
      margin-top: auto;
    }
    .container { padding: 20px; flex: 1; overflow-x: auto; }
    h2 { text-align: left; color: #003366; margin-bottom: 10px; }
    
    .finance-overview {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .finance-card {
      background: white;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      text-align: center;
      border-left: 5px solid;
    }
    
    .card-income { border-left-color: #27ae60; }
    .card-expense { border-left-color: #c0392b; }
    .card-balance { border-left-color: #2980b9; }
    .card-budget { border-left-color: #f39c12; }
    
    .finance-card h3 {
      color: #003366;
      margin-bottom: 10px;
      font-size: 0.9em;
    }
    
    .finance-card .amount {
      font-size: 1.8em;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .amount.positive { color: #27ae60; }
    .amount.negative { color: #c0392b; }
    .amount.neutral { color: #2980b9; }
    
    .finance-card .trend {
      font-size: 0.9em;
      color: #666;
    }
    
    .toolbar {
      margin-bottom: 20px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }
    
    .btn-primary { background: #003366; color: white; }
    .btn-success { background: #27ae60; color: white; }
    .btn-warning { background: #f39c12; color: white; }
    .btn-danger { background: #c0392b; color: white; }
    .btn-info { background: #2980b9; color: white; }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    
    .charts-container {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .chart-card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .chart-placeholder {
      background: #f8f9fa;
      height: 300px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #666;
      border-radius: 5px;
    }
    
    table {
      border-collapse: collapse;
      width: 100%;
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    
    th, td {
      border: 1px solid #ccc;
      padding: 12px;
      text-align: left;
      font-size: 14px;
    }
    
    th {
      background: #003366;
      color: white;
      position: sticky;
      top: 0;
      z-index: 5;
    }
    
    tr:nth-child(even) { background: #f9f9f9; }
    
    .transaction-income { background: #d4edda; }
    .transaction-expense { background: #f8d7da; }
    
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      z-index: 200;
    }
    
    .modal-content {
      background: white;
      border-radius: 8px;
      padding: 20px;
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .modal-header h3 {
      margin: 0;
      color: #003366;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: #003366;
    }
    
    .form-group input, .form-group select, .form-group textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
    }
    
    .tabs {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 2px solid #003366;
    }
    
    .tab {
      padding: 10px 20px;
      cursor: pointer;
      background: #f8f9fa;
      border: none;
      border-bottom: 3px solid transparent;
      font-weight: 600;
    }
    
    .tab.active {
      background: white;
      border-bottom: 3px solid #003366;
      color: #003366;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
  </style>
</head>
<body>
<header>
  <a href="index.html" class="nav-back">‚Üê Back to Dashboard</a>
  <div>CephasGM ‚Äì ERP <span>Finance Management</span></div>
</header>

<div class="container">
  <div class="finance-overview">
    <div class="finance-card card-income">
      <h3>TOTAL INCOME</h3>
      <div class="amount positive" id="totalIncome">$0.00</div>
      <div class="trend">‚Üë 12% from last month</div>
    </div>
    <div class="finance-card card-expense">
      <h3>TOTAL EXPENSES</h3>
      <div class="amount negative" id="totalExpense">$0.00</div>
      <div class="trend">‚Üë 8% from last month</div>
    </div>
    <div class="finance-card card-balance">
      <h3>CURRENT BALANCE</h3>
      <div class="amount neutral" id="currentBalance">$0.00</div>
      <div class="trend">Net position</div>
    </div>
    <div class="finance-card card-budget">
      <h3>BUDGET UTILIZATION</h3>
      <div class="amount neutral" id="budgetUsage">0%</div>
      <div class="trend">$0.00 remaining</div>
    </div>
  </div>

  <div class="toolbar">
    <button class="btn btn-success" onclick="openModal('addIncome')">üí∞ Add Income</button>
    <button class="btn btn-danger" onclick="openModal('addExpense')">üí∏ Add Expense</button>
    <button class="btn btn-primary" onclick="openModal('addInvoice')">üßæ Create Invoice</button>
    <button class="btn btn-warning" onclick="generateFinancialReport()">üìä Financial Report</button>
    <button class="btn btn-info" onclick="exportFinancialData()">üì§ Export Data</button>
  </div>

  <div class="tabs">
    <button class="tab active" onclick="switchTab('transactions')">Transactions</button>
    <button class="tab" onclick="switchTab('invoices')">Invoices</button>
    <button class="tab" onclick="switchTab('budgets')">Budgets</button>
    <button class="tab" onclick="switchTab('reports')">Reports</button>
  </div>

  <div id="transactions" class="tab-content active">
    <h2>Recent Transactions</h2>
    <table id="transactionsTable">
      <thead>
        <tr>
          <th>Date</th>
          <th>Description</th>
          <th>Category</th>
          <th>Type</th>
          <th>Amount</th>
          <th>Balance</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="invoices" class="tab-content">
    <h2>Invoice Management</h2>
    <table id="invoicesTable">
      <thead>
        <tr>
          <th>Invoice #</th>
          <th>Client</th>
          <th>Date</th>
          <th>Due Date</th>
          <th>Amount</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="budgets" class="tab-content">
    <h2>Budget Management</h2>
    <div class="charts-container">
      <div class="chart-card">
        <h3>Budget vs Actual</h3>
        <div class="chart-placeholder">
          Budget vs Actual Chart<br>
          (Would show in production)
        </div>
      </div>
      <div class="chart-card">
        <h3>Budget Summary</h3>
        <div id="budgetSummary">
          <!-- Budget summary will be populated here -->
        </div>
      </div>
    </div>
  </div>

  <div id="reports" class="tab-content">
    <h2>Financial Reports</h2>
    <div class="charts-container">
      <div class="chart-card">
        <h3>Income vs Expenses</h3>
        <div class="chart-placeholder">
          Income vs Expenses Chart<br>
          (Would show in production)
        </div>
      </div>
      <div class="chart-card">
        <h3>Cash Flow</h3>
        <div class="chart-placeholder">
          Cash Flow Chart<br>
          (Would show in production)
        </div>
      </div>
    </div>
  </div>
</div>

<footer>Copyright ¬© 2025 üòÄ</footer>

<!-- Add Income Modal -->
<div id="addIncomeModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Add Income</h3>
      <button onclick="closeModal('addIncome')">‚úñ</button>
    </div>
    <form id="incomeForm" onsubmit="saveIncome(event)">
      <div class="form-group">
        <label for="incomeAmount">Amount</label>
        <input type="number" step="0.01" id="incomeAmount" required>
      </div>
      <div class="form-group">
        <label for="incomeCategory">Category</label>
        <select id="incomeCategory" required>
          <option value="sales">Sales Revenue</option>
          <option value="service">Service Income</option>
          <option value="investment">Investment Income</option>
          <option value="other">Other Income</option>
        </select>
      </div>
      <div class="form-group">
        <label for="incomeDescription">Description</label>
        <input type="text" id="incomeDescription" required>
      </div>
      <div class="form-group">
        <label for="incomeDate">Date</label>
        <input type="date" id="incomeDate" required>
      </div>
      <div style="text-align:center; margin-top:15px;">
        <button class="btn btn-success" type="submit">Add Income</button>
        <button class="btn" type="button" onclick="closeModal('addIncome')">Cancel</button>
      </div>
    </form>
  </div>
</div>

<!-- Add Expense Modal -->
<div id="addExpenseModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Add Expense</h3>
      <button onclick="closeModal('addExpense')">‚úñ</button>
    </div>
    <form id="expenseForm" onsubmit="saveExpense(event)">
      <div class="form-group">
        <label for="expenseAmount">Amount</label>
        <input type="number" step="0.01" id="expenseAmount" required>
      </div>
      <div class="form-group">
        <label for="expenseCategory">Category</label>
        <select id="expenseCategory" required>
          <option value="salary">Salaries</option>
          <option value="rent">Rent</option>
          <option value="utilities">Utilities</option>
          <option value="supplies">Office Supplies</option>
          <option value="marketing">Marketing</option>
          <option value="travel">Travel</option>
          <option value="other">Other</option>
        </select>
      </div>
      <div class="form-group">
        <label for="expenseDescription">Description</label>
        <input type="text" id="expenseDescription" required>
      </div>
      <div class="form-group">
        <label for="expenseDate">Date</label>
        <input type="date" id="expenseDate" required>
      </div>
      <div style="text-align:center; margin-top:15px;">
        <button class="btn btn-danger" type="submit">Add Expense</button>
        <button class="btn" type="button" onclick="closeModal('addExpense')">Cancel</button>
      </div>
    </form>
  </div>
</div>

<script>
let transactions = JSON.parse(localStorage.getItem('financeTransactions') || '[]');
let invoices = JSON.parse(localStorage.getItem('financeInvoices') || '[]');
let budgets = JSON.parse(localStorage.getItem('financeBudgets') || '[]');

function openModal(type) {
  document.getElementById(type + 'Modal').style.display = 'flex';
  if (type === 'addIncome' || type === 'addExpense') {
    document.getElementById(type + 'Date').valueAsDate = new Date();
  }
}

function closeModal(type) {
  document.getElementById(type + 'Modal').style.display = 'none';
}

function saveIncome(e) {
  e.preventDefault();
  const transaction = {
    id: Date.now(),
    type: 'income',
    amount: parseFloat(document.getElementById('incomeAmount').value),
    category: document.getElementById('incomeCategory').value,
    description: document.getElementById('incomeDescription').value,
    date: document.getElementById('incomeDate').value,
    timestamp: new Date().toISOString()
  };
  
  transactions.push(transaction);
  localStorage.setItem('financeTransactions', JSON.stringify(transactions));
  updateFinanceData();
  closeModal('addIncome');
  e.target.reset();
}

function saveExpense(e) {
  e.preventDefault();
  const transaction = {
    id: Date.now(),
    type: 'expense',
    amount: parseFloat(document.getElementById('expenseAmount').value),
    category: document.getElementById('expenseCategory').value,
    description: document.getElementById('expenseDescription').value,
    date: document.getElementById('expenseDate').value,
    timestamp: new Date().toISOString()
  };
  
  transactions.push(transaction);
  localStorage.setItem('financeTransactions', JSON.stringify(transactions));
  updateFinanceData();
  closeModal('addExpense');
  e.target.reset();
}

function updateFinanceData() {
  updateOverview();
  renderTransactions();
  renderInvoices();
  updateBudgets();
}

function updateOverview() {
  const totalIncome = transactions
    .filter(t => t.type === 'income')
    .reduce((sum, t) => sum + t.amount, 0);
  
  const totalExpense = transactions
    .filter(t => t.type === 'expense')
    .reduce((sum, t) => sum + t.amount, 0);
  
  const balance = totalIncome - totalExpense;
  
  document.getElementById('totalIncome').textContent = `$${totalIncome.toFixed(2)}`;
  document.getElementById('totalExpense').textContent = `$${totalExpense.toFixed(2)}`;
  document.getElementById('currentBalance').textContent = `$${balance.toFixed(2)}`;
  
  // Simple budget calculation (in real app, this would be more complex)
  const budgetUsage = totalExpense > 0 ? Math.min((totalExpense / (totalIncome || 1)) * 100, 100) : 0;
  document.getElementById('budgetUsage').textContent = `${budgetUsage.toFixed(1)}%`;
}

function renderTransactions() {
  const tbody = document.querySelector('#transactionsTable tbody');
  tbody.innerHTML = '';
  
  let runningBalance = 0;
  
  transactions
    .sort((a, b) => new Date(b.date) - new Date(a.date))
    .slice(0, 20)
    .forEach(transaction => {
      runningBalance += transaction.type === 'income' ? transaction.amount : -transaction.amount;
      
      const tr = document.createElement('tr');
      tr.className = `transaction-${transaction.type}`;
      tr.innerHTML = `
        <td>${new Date(transaction.date).toLocaleDateString()}</td>
        <td>${transaction.description}</td>
        <td>${transaction.category}</td>
        <td><span class="status-${transaction.type}">${transaction.type.toUpperCase()}</span></td>
        <td>$${transaction.amount.toFixed(2)}</td>
        <td>$${runningBalance.toFixed(2)}</td>
        <td>
          <button class="btn btn-warning" onclick="editTransaction(${transaction.id})">‚úèÔ∏è</button>
          <button class="btn btn-danger" onclick="deleteTransaction(${transaction.id})">üóëÔ∏è</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
}

function renderInvoices() {
  const tbody = document.querySelector('#invoicesTable tbody');
  tbody.innerHTML = '';
  
  // Sample invoice data - in real app, this would come from actual invoices
  const sampleInvoices = [
    { id: 'INV-001', client: 'ABC Company', date: '2025-01-15', dueDate: '2025-02-15', amount: 5000, status: 'paid' },
    { id: 'INV-002', client: 'XYZ Corp', date: '2025-01-20', dueDate: '2025-02-20', amount: 7500, status: 'pending' }
  ];
  
  sampleInvoices.forEach(invoice => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${invoice.id}</td>
      <td>${invoice.client}</td>
      <td>${new Date(invoice.date).toLocaleDateString()}</td>
      <td>${new Date(invoice.dueDate).toLocaleDateString()}</td>
      <td>$${invoice.amount.toFixed(2)}</td>
      <td><span class="status-${invoice.status}">${invoice.status.toUpperCase()}</span></td>
      <td>
        <button class="btn btn-primary" onclick="viewInvoice('${invoice.id}')">üëÅÔ∏è</button>
        <button class="btn btn-warning" onclick="editInvoice('${invoice.id}')">‚úèÔ∏è</button>
        <button class="btn btn-success" onclick="sendInvoice('${invoice.id}')">üìß</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

function updateBudgets() {
  const budgetSummary = document.getElementById('budgetSummary');
  budgetSummary.innerHTML = '';
  
  const categories = ['salary', 'rent', 'utilities', 'marketing'];
  categories.forEach(category => {
    const spent = transactions
      .filter(t => t.type === 'expense' && t.category === category)
      .reduce((sum, t) => sum + t.amount, 0);
    
    const budget = 1000; // Sample budget
    const usage = (spent / budget) * 100;
    
    const div = document.createElement('div');
    div.style.marginBottom = '10px';
    div.innerHTML = `
      <strong>${category.toUpperCase()}</strong>
      <div>Spent: $${spent.toFixed(2)} / Budget: $${budget.toFixed(2)}</div>
      <div style="background: #f0f0f0; border-radius: 5px; height: 10px;">
        <div style="background: ${usage > 100 ? '#c0392b' : '#27ae60'}; width: ${Math.min(usage, 100)}%; height: 100%; border-radius: 5px;"></div>
      </div>
      <div style="font-size: 0.8em; color: #666;">${usage.toFixed(1)}% used</div>
    `;
    budgetSummary.appendChild(div);
  });
}

function switchTab(tabName) {
  // Hide all tab contents
  document.querySelectorAll('.tab-content').forEach(tab => {
    tab.classList.remove('active');
  });
  
  // Remove active class from all tabs
  document.querySelectorAll('.tab').forEach(tab => {
    tab.classList.remove('active');
  });
  
  // Show selected tab content and activate tab
  document.getElementById(tabName).classList.add('active');
  event.target.classList.add('active');
}

function editTransaction(id) {
  const transaction = transactions.find(t => t.id === id);
  if (transaction) {
    if (transaction.type === 'income') {
      document.getElementById('incomeAmount').value = transaction.amount;
      document.getElementById('incomeCategory').value = transaction.category;
      document.getElementById('incomeDescription').value = transaction.description;
      document.getElementById('incomeDate').value = transaction.date;
      openModal('addIncome');
    } else {
      document.getElementById('expenseAmount').value = transaction.amount;
      document.getElementById('expenseCategory').value = transaction.category;
      document.getElementById('expenseDescription').value = transaction.description;
      document.getElementById('expenseDate').value = transaction.date;
      openModal('addExpense');
    }
  }
}

function deleteTransaction(id) {
  if (confirm('Delete this transaction?')) {
    transactions = transactions.filter(t => t.id !== id);
    localStorage.setItem('financeTransactions', JSON.stringify(transactions));
    updateFinanceData();
  }
}

function viewInvoice(id) {
  alert(`Viewing invoice: ${id}`);
}

function editInvoice(id) {
  alert(`Editing invoice: ${id}`);
}

function sendInvoice(id) {
  alert(`Sending invoice: ${id} to client`);
}

function generateFinancialReport() {
  alert('Financial report generated! This would create a comprehensive PDF report.');
}

function exportFinancialData() {
  const data = {
    transactions: transactions,
    invoices: invoices,
    budgets: budgets
  };
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'financial-data.json';
  a.click();
}

// Initialize
document.addEventListener('DOMContentLoaded', function() {
  updateFinanceData();
});
</script>
</body>
</html>
